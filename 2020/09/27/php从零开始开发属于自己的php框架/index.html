

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;dark&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="make changes, make perfect">
  <meta name="author" content="Dr34d">
  <meta name="keywords" content="blog">
  <title>php从零开始开发属于自己的php框架 - Dr34d&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/xt256.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"greydr34d.github.io","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Dr34d's blog" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Dr34d's Blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/php_banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="php从零开始开发属于自己的php框架">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-09-27 11:24" pubdate>
        2020年9月27日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      6k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      89
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">php从零开始开发属于自己的php框架</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：20 天前
                
              </p>
            
            <div class="markdown-body">
              <h1 id="php从零开始开发属于自己的php框架"><a href="#php从零开始开发属于自己的php框架" class="headerlink" title="php从零开始开发属于自己的php框架"></a>php从零开始开发属于自己的php框架</h1><h2 id="mvc框架理解"><a href="#mvc框架理解" class="headerlink" title="mvc框架理解"></a>mvc框架理解</h2><p>mv结构：</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment"># model 模型</span>
<span class="hljs-variable">$conn</span> = mysqli_connect(<span class="hljs-string">&#x27;localhost&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);
<span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$conn</span>,<span class="hljs-string">&quot;select * from users&quot;</span>);

<span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span> &amp;&amp; mysqli_num_rows(<span class="hljs-variable">$result</span>)&gt;<span class="hljs-number">0</span>)&#123;
    <span class="hljs-variable">$rows</span> =mysqli_fetch_all(<span class="hljs-variable">$result</span>,MYSQLI_ASSOC);
&#125;<span class="hljs-keyword">else</span>&#123;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2&gt;没有数据&lt;/h2&gt;&quot;</span>;
&#125;

<span class="hljs-comment"># view 视图</span>
<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;h2&gt;学生信息表&lt;/h2&gt;&#x27;</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;table border=&quot;1&quot; cellspacing=&quot;0&quot; cellpadding=&quot;5&quot; align=&quot;center&quot; width=&quot;60%&quot;&gt;&#x27;</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;username&lt;/th&gt;&lt;th&gt;password&lt;/th&gt;&lt;/tr&gt;&#x27;</span>;
<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$rows</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>)&#123;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;tr&gt;&#x27;</span>;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;td&gt;&#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;id&#x27;</span>].<span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;td&gt;&#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;username&#x27;</span>].<span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;td&gt;&#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;password&#x27;</span>].<span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;
&#125;
<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;/table&gt;&#x27;</span>;
</code></pre></div>



<p>将其改为mvc模式：</p>
<p>model.php</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$conn</span> = mysqli_connect(<span class="hljs-string">&#x27;localhost&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);
<span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$conn</span>,<span class="hljs-string">&quot;select * from users&quot;</span>);

<span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span> &amp;&amp; mysqli_num_rows(<span class="hljs-variable">$result</span>)&gt;<span class="hljs-number">0</span>)&#123;
    <span class="hljs-variable">$rows</span> =mysqli_fetch_all(<span class="hljs-variable">$result</span>,MYSQLI_ASSOC);
&#125;<span class="hljs-keyword">else</span>&#123;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2&gt;没有数据&lt;/h2&gt;&quot;</span>;
&#125;</code></pre></div>





<p>view.php</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;h2&gt;学生信息表&lt;/h2&gt;&#x27;</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;table border=&quot;1&quot; cellspacing=&quot;0&quot; cellpadding=&quot;5&quot; align=&quot;center&quot; width=&quot;60%&quot;&gt;&#x27;</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;username&lt;/th&gt;&lt;th&gt;password&lt;/th&gt;&lt;/tr&gt;&#x27;</span>;
<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$rows</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>)&#123;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;tr&gt;&#x27;</span>;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;td&gt;&#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;id&#x27;</span>].<span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;td&gt;&#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;username&#x27;</span>].<span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;td&gt;&#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;password&#x27;</span>].<span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;
&#125;
<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;/table&gt;&#x27;</span>;
</code></pre></div>



<p>mvc.php</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;model.php&quot;</span>;

<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;view.php&quot;</span>;</code></pre></div>



<p>此时mvc.php就是一个控制器。</p>
<p>所以很好理解，对MVC架构的简单理解就是将数据库操作，前端展示分开，由统一的一个入口文件（控制器）进行控制。</p>
<p>实际的开发顺序应当为MCV，先写好模型，然后根据模型的需要编写控制器，最后根据模型的特点编写合适的模型。</p>
<h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><p>php语言的强大，离不开设计模式，php语言发展到今天，设计模式有几十种，本次介绍的是单例模式。</p>
<p>danli.php</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span></span>&#123;
    
&#125;

<span class="hljs-variable">$obj1</span> = <span class="hljs-keyword">new</span> Demo();
<span class="hljs-variable">$obj2</span> = <span class="hljs-keyword">new</span> Demo();
<span class="hljs-variable">$obj3</span> = <span class="hljs-keyword">new</span> Demo();

var_dump(<span class="hljs-variable">$obj1</span>,<span class="hljs-variable">$obj2</span>,<span class="hljs-variable">$obj3</span>);</code></pre></div>



<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">object</span>(Demo)<span class="hljs-comment">#1 (0) &#123;</span>
&#125;
<span class="hljs-keyword">object</span>(Demo)<span class="hljs-comment">#2 (0) &#123;</span>
&#125;
<span class="hljs-keyword">object</span>(Demo)<span class="hljs-comment">#3 (0) &#123;</span>
&#125;
</code></pre></div>

<p>#后的数字为对象的id号。从这个例子可以看到我们每次进行new 操作，都会产生一个完全的新的对象。实际上，对象的维护是非常消耗内存的。</p>
<p>如果我们以new的方式来生成这样的一个实例化对象，当我们在别的文件对这个类文件进行包含的时候，会再次进行new操作，这样实例化多个对象其实是没有必要的，实际场景下我们只需要调用这个类的特定方法，维护一个实例化对象就够了。单例模式就是用来解决这个问题的。</p>
<p>变量的引用传递</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span></span>&#123;

&#125;

<span class="hljs-variable">$obj1</span> = <span class="hljs-keyword">new</span> Demo();
<span class="hljs-variable">$obj2</span> = <span class="hljs-keyword">new</span> Demo();
<span class="hljs-variable">$obj3</span> = <span class="hljs-keyword">new</span> Demo();
<span class="hljs-variable">$obj4</span> = <span class="hljs-variable">$obj3</span>;
var_dump(<span class="hljs-variable">$obj1</span>,<span class="hljs-variable">$obj2</span>,<span class="hljs-variable">$obj3</span>,<span class="hljs-variable">$obj4</span>);</code></pre></div>

<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">object</span>(Demo)<span class="hljs-comment">#1 (0) &#123;</span>
&#125;
<span class="hljs-keyword">object</span>(Demo)<span class="hljs-comment">#2 (0) &#123;</span>
&#125;
<span class="hljs-keyword">object</span>(Demo)<span class="hljs-comment">#3 (0) &#123;</span>
&#125;
<span class="hljs-keyword">object</span>(Demo)<span class="hljs-comment">#3 (0) &#123;</span>
&#125;</code></pre></div>

<p>可以看到通过引用传递生成的对象其实是已有对象的引用。学会这个知识点后即可开始单例模式的代码编写</p>
<p>单例模式需要完成以下几个要求</p>
<ul>
<li>维护一个私有属性，保存当前类的实例</li>
<li>私有化构造方法，禁止外部用new来创建类的实例</li>
<li>私有化克隆方法，禁止从外部克隆来生成类的实例</li>
<li>编写一个public方法来生成类的实例</li>
</ul>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span></span>&#123;
    <span class="hljs-comment">// 维护一个私有属性，保存当前类的实例</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$instance</span> = <span class="hljs-literal">null</span>;
    
    <span class="hljs-comment">//私有化构造方法，禁止外部用new来创建类的实例</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>&#123;

    &#125;
    
    <span class="hljs-comment">//私有化克隆方法，禁止从外部克隆来生成类的实例</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__clone</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Implement __clone() method.</span>
    &#125;

    <span class="hljs-comment">//生成类的实例</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInstance</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-comment">//判断私有属性$instance是否为当前类的实例</span>
        <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">self</span>)
        &#123;
            <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">self</span>();
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span>;
    &#125;
&#125;

<span class="hljs-comment">//获取实例</span>
<span class="hljs-variable">$obj1</span> = Demo::getInstance();
<span class="hljs-variable">$obj2</span> = Demo::getInstance();
<span class="hljs-variable">$obj3</span> = Demo::getInstance();
<span class="hljs-variable">$obj4</span> = Demo::getInstance();
var_dump(<span class="hljs-variable">$obj1</span>,<span class="hljs-variable">$obj2</span>,<span class="hljs-variable">$obj3</span>,<span class="hljs-variable">$obj4</span>);</code></pre></div>



<h2 id="封装数据库操作类Db类"><a href="#封装数据库操作类Db类" class="headerlink" title="封装数据库操作类Db类"></a>封装数据库操作类Db类</h2><ul>
<li>创建当前类的单一实例</li>
<li>创建数据库的基本操作</li>
</ul>
<p>这部分的逻辑很简单，实现数据库操作的封装，基于PDO的方式进行编写。主要知识点在于熟悉PDO函数。</p>
<p>编写Db类，我们可以将所有参数保存在一个数组里。并且加上上节中的单例模式。有所不同的是，初始化部分我们需要将用户提供的额外配置加入默认配置，使用数组连接函数array_merge即可。并进行连接。这里connect函数尚未编写。</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Db</span></span>&#123;
    <span class="hljs-comment">//数据库的默认连接参数</span>
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$dbConfig</span> = [
        <span class="hljs-string">&#x27;db&#x27;</span>=&gt;<span class="hljs-string">&#x27;mysql&#x27;</span>,
        <span class="hljs-string">&#x27;host&#x27;</span>=&gt;<span class="hljs-string">&#x27;localhost&#x27;</span>,
        <span class="hljs-string">&#x27;port&#x27;</span>=&gt;<span class="hljs-string">&#x27;3306&#x27;</span>,
        <span class="hljs-string">&#x27;user&#x27;</span>=&gt;<span class="hljs-string">&#x27;root&#x27;</span>,
        <span class="hljs-string">&#x27;pass&#x27;</span>=&gt;<span class="hljs-string">&#x27;root&#x27;</span>,
        <span class="hljs-string">&#x27;charset&#x27;</span>=&gt;<span class="hljs-string">&#x27;utf8&#x27;</span>,
        <span class="hljs-string">&#x27;dbname&#x27;</span>=&gt;<span class="hljs-string">&#x27;test&#x27;</span>,
    ];
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$instance</span> = <span class="hljs-literal">null</span>;
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$params</span></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-comment">//初始化连接参数</span>
        <span class="hljs-keyword">$this</span>-&gt;dbConfig = array_merge(<span class="hljs-keyword">$this</span>-&gt;dbConfig,<span class="hljs-variable">$params</span>);
        <span class="hljs-comment">//连接数据库</span>
        <span class="hljs-keyword">$this</span>-&gt;connect();
    &#125;
    <span class="hljs-comment">/*</span>
<span class="hljs-comment">     * 禁止外部克隆</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__clone</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Implement __clone() method.</span>
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInstance</span>(<span class="hljs-params"></span>)</span>&#123;
        <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">self</span>)&#123;
            <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">self</span>();
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span>;
    &#125;
    
&#125;</code></pre></div>



<p>connect函数：</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span>(<span class="hljs-params"></span>)</span>&#123;
    <span class="hljs-keyword">try</span>&#123;
        <span class="hljs-comment">//配置数据源DSN</span>
        <span class="hljs-variable">$dsn</span> = <span class="hljs-string">&quot;<span class="hljs-subst">&#123;$this-&gt;dbConfig[&#x27;db&#x27;]&#125;</span>:host=<span class="hljs-subst">&#123;$this-&gt;dbConfig[&#x27;host&#x27;]&#125;</span>;</span>
<span class="hljs-string">        port=<span class="hljs-subst">&#123;$this-&gt;dbConfig[&#x27;port&#x27;]&#125;</span>;dbname=<span class="hljs-subst">&#123;$this-&gt;dbConfig[&#x27;dbname&#x27;]&#125;</span>;</span>
<span class="hljs-string">        charset=<span class="hljs-subst">&#123;$this-&gt;dbConfig[&#x27;charset&#x27;]&#125;</span>&quot;</span>;

        <span class="hljs-keyword">$this</span>-&gt;conn = <span class="hljs-keyword">new</span> PDO(<span class="hljs-variable">$dsn</span>,<span class="hljs-keyword">$this</span>-&gt;dbConfig[<span class="hljs-string">&#x27;user&#x27;</span>],<span class="hljs-keyword">$this</span>-&gt;dbConfig[<span class="hljs-string">&#x27;pass&#x27;</span>]);

        <span class="hljs-comment">//设置客户端的默认字符集</span>
        <span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-string">&quot;SET NAMES <span class="hljs-subst">&#123;$this-&gt;dbConfig[&#x27;charset&#x27;]&#125;</span>&quot;</span>);

    &#125;<span class="hljs-keyword">catch</span> (PDOException <span class="hljs-variable">$e</span>)&#123;
        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;数据库连接失败&quot;</span>.<span class="hljs-variable">$e</span>-&gt;getMessage());
    &#125;
&#125;
</code></pre></div>

<p>这里涉及几个知识点：</p>
<ul>
<li><p>dsn</p>
<p>数据源名称或叫做 DSN，包含了请求连接到数据库的信息。</p>
<p>通常，一个 DSN 由 PDO 驱动名、紧随其后的冒号、以及具体 PDO 驱动的连接语法组成。更深入的信息能从 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/pdo.drivers.php">PDO 具体驱动文档</a>找到。</p>
<p>范例：</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$dsn</span> = <span class="hljs-string">&#x27;mysql:dbname=testdb;host=127.0.0.1;port=3333&#x27;</span>;
<span class="hljs-meta">?&gt;</span></code></pre></div>

<p>这里加上大括号没有影响。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/pdo.query.php">PDO::query</a> — 执行 SQL 语句，以 PDOStatement 对象形式返回结果集</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/pdo.query.php">PDO::query</a> — 执行 SQL 语句，以 PDOStatement 对象形式返回结果集</p>
</li>
<li><p>设置客户端的默认字符集为我们配置的字符集相同。</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">//设置客户端的默认字符集</span>
<span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-string">&quot;SET NAMES <span class="hljs-subst">&#123;$this-&gt;dbConfig[&#x27;charset&#x27;]&#125;</span>&quot;</span>);</code></pre></div>





</li>
</ul>
<p>下一步是编写数据库的语句执行操作</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">/*</span>
<span class="hljs-comment"> * 完成数据表的写操作：新增、更新、删除</span>
<span class="hljs-comment"> * 返回受影响的记录，如果是新增返回新增主键id</span>
<span class="hljs-comment"> */</span>

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">exec</span>(<span class="hljs-params"><span class="hljs-variable">$sql</span></span>)</span>&#123;
    <span class="hljs-variable">$num</span> = <span class="hljs-keyword">$this</span>-&gt;conn-&gt;exec(<span class="hljs-variable">$sql</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$num</span> &gt; <span class="hljs-number">0</span>)&#123;
        <span class="hljs-comment">//如果是插入操作，新增主键id</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span>!==<span class="hljs-keyword">$this</span>-&gt;conn-&gt;lastInsertId())&#123;
            <span class="hljs-keyword">$this</span>-&gt;insertId = <span class="hljs-keyword">$this</span>-&gt;conn-&gt;lastInsertId();
        &#125;
        <span class="hljs-keyword">$this</span>-&gt;num = <span class="hljs-variable">$num</span>;<span class="hljs-comment">//返回受影响的记录数量。</span>
    &#125;<span class="hljs-keyword">else</span>&#123;
        <span class="hljs-variable">$error</span> = <span class="hljs-keyword">$this</span>-&gt;conn-&gt;errorInfo();<span class="hljs-comment">//获取最后操作的错误信息数组</span>
        <span class="hljs-comment">//[0]错误标识符[1]错误代码[2]错误信息</span>
        <span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;操作失败&#x27;</span>.<span class="hljs-variable">$error</span>[<span class="hljs-number">0</span>].<span class="hljs-string">&#x27;:&#x27;</span>.<span class="hljs-variable">$error</span>[<span class="hljs-number">1</span>].<span class="hljs-string">&#x27;:&#x27;</span>.<span class="hljs-variable">$error</span>[<span class="hljs-number">2</span>];

    &#125;
&#125;
</code></pre></div>

<ul>
<li><p>这里可以添加一个成员变量$num用于记录收到影响的记录数量。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/pdo.exec.php">PDO::exec</a> — 执行一条 SQL 语句，并返回受影响的行数</p>
<p>实例：</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$dbh</span> = <span class="hljs-keyword">new</span> PDO(<span class="hljs-string">&#x27;odbc:sample&#x27;</span>, <span class="hljs-string">&#x27;db2inst1&#x27;</span>, <span class="hljs-string">&#x27;ibmdb2&#x27;</span>);

<span class="hljs-comment">/*  删除 FRUIT 数据表中满足条件的所有行 */</span>
<span class="hljs-variable">$count</span> = <span class="hljs-variable">$dbh</span>-&gt;exec(<span class="hljs-string">&quot;DELETE FROM fruit WHERE colour = &#x27;red&#x27;&quot;</span>);

<span class="hljs-comment">/* 返回被删除的行数 */</span>
<span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;Deleted <span class="hljs-subst">$count</span> rows.\n&quot;</span>);
<span class="hljs-meta">?&gt;</span></code></pre></div>


</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/pdo.lastinsertid.php">PDO::lastInsertId</a> — 返回最后插入行的ID或序列值</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/pdostatement.errorinfo.php">PDOStatement::errorInfo</a> — 获取跟上一次语句句柄操作相关的扩展错误信息</p>
<p>返回一个数组</p>
<table>
<thead>
<tr>
<th align="left">Element</th>
<th align="left">Information</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0</td>
<td align="left">SQLSTATE error code (a five characters alphanumeric identifier defined in the ANSI SQL standard).</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">Driver-specific error code.</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Driver-specific error message.</td>
</tr>
</tbody></table>
<p>实例：</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">/* Provoke an error -- bogus SQL syntax */</span>
<span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$dbh</span>-&gt;prepare(<span class="hljs-string">&#x27;bogus sql&#x27;</span>);
<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$stmt</span>) &#123;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\nPDO::errorInfo():\n&quot;</span>;
    print_r(<span class="hljs-variable">$dbh</span>-&gt;errorInfo());
&#125;
<span class="hljs-comment">/*</span>
<span class="hljs-comment">以上例程会输出：</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">PDO::errorInfo():</span>
<span class="hljs-comment">Array</span>
<span class="hljs-comment">(</span>
<span class="hljs-comment">    [0] =&gt; HY000</span>
<span class="hljs-comment">    [1] =&gt; 1</span>
<span class="hljs-comment">    [2] =&gt; near &quot;bogus&quot;: syntax error</span>
<span class="hljs-comment">)*/</span>
<span class="hljs-meta">?&gt;</span></code></pre></div>



</li>
</ul>
<p>下一步是编写查询函数</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">//获取单条查询结果</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetch</span>(<span class="hljs-params"><span class="hljs-variable">$sql</span></span>)</span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>)-&gt;fetch(PDO::FETCH_ASSOC);
&#125;

<span class="hljs-comment">//获取多条查询结果</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchAll</span>(<span class="hljs-params"><span class="hljs-variable">$sql</span></span>)</span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>)-&gt;fetchAll(PDO::FETCH_ASSOC);
&#125;
</code></pre></div>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/pdo.query.php">PDO::query</a> — 执行 SQL 语句，以 PDOStatement 对象形式返回结果集</li>
<li>PDOStatement 类中的fetch方法<ul>
<li>PDOStatement::fetch — 从结果集中获取下一行</li>
<li>第一个参数为fetch_style，这里为PDO::FETCH_ASSOC</li>
<li><code>PDO::FETCH_ASSOC</code>：返回一个索引为结果集列名的数组</li>
<li>更多参数信息参考：<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/pdostatement.fetch.php">https://www.php.net/manual/zh/pdostatement.fetch.php</a></li>
<li>更多PDOStatement 信息参考：<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/class.pdostatement.php">https://www.php.net/manual/zh/class.pdostatement.php</a></li>
</ul>
</li>
<li></li>
</ul>
<p>总代码：</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Db</span></span>&#123;
    <span class="hljs-comment">//数据库的默认连接参数</span>
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$dbConfig</span> = [
        <span class="hljs-string">&#x27;db&#x27;</span>=&gt;<span class="hljs-string">&#x27;mysql&#x27;</span>,
        <span class="hljs-string">&#x27;host&#x27;</span>=&gt;<span class="hljs-string">&#x27;localhost&#x27;</span>,
        <span class="hljs-string">&#x27;port&#x27;</span>=&gt;<span class="hljs-string">&#x27;3306&#x27;</span>,
        <span class="hljs-string">&#x27;user&#x27;</span>=&gt;<span class="hljs-string">&#x27;root&#x27;</span>,
        <span class="hljs-string">&#x27;pass&#x27;</span>=&gt;<span class="hljs-string">&#x27;root&#x27;</span>,
        <span class="hljs-string">&#x27;charset&#x27;</span>=&gt;<span class="hljs-string">&#x27;utf8&#x27;</span>,
        <span class="hljs-string">&#x27;dbname&#x27;</span>=&gt;<span class="hljs-string">&#x27;test&#x27;</span>,
    ];

    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$instance</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$conn</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-comment">//返回新增的记录id</span>
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$insertId</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-comment">//返回受影响记录的数量</span>
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$num</span> = <span class="hljs-number">0</span>;

    <span class="hljs-comment">/*</span>
<span class="hljs-comment">     * 私有化</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$params</span></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-comment">//初始化连接参数</span>
        <span class="hljs-keyword">$this</span>-&gt;dbConfig = array_merge(<span class="hljs-keyword">$this</span>-&gt;dbConfig,<span class="hljs-variable">$params</span>);
        <span class="hljs-comment">//连接数据库</span>
        <span class="hljs-keyword">$this</span>-&gt;connect();
    &#125;

    <span class="hljs-comment">/*</span>
<span class="hljs-comment">     * 禁止外部克隆</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__clone</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Implement __clone() method.</span>
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInstance</span>(<span class="hljs-params"><span class="hljs-variable">$params</span>=[]</span>)</span>&#123;
        <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">self</span>)&#123;
            <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">self</span>(<span class="hljs-variable">$params</span>);
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span>;
    &#125;

    <span class="hljs-comment">/*</span>
<span class="hljs-comment">     *</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span>(<span class="hljs-params"></span>)</span>&#123;
        <span class="hljs-keyword">try</span>&#123;
            <span class="hljs-comment">//配置数据源DSN</span>
            <span class="hljs-variable">$dsn</span> = <span class="hljs-string">&quot;<span class="hljs-subst">&#123;$this-&gt;dbConfig[&#x27;db&#x27;]&#125;</span>:host=<span class="hljs-subst">&#123;$this-&gt;dbConfig[&#x27;host&#x27;]&#125;</span>;</span>
<span class="hljs-string">            port=<span class="hljs-subst">&#123;$this-&gt;dbConfig[&#x27;port&#x27;]&#125;</span>;dbname=<span class="hljs-subst">&#123;$this-&gt;dbConfig[&#x27;dbname&#x27;]&#125;</span>;</span>
<span class="hljs-string">            charset=<span class="hljs-subst">&#123;$this-&gt;dbConfig[&#x27;charset&#x27;]&#125;</span>&quot;</span>;

            <span class="hljs-keyword">$this</span>-&gt;conn = <span class="hljs-keyword">new</span> PDO(<span class="hljs-variable">$dsn</span>,<span class="hljs-keyword">$this</span>-&gt;dbConfig[<span class="hljs-string">&#x27;user&#x27;</span>],<span class="hljs-keyword">$this</span>-&gt;dbConfig[<span class="hljs-string">&#x27;pass&#x27;</span>]);

            <span class="hljs-comment">//设置客户端的默认字符集</span>
            <span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-string">&quot;SET NAMES <span class="hljs-subst">&#123;$this-&gt;dbConfig[&#x27;charset&#x27;]&#125;</span>&quot;</span>);

        &#125;<span class="hljs-keyword">catch</span> (PDOException <span class="hljs-variable">$e</span>)&#123;
            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;数据库连接失败&quot;</span>.<span class="hljs-variable">$e</span>-&gt;getMessage());
        &#125;
    &#125;

    <span class="hljs-comment">/*</span>
<span class="hljs-comment">     * 完成数据表的写操作：新增、更新、删除</span>
<span class="hljs-comment">     * 返回受影响的记录，如果是新增返回新增主键id</span>
<span class="hljs-comment">     */</span>

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">exec</span>(<span class="hljs-params"><span class="hljs-variable">$sql</span></span>)</span>&#123;
        <span class="hljs-variable">$num</span> = <span class="hljs-keyword">$this</span>-&gt;conn-&gt;exec(<span class="hljs-variable">$sql</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$num</span> &gt; <span class="hljs-number">0</span>)&#123;
            <span class="hljs-comment">//如果是新增操作，新增主键id</span>
            <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span>!==<span class="hljs-keyword">$this</span>-&gt;conn-&gt;lastInsertId())&#123;
                <span class="hljs-keyword">$this</span>-&gt;insertId = <span class="hljs-keyword">$this</span>-&gt;conn-&gt;lastInsertId();
            &#125;
            <span class="hljs-keyword">$this</span>-&gt;num = <span class="hljs-variable">$num</span>;<span class="hljs-comment">//返回受影响的记录数量。</span>
        &#125;<span class="hljs-keyword">else</span>&#123;
            <span class="hljs-variable">$error</span> = <span class="hljs-keyword">$this</span>-&gt;conn-&gt;errorInfo();<span class="hljs-comment">//获取最后操作的错误信息数组</span>
            <span class="hljs-comment">//[0]错误标识符[1]错误代码[2]错误信息</span>
            <span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;操作失败&#x27;</span>.<span class="hljs-variable">$error</span>[<span class="hljs-number">0</span>].<span class="hljs-string">&#x27;:&#x27;</span>.<span class="hljs-variable">$error</span>[<span class="hljs-number">1</span>].<span class="hljs-string">&#x27;:&#x27;</span>.<span class="hljs-variable">$error</span>[<span class="hljs-number">2</span>];

        &#125;
    &#125;

    <span class="hljs-comment">//获取单条查询结果</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetch</span>(<span class="hljs-params"><span class="hljs-variable">$sql</span></span>)</span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>)-&gt;fetch(PDO::FETCH_ASSOC);
    &#125;

    <span class="hljs-comment">//获取多条查询结果</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchAll</span>(<span class="hljs-params"><span class="hljs-variable">$sql</span></span>)</span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>)-&gt;fetchAll(PDO::FETCH_ASSOC);
    &#125;

&#125;</code></pre></div>





<h2 id="测试数据库操作类Db"><a href="#测试数据库操作类Db" class="headerlink" title="测试数据库操作类Db"></a>测试数据库操作类Db</h2><p>编写demo.php</p>
<p>实例化Db类进行测试</p>
<p>更新操作</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * Db测试</span>
<span class="hljs-comment"> */</span>

<span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;model/Db.php&#x27;</span>;

<span class="hljs-variable">$db</span> = Db::getInstance();  <span class="hljs-comment">//获取Db类实例</span>

<span class="hljs-comment">//更新</span>

<span class="hljs-variable">$sql</span> = <span class="hljs-string">&#x27;UPDATE users SET username=&quot;dd&quot; WHERE id = 1&#x27;</span>;
<span class="hljs-variable">$num</span> = <span class="hljs-variable">$db</span>-&gt;exec(<span class="hljs-variable">$sql</span>);
<span class="hljs-comment">//echo &quot;成功更新&quot;.$num.&quot;条数据。&quot;;</span>
</code></pre></div>



<p>新增操作测试</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;INSERT INTO users(id,username,password) values (4,&#x27;json&#x27;,&#x27;json&#x27;)&quot;</span>;
<span class="hljs-variable">$db</span>-&gt;exec(<span class="hljs-variable">$sql</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;成功更新&quot;</span>.<span class="hljs-variable">$db</span>-&gt;num.<span class="hljs-string">&quot;条数据。新增主键id为：&quot;</span>.<span class="hljs-variable">$db</span>-&gt;insertId;</code></pre></div>



<p>删除操作测试</p>
<div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&#x27;DELETE FROM users WHERE id = 4&#x27;</span>;
<span class="hljs-variable">$db</span>-&gt;<span class="hljs-built_in">exec</span>(<span class="hljs-variable">$sql</span>);</code></pre></div>



<p>单条查询操作</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">//查询单条</span>
<span class="hljs-variable">$sql</span> = <span class="hljs-string">&#x27;SELECT * FROM users where id=1&#x27;</span>;
<span class="hljs-variable">$row</span> = <span class="hljs-variable">$db</span>-&gt;fetch(<span class="hljs-variable">$sql</span>);
print_r(<span class="hljs-variable">$row</span>);</code></pre></div>



<p>多条记录查询</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&#x27;SELECT * FROM users&#x27;</span>;
<span class="hljs-variable">$row</span> = <span class="hljs-variable">$db</span>-&gt;fetchAll(<span class="hljs-variable">$sql</span>);
print_r(<span class="hljs-variable">$row</span>);</code></pre></div>





<h2 id="创建公共基础类Model"><a href="#创建公共基础类Model" class="headerlink" title="创建公共基础类Model"></a>创建公共基础类Model</h2><p>编写公共基础类的目的就是为了提高代码的复用率，避免代码的冗余，用户在进行不同的模型定义时，只需要继承公共基础类即可。</p>
<p>Db\Model.php</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * 公共模型类</span>
<span class="hljs-comment"> * 完成数据库连接和公共方法</span>
<span class="hljs-comment"> */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Model</span></span>&#123;
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$db</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">//数据库连接对象</span>
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-keyword">$this</span>-&gt;init();  <span class="hljs-comment">//完成数据库连接</span>
    &#125;

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-variable">$dbConfig</span> = [
            <span class="hljs-string">&#x27;user&#x27;</span>=&gt;<span class="hljs-string">&#x27;root&#x27;</span>,
            <span class="hljs-string">&#x27;pass&#x27;</span>=&gt;<span class="hljs-string">&#x27;root&#x27;</span>,
            <span class="hljs-string">&#x27;dbname&#x27;</span>=&gt;<span class="hljs-string">&#x27;test&#x27;</span>,
        ];

        <span class="hljs-keyword">$this</span>-&gt;db = Db::getInstance(<span class="hljs-variable">$dbConfig</span>);
    &#125;

    <span class="hljs-comment">//获取全部数据</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAll</span>(<span class="hljs-params"></span>)</span>&#123;
        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT * FROM users&quot;</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;data = <span class="hljs-keyword">$this</span>-&gt;db-&gt;fetchAll(<span class="hljs-variable">$sql</span>);
    &#125;

    <span class="hljs-comment">//获取单条数据</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>)</span>&#123;
        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT * FROM users WHERE id=<span class="hljs-subst">$id</span>&quot;</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;data = <span class="hljs-keyword">$this</span>-&gt;db-&gt;fetch(<span class="hljs-variable">$sql</span>);
    &#125;
&#125;</code></pre></div>



<ul>
<li>这里进行了数据库的初始化，可以修改用户配置。调用Db类进行数据库的实例化，存放在Model类的db变量中。</li>
<li>编写了总共方法getAll和get</li>
</ul>
<h2 id="创建用户自定义的模型"><a href="#创建用户自定义的模型" class="headerlink" title="创建用户自定义的模型"></a>创建用户自定义的模型</h2><p>用户自定义的模型实际上就是一张张表，例如，学生信息表，商品表，课程表等。用户模型都有一个公共的特点，都继承于公共模型Model。</p>
<p>UserModel.php</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span></span>
<span class="hljs-class"></span>&#123;
    
&#125;</code></pre></div>



<h2 id="自定义控制器类的制作"><a href="#自定义控制器类的制作" class="headerlink" title="自定义控制器类的制作"></a>自定义控制器类的制作</h2><p>控制器是模块的具体实现。模型是一张表。我们对模型的增删改查，最终都会映射为控制器中的一个具体方法。</p>
<p>控制器中的方法大多是模型操作的具体实现。大多数控制器类的方法都有对应的视图文件（模板文件）</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span></span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listAll</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-comment">//实例化模型，获取数据</span>
        <span class="hljs-variable">$usr</span> = <span class="hljs-keyword">new</span> UserModel();
        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$usr</span>-&gt;getAll();
        print_r(<span class="hljs-variable">$data</span>);
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">info</span>(<span class="hljs-params"><span class="hljs-variable">$id</span>=<span class="hljs-number">1</span></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-comment">//实例化模型，获取数据</span>
        <span class="hljs-variable">$usr</span> = <span class="hljs-keyword">new</span> UserModel();
        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$usr</span>-&gt;get(<span class="hljs-variable">$id</span>);
        print_r(<span class="hljs-variable">$data</span>);
    &#125;
&#125;</code></pre></div>

<ul>
<li>这里是创建了UserController控制器，来实例化模型，进行具体的操作。</li>
</ul>
<h2 id="创建前端控制器"><a href="#创建前端控制器" class="headerlink" title="创建前端控制器"></a>创建前端控制器</h2><p>前端控制器也可以叫做请求分发器，具有入口文件的功能。</p>
<p>首先先将模型类文件包含进来。</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;model\Db.php&#x27;</span>;
<span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;model\Model.php&#x27;</span>;
<span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;model\UserModel.php&#x27;</span>;</code></pre></div>



<p>假如我们需要请求参数为：c=User&amp;a=listAll时调用UserController中的listAll方法。</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">//获取控制器</span>
<span class="hljs-variable">$controller</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]:<span class="hljs-string">&#x27;User&#x27;</span>;
<span class="hljs-variable">$controller</span> .= <span class="hljs-string">&#x27;Controller&#x27;</span>;

<span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;controller/&#x27;</span>.<span class="hljs-variable">$controller</span>.<span class="hljs-string">&#x27;.php&#x27;</span>;

<span class="hljs-comment">//获取方法</span>
<span class="hljs-variable">$action</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]:<span class="hljs-string">&#x27;listAll&#x27;</span>;

<span class="hljs-comment">//实例化自定义控制器类</span>

<span class="hljs-variable">$contr</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable">$controller</span>();
<span class="hljs-variable">$contr</span>-&gt;<span class="hljs-variable">$action</span>();</code></pre></div>



<p>index.php</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * 前端控制器</span>
<span class="hljs-comment"> * 请求分发器</span>
<span class="hljs-comment"> */</span>

<span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;model\Db.php&#x27;</span>;
<span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;model\Model.php&#x27;</span>;
<span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;model\UserModel.php&#x27;</span>;

<span class="hljs-comment">//获取控制器</span>
<span class="hljs-variable">$controller</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]:<span class="hljs-string">&#x27;User&#x27;</span>;
<span class="hljs-variable">$controller</span> .= <span class="hljs-string">&#x27;Controller&#x27;</span>;

<span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;controller/&#x27;</span>.<span class="hljs-variable">$controller</span>.<span class="hljs-string">&#x27;.php&#x27;</span>;

<span class="hljs-comment">//获取方法</span>
<span class="hljs-variable">$action</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]:<span class="hljs-string">&#x27;listAll&#x27;</span>;

<span class="hljs-comment">//实例化自定义控制器类</span>

<span class="hljs-variable">$contr</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable">$controller</span>();
<span class="hljs-variable">$contr</span>-&gt;<span class="hljs-variable">$action</span>();</code></pre></div>



<h2 id="创建视图基本原则"><a href="#创建视图基本原则" class="headerlink" title="创建视图基本原则"></a>创建视图基本原则</h2><ul>
<li><p>控制器中的一个方法通常与一个视图对应。</p>
</li>
<li><p>视图是用来展示数据的</p>
</li>
</ul>
<h2 id="创建展示所有数据的视图"><a href="#创建展示所有数据的视图" class="headerlink" title="创建展示所有数据的视图"></a>创建展示所有数据的视图</h2><p>创建一个文件夹view</p>
<p>user_list.php</p>
<div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span>学生信息表<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">cellspacing</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">cellpadding</span>=<span class="hljs-string">&quot;5&quot;</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60%&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>id<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>username<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>password<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    &lt;?php foreach($data as $usr): ?&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&lt;?php echo $usr[&#x27;id&#x27;]?&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&lt;?php echo $usr[&#x27;username&#x27;]?&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&lt;?php echo $usr[&#x27;password&#x27;]?&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    &lt;?php endforeach;?&gt;
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>共计：&lt;?php echo count($data);?&gt; 条数据<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>



<p>再在UserController.php中包含进来</p>
<div class="hljs code-wrapper"><pre><code class="hljs php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listAll</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-comment">//实例化模型，获取数据</span>
        <span class="hljs-variable">$usr</span> = <span class="hljs-keyword">new</span> UserModel();
        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$usr</span>-&gt;getAll();
        <span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;view/user_list.php&#x27;</span>; <span class="hljs-comment">//渲染模板</span>
<span class="hljs-comment">//        print_r($data);</span>
    &#125;
</code></pre></div>



<h2 id="创建展示单条数据的视图"><a href="#创建展示单条数据的视图" class="headerlink" title="创建展示单条数据的视图"></a>创建展示单条数据的视图</h2><p>与所有数据不同的是，单条数据为一维数组，在数组的操作上有所不同</p>
<div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span>学生信息表<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">cellspacing</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">cellpadding</span>=<span class="hljs-string">&quot;5&quot;</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60%&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>字段<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>值<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>id<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&lt;?php echo $data[&#x27;id&#x27;]?&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>username<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&lt;?php echo $data[&#x27;username&#x27;]?&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>password<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&lt;?php echo $data[&#x27;password&#x27;]?&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>



<h2 id="规范项目的目录结构"><a href="#规范项目的目录结构" class="headerlink" title="规范项目的目录结构"></a>规范项目的目录结构</h2><div class="hljs code-wrapper"><pre><code class="hljs php">├─application
│  ├─admin
│  │  ├─controller
│  │  ├─model
│  │  └─view
│  ├─config
│  └─home
│      ├─controller
│      ├─model
│      └─view
└─framework

</code></pre></div>



<p>新建一个项目目录，里重新规划目录结构。大致如上图。将之前编写的文件放置到相应的目录下。</p>
<ul>
<li><p>application目录为应用目录，存放业务逻辑代码，主要是前台模块，后台模块和相关的配置文件。</p>
<ul>
<li><p>config目录用于存放相关的各种配置文件</p>
</li>
<li><p>admin为后台模块</p>
<ul>
<li>controller目录</li>
<li>model目录</li>
<li>view目录</li>
</ul>
</li>
<li><p>home为前台模块</p>
<ul>
<li><p>controller目录</p>
<ul>
<li><p>UserController.php</p>
<p>由于目录变化，内容也需要进行相应的变化</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * 用户模块控制器</span>
<span class="hljs-comment"> * 模块管理</span>
<span class="hljs-comment"> * 模型根据数据表创建，控制器根据模块创建</span>
<span class="hljs-comment"> * 一个控制器完成了一个模块的功能</span>
<span class="hljs-comment"> */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span></span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listAllAction</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-comment">//实例化模型，获取数据</span>
        <span class="hljs-variable">$usr</span> = <span class="hljs-keyword">new</span> UserModelAction();
        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$usr</span>-&gt;getAll();
        <span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;./application/view/user_list.php&#x27;</span>; <span class="hljs-comment">//渲染模板</span>
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">infoAction</span>(<span class="hljs-params"><span class="hljs-variable">$id</span>=<span class="hljs-number">1</span></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-comment">//实例化模型，获取数据</span>
        <span class="hljs-variable">$usr</span> = <span class="hljs-keyword">new</span> UserModel();
        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$usr</span>-&gt;get(<span class="hljs-variable">$id</span>);
<span class="hljs-comment">//        print_r($data);</span>
        <span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;./application/view/user_info.php&#x27;</span>;
    &#125;
&#125;</code></pre></div>
</li>
</ul>
</li>
<li><p>model目录</p>
<ul>
<li>UserModel.php</li>
</ul>
</li>
<li><p>view目录</p>
<ul>
<li>user_info.php</li>
</ul>
</li>
</ul>
</li>
<li><p>user_list.php</p>
</li>
</ul>
</li>
<li><p>framwork为框架目录，存放数据库的基础操作类和一些基础模型。</p>
<ul>
<li>base.php：框架的基础类，引导类，完成配置加载和类的自动加载</li>
<li>Model.php</li>
<li>Db.php</li>
</ul>
</li>
<li><p>index.php：入口文件</p>
</li>
</ul>
<h2 id="创建应用的公共配置文件"><a href="#创建应用的公共配置文件" class="headerlink" title="创建应用的公共配置文件"></a>创建应用的公共配置文件</h2><p>编辑application/config.php</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * 公共配置文件</span>
<span class="hljs-comment"> */</span>


<span class="hljs-keyword">return</span> [
    <span class="hljs-comment">//数据库配置</span>
    <span class="hljs-string">&#x27;db&#x27;</span> =&gt; [
        <span class="hljs-string">&#x27;user&#x27;</span>=&gt;<span class="hljs-string">&#x27;root&#x27;</span>,
        <span class="hljs-string">&#x27;pass&#x27;</span>=&gt;<span class="hljs-string">&#x27;root&#x27;</span>,
        <span class="hljs-string">&#x27;dbname&#x27;</span>=&gt;<span class="hljs-string">&#x27;test&#x27;</span>
    ],

    <span class="hljs-comment">//应用的整体配置</span>
    <span class="hljs-string">&#x27;app&#x27;</span> =&gt; [
        <span class="hljs-string">&#x27;default_platform&#x27;</span> =&gt; <span class="hljs-string">&#x27;home&#x27;</span>,

    ],

    <span class="hljs-comment">//前台配置</span>
    <span class="hljs-string">&#x27;home&#x27;</span> =&gt; [
        <span class="hljs-string">&#x27;default_controller&#x27;</span> =&gt; <span class="hljs-string">&#x27;User&#x27;</span>,
        <span class="hljs-string">&#x27;default_action&#x27;</span> =&gt; <span class="hljs-string">&#x27;listAll&#x27;</span>
    ],

    <span class="hljs-string">&#x27;admin&#x27;</span> =&gt; [
        <span class="hljs-string">&#x27;default_controller&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,
        <span class="hljs-string">&#x27;default_action&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>
    ]

];</code></pre></div>



<h2 id="创建框架基础类"><a href="#创建框架基础类" class="headerlink" title="创建框架基础类"></a>创建框架基础类</h2><p>框架基础类要完成的工作有</p>
<ul>
<li>自动加载用户自定义的配置信息</li>
<li>完成类的自动加载</li>
<li>获取用户的请求：请求分发（把用户的请求发送给特定的控制器）</li>
</ul>
<p>我们在一个函数内完成所有功能</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>)</span>&#123;
    <span class="hljs-comment">//加载配置</span>
    <span class="hljs-keyword">$this</span>-&gt;loadConfig();
    <span class="hljs-comment">//注册自动加载类</span>
    <span class="hljs-keyword">$this</span>-&gt;registerAutoLoad();
    <span class="hljs-comment">//获取请求参数</span>
    <span class="hljs-keyword">$this</span>-&gt;getRequestParams();
    <span class="hljs-comment">//请求分发</span>
    <span class="hljs-keyword">$this</span>-&gt;dispatch();
&#125;</code></pre></div>



<p>loadConfig</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">//加载配置</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadConfig</span>(<span class="hljs-params"></span>)</span>&#123;
    <span class="hljs-comment">//使用全局变量保存用户配置</span>
    <span class="hljs-comment">//因为在其他文件中也要用到这些配置，所以定义为全局变量</span>
    <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;config&#x27;</span>] = <span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;./application/config/config.php&#x27;</span>;

&#125;</code></pre></div>

<ul>
<li><p>./application/config/config.php文件中的配置以一个数组的形式存放</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * 公共配置文件</span>
<span class="hljs-comment"> */</span>


<span class="hljs-keyword">return</span> [
    <span class="hljs-comment">//数据库配置</span>
    <span class="hljs-string">&#x27;db&#x27;</span> =&gt; [
        <span class="hljs-string">&#x27;user&#x27;</span>=&gt;<span class="hljs-string">&#x27;root&#x27;</span>,
        <span class="hljs-string">&#x27;pass&#x27;</span>=&gt;<span class="hljs-string">&#x27;root&#x27;</span>,
        <span class="hljs-string">&#x27;dbname&#x27;</span>=&gt;<span class="hljs-string">&#x27;test&#x27;</span>
    ],

    <span class="hljs-comment">//应用的整体配置</span>
    <span class="hljs-string">&#x27;app&#x27;</span> =&gt; [
        <span class="hljs-string">&#x27;default_platform&#x27;</span> =&gt; <span class="hljs-string">&#x27;User&#x27;</span>,

    ],

    <span class="hljs-comment">//前台配置</span>
    <span class="hljs-string">&#x27;home&#x27;</span> =&gt; [
        <span class="hljs-string">&#x27;default_controller&#x27;</span> =&gt; <span class="hljs-string">&#x27;User&#x27;</span>,
        <span class="hljs-string">&#x27;default_action&#x27;</span> =&gt; <span class="hljs-string">&#x27;listAll&#x27;</span>
    ],

    <span class="hljs-string">&#x27;admin&#x27;</span> =&gt; [
        <span class="hljs-string">&#x27;default_controller&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,
        <span class="hljs-string">&#x27;default_action&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>
    ]

];</code></pre></div>



</li>
</ul>
<p>registerAutoLoad</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">registerAutoLoad</span>(<span class="hljs-params"></span>)</span>&#123;
    spl_autoload_register([<span class="hljs-keyword">$this</span>,<span class="hljs-string">&#x27;userAutoLoad&#x27;</span>]);
&#125;</code></pre></div>

<ul>
<li><p>它告诉PHP碰到没有定义的类就执行function</p>
</li>
<li><p>这里传入一个数组，第一个元素为类，第二为类的成员函数，这样的方式可以直接调用类的该方法</p>
</li>
<li><p>这里调用的是userAutoLoad</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">//创建用户自定义类的加载方法</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">userAutoLoad</span>(<span class="hljs-params"><span class="hljs-variable">$className</span></span>)</span>&#123;
    <span class="hljs-comment">//定义基本类的列表</span>
    <span class="hljs-variable">$baseClass</span> = [
        <span class="hljs-string">&#x27;Model&#x27;</span> =&gt; <span class="hljs-string">&#x27;./framework/Model.php&#x27;</span>,
        <span class="hljs-string">&#x27;Db&#x27;</span> =&gt; <span class="hljs-string">&#x27;./framework/Db.php&#x27;</span>,
    ];
  
    <span class="hljs-comment">//依次进行判断，是基础类？模型类？控制器类？</span>
    <span class="hljs-comment">//依次加载</span>
  
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$baseClass</span>[<span class="hljs-variable">$className</span>]))&#123;
        <span class="hljs-keyword">require</span> <span class="hljs-variable">$baseClass</span>[<span class="hljs-variable">$className</span>];
    &#125; <span class="hljs-keyword">elseif</span> (substr(<span class="hljs-variable">$className</span>,<span class="hljs-number">-5</span>) === <span class="hljs-string">&#x27;Model&#x27;</span>)&#123;
        <span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;./application/home/model/&#x27;</span>.<span class="hljs-variable">$className</span>.<span class="hljs-string">&#x27;php&#x27;</span>; <span class="hljs-comment">// 加载自定义模型类</span>
    &#125; <span class="hljs-keyword">elseif</span> (substr(<span class="hljs-variable">$className</span>,<span class="hljs-number">-10</span>) === <span class="hljs-string">&#x27;Controller&#x27;</span>)&#123;
        <span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;./application/home/controller/&#x27;</span>.<span class="hljs-variable">$className</span>.<span class="hljs-string">&#x27;php&#x27;</span>; <span class="hljs-comment">// 加载自定义模型类</span>
    &#125;
&#125;</code></pre></div>





</li>
</ul>
<p>getRequestParams</p>
<p>需要处理的url：//?mvd1.php?p=home&amp;c=User$a=info</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">//获取请求参数</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRequestParams</span>(<span class="hljs-params"></span>)</span>&#123;
    <span class="hljs-variable">$defPlate</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;config&#x27;</span>][<span class="hljs-string">&#x27;app&#x27;</span>][<span class="hljs-string">&#x27;default_platform&#x27;</span>];
    <span class="hljs-variable">$p</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>]:<span class="hljs-variable">$defPlate</span>;
    define(<span class="hljs-string">&#x27;PLATFORM&#x27;</span>,<span class="hljs-variable">$p</span>);

    <span class="hljs-variable">$defController</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;config&#x27;</span>][PLATFORM][<span class="hljs-string">&#x27;default_controller&#x27;</span>];
    <span class="hljs-variable">$c</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]:<span class="hljs-variable">$defController</span>;
    define(<span class="hljs-string">&#x27;CONTROLLER&#x27;</span>,<span class="hljs-variable">$c</span>);

    <span class="hljs-variable">$defAction</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;config&#x27;</span>][PLATFORM][<span class="hljs-string">&#x27;default_action&#x27;</span>];
    <span class="hljs-variable">$a</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]:<span class="hljs-variable">$defAction</span>;
    define(<span class="hljs-string">&#x27;ACTION&#x27;</span>,<span class="hljs-variable">$a</span>);
&#125;
</code></pre></div>

<ul>
<li>从url中读取参数后，即可分发请求</li>
</ul>
<p>dispatch</p>
<div class="hljs code-wrapper"><pre><code class="hljs php">    <span class="hljs-comment">//请求分发</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dispatch</span>(<span class="hljs-params"></span>)</span>&#123;
        <span class="hljs-comment">//实例化控制器类</span>
        <span class="hljs-variable">$controllerName</span> = CONTROLLER.<span class="hljs-string">&#x27;Controller&#x27;</span>;
        <span class="hljs-variable">$controller</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable">$controllerName</span>;

        <span class="hljs-variable">$controllerAction</span> = ACTION.<span class="hljs-string">&#x27;Action&#x27;</span>;
        <span class="hljs-variable">$controller</span>-&gt;<span class="hljs-variable">$controllerAction</span>();
    &#125;
    <span class="hljs-comment">//?mvd1.php?p=home&amp;c=User$a=info</span>
&#125;</code></pre></div>





<p>base.php</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * 框架基础类、引导类</span>
<span class="hljs-comment"> * 1.读取配置</span>
<span class="hljs-comment"> * 2.自动加载类</span>
<span class="hljs-comment"> * 3.请求分发</span>
<span class="hljs-comment"> */</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span></span>&#123;
    <span class="hljs-comment">//创建run方法、完成框架的所有功能</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>)</span>&#123;
        <span class="hljs-comment">//加载配置</span>
        <span class="hljs-keyword">$this</span>-&gt;loadConfig();
        <span class="hljs-comment">//注册自动加载</span>
        <span class="hljs-keyword">$this</span>-&gt;registerAutoLoad();
        <span class="hljs-comment">//获取请求参数</span>
        <span class="hljs-keyword">$this</span>-&gt;getRequestParams();
        <span class="hljs-comment">//请求分发</span>
        <span class="hljs-keyword">$this</span>-&gt;dispatch();
    &#125;

    <span class="hljs-comment">//加载配置</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadConfig</span>(<span class="hljs-params"></span>)</span>&#123;
        <span class="hljs-comment">//使用全局变量保存用户配置</span>
        <span class="hljs-comment">//因为在其他文件中也要用到这些配置，所以定义为全局变量</span>
        <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;config&#x27;</span>] = <span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;./application/config/config.php&#x27;</span>;

    &#125;

    <span class="hljs-comment">//创建用户自定义类的加载方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">userAutoLoad</span>(<span class="hljs-params"><span class="hljs-variable">$className</span></span>)</span>&#123;
        <span class="hljs-comment">//定义基本类的列表</span>
        <span class="hljs-variable">$baseClass</span> = [
            <span class="hljs-string">&#x27;Model&#x27;</span> =&gt; <span class="hljs-string">&#x27;./framework/Model.php&#x27;</span>,
            <span class="hljs-string">&#x27;Db&#x27;</span> =&gt; <span class="hljs-string">&#x27;./framework/Db.php&#x27;</span>,
        ];

        <span class="hljs-comment">//依次进行判断，是基础类？模型类？控制器类？</span>
        <span class="hljs-comment">//依次加载</span>

        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$baseClass</span>[<span class="hljs-variable">$className</span>]))&#123;
            <span class="hljs-keyword">require</span> <span class="hljs-variable">$baseClass</span>[<span class="hljs-variable">$className</span>];
        &#125; <span class="hljs-keyword">elseif</span> (substr(<span class="hljs-variable">$className</span>,<span class="hljs-number">-5</span>) === <span class="hljs-string">&#x27;Model&#x27;</span>)&#123;
            <span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;./application/home/model/&#x27;</span>.<span class="hljs-variable">$className</span>.<span class="hljs-string">&#x27;.php&#x27;</span>; <span class="hljs-comment">// 加载自定义模型类</span>
        &#125; <span class="hljs-keyword">elseif</span> (substr(<span class="hljs-variable">$className</span>,<span class="hljs-number">-10</span>) === <span class="hljs-string">&#x27;Controller&#x27;</span>)&#123;
            <span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;./application/home/controller/&#x27;</span>.<span class="hljs-variable">$className</span>.<span class="hljs-string">&#x27;.php&#x27;</span>; <span class="hljs-comment">// 加载自定义模型类</span>
        &#125;
    &#125;

    <span class="hljs-comment">//注册自动加载类</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">registerAutoLoad</span>(<span class="hljs-params"></span>)</span>&#123;
        spl_autoload_register([<span class="hljs-keyword">$this</span>,<span class="hljs-string">&#x27;userAutoLoad&#x27;</span>]);
    &#125;

    <span class="hljs-comment">//获取请求参数</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRequestParams</span>(<span class="hljs-params"></span>)</span>&#123;
        <span class="hljs-variable">$defPlate</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;config&#x27;</span>][<span class="hljs-string">&#x27;app&#x27;</span>][<span class="hljs-string">&#x27;default_platform&#x27;</span>];
        <span class="hljs-variable">$p</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>]:<span class="hljs-variable">$defPlate</span>;
        define(<span class="hljs-string">&#x27;PLATFORM&#x27;</span>,<span class="hljs-variable">$p</span>);

        <span class="hljs-variable">$defController</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;config&#x27;</span>][PLATFORM][<span class="hljs-string">&#x27;default_controller&#x27;</span>];
        <span class="hljs-variable">$c</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]:<span class="hljs-variable">$defController</span>;
        define(<span class="hljs-string">&#x27;CONTROLLER&#x27;</span>,<span class="hljs-variable">$c</span>);

        <span class="hljs-variable">$defAction</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;config&#x27;</span>][PLATFORM][<span class="hljs-string">&#x27;default_action&#x27;</span>];
        <span class="hljs-variable">$a</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]:<span class="hljs-variable">$defAction</span>;
        define(<span class="hljs-string">&#x27;ACTION&#x27;</span>,<span class="hljs-variable">$a</span>);
    &#125;


    <span class="hljs-comment">//请求分发</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dispatch</span>(<span class="hljs-params"></span>)</span>&#123;
        <span class="hljs-comment">//实例化控制器类</span>
        <span class="hljs-variable">$controllerName</span> = CONTROLLER.<span class="hljs-string">&#x27;Controller&#x27;</span>;
        <span class="hljs-variable">$controller</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable">$controllerName</span>;

        <span class="hljs-variable">$controllerAction</span> = ACTION.<span class="hljs-string">&#x27;Action&#x27;</span>;
        <span class="hljs-variable">$controller</span>-&gt;<span class="hljs-variable">$controllerAction</span>();
    &#125;
    <span class="hljs-comment">//?mvd1.php?p=home&amp;c=User$a=info</span>
&#125;</code></pre></div>



<h2 id="创建框架的入口文件"><a href="#创建框架的入口文件" class="headerlink" title="创建框架的入口文件"></a>创建框架的入口文件</h2><ul>
<li>导入框架基础类</li>
<li>实例化基础类</li>
<li>开始运行</li>
</ul>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * 入口文件</span>
<span class="hljs-comment"> */</span>

<span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;./framework/Base.php&#x27;</span>;
<span class="hljs-comment">//实例化框架</span>
<span class="hljs-variable">$app</span> = <span class="hljs-keyword">new</span> Base();
<span class="hljs-comment">//让框架跑起来</span>
<span class="hljs-variable">$app</span>-&gt;run();
</code></pre></div>



<p>修改了几处错误</p>
<div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">/*</span>
<span class="hljs-comment"> * 用户模块控制器</span>
<span class="hljs-comment"> * 模块管理</span>
<span class="hljs-comment"> * 模型根据数据表创建，控制器根据模块创建</span>
<span class="hljs-comment"> * 一个控制器完成了一个模块的功能</span>
<span class="hljs-comment"> */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span></span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listAllAction</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-comment">//实例化模型，获取数据</span>
        <span class="hljs-variable">$usr</span> = <span class="hljs-keyword">new</span> UserModel();
        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$usr</span>-&gt;getAll();
        <span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;./application/&#x27;</span>.PLATFORM.<span class="hljs-string">&#x27;/view/user_list.php&#x27;</span>; <span class="hljs-comment">//渲染模板</span>
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">infoAction</span>(<span class="hljs-params"><span class="hljs-variable">$id</span>=<span class="hljs-number">1</span></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-comment">//实例化模型，获取数据</span>
        <span class="hljs-variable">$usr</span> = <span class="hljs-keyword">new</span> UserModel();
        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$usr</span>-&gt;get(<span class="hljs-variable">$id</span>);
<span class="hljs-comment">//        print_r($data);</span>
        <span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;./application/&#x27;</span>.PLATFORM.<span class="hljs-string">&#x27;/view/user_info.php&#x27;</span>;
    &#125;
&#125;</code></pre></div>

<p>加载模板文件时，应该按照指定的platform来进行加载。</p>
<p>成功加载。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/php/">php</a>
                    
                      <a class="hover-with-bg" href="/categories/php/php%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80/">php框架基础</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/php/">php</a>
                    
                      <a class="hover-with-bg" href="/tags/php%E6%A1%86%E6%9E%B6/">php框架</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/10/05/python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8-flask-SSTI/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">python沙箱逃逸&flask SSTI</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/09/20/php-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
                        <span class="hidden-mobile">php 反序列化</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function() {
        this.page.url = 'https://greydr34d.github.io/2020/09/27/php%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%BC%80%E5%8F%91%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84php%E6%A1%86%E6%9E%B6/';
        this.page.identifier = '/2020/09/27/php%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%BC%80%E5%8F%91%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84php%E6%A1%86%E6%9E%B6/';
      };
      Fluid.utils.waitElementVisible('disqus_thread', function () {
        var d = document, s = d.createElement('script');
        s.src = '//' + '' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', new Date());
        (d.head || d.body).appendChild(s);
      });
    </script>
    <noscript>Please enable JavaScript to view the
      <a target="_blank" href="https://disqus.com/?ref_noscript" rel="nofollow noopener noopener">comments powered by Disqus.</a>
    </noscript>
  </div>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->




  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
